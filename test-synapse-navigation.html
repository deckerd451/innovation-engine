<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Synapse Navigation</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      padding: 2rem;
      background: #0a0e27;
      color: #fff;
    }
    .test-section {
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(0,224,255,0.3);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    h2 {
      color: #00e0ff;
      margin-top: 0;
    }
    button {
      background: linear-gradient(135deg, #00e0ff, #0080ff);
      border: none;
      border-radius: 8px;
      color: #000;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      margin: 0.5rem 0.5rem 0.5rem 0;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,224,255,0.3);
    }
    .log {
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(0,224,255,0.2);
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      max-height: 300px;
      overflow-y: auto;
    }
    .log-entry {
      margin-bottom: 0.5rem;
      padding: 0.25rem;
    }
    .log-entry.success { color: #00ff88; }
    .log-entry.error { color: #ff6b6b; }
    .log-entry.info { color: #00e0ff; }
  </style>
</head>
<body>
  <h1>ðŸ§ª Synapse Navigation Test Suite</h1>
  <p>Test the START â†’ Synapse navigation routing system</p>

  <div class="test-section">
    <h2>1. API Availability Tests</h2>
    <button onclick="testApiAvailability()">Test API Availability</button>
    <button onclick="testApiMethods()">Test API Methods</button>
    <div id="api-log" class="log"></div>
  </div>

  <div class="test-section">
    <h2>2. Navigation Tests</h2>
    <button onclick="testOpenSynapse()">Test Open Synapse</button>
    <button onclick="testFocusNode()">Test Focus Node</button>
    <button onclick="testFocusTheme()">Test Focus Theme</button>
    <button onclick="testShowActivity()">Test Show Activity</button>
    <div id="nav-log" class="log"></div>
  </div>

  <div class="test-section">
    <h2>3. Event System Tests</h2>
    <button onclick="testFocusNodeEvent()">Test Focus Node Event</button>
    <button onclick="testFocusThemeEvent()">Test Focus Theme Event</button>
    <button onclick="testShowActivityEvent()">Test Show Activity Event</button>
    <div id="event-log" class="log"></div>
  </div>

  <div class="test-section">
    <h2>4. Routing Tests</h2>
    <button onclick="testPersonRouting()">Test Person Routing</button>
    <button onclick="testProjectRouting()">Test Project Routing</button>
    <button onclick="testThemeRouting()">Test Theme Routing</button>
    <button onclick="testCoordinationRouting()">Test Coordination Routing</button>
    <div id="routing-log" class="log"></div>
  </div>

  <div class="test-section">
    <h2>5. UUID Validation Tests</h2>
    <button onclick="testValidUUID()">Test Valid UUID</button>
    <button onclick="testInvalidUUID()">Test Invalid UUID</button>
    <button onclick="testThemeUUID()">Test Theme UUID</button>
    <div id="uuid-log" class="log"></div>
  </div>

  <script>
    // Logging helper
    function log(containerId, message, type = 'info') {
      const container = document.getElementById(containerId);
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      container.appendChild(entry);
      container.scrollTop = container.scrollHeight;
    }

    // Test 1: API Availability
    function testApiAvailability() {
      const logId = 'api-log';
      log(logId, 'Testing API availability...', 'info');
      
      if (typeof window.synapseApi === 'undefined') {
        log(logId, 'âŒ window.synapseApi is undefined', 'error');
        log(logId, 'Make sure Synapse is initialized first', 'error');
        return;
      }
      
      log(logId, 'âœ… window.synapseApi exists', 'success');
      log(logId, `Type: ${typeof window.synapseApi}`, 'info');
    }

    function testApiMethods() {
      const logId = 'api-log';
      log(logId, 'Testing API methods...', 'info');
      
      if (!window.synapseApi) {
        log(logId, 'âŒ API not available', 'error');
        return;
      }
      
      const methods = ['open', 'focusNode', 'focusTheme', 'showActivity'];
      methods.forEach(method => {
        if (typeof window.synapseApi[method] === 'function') {
          log(logId, `âœ… ${method}() exists`, 'success');
        } else {
          log(logId, `âŒ ${method}() missing`, 'error');
        }
      });
    }

    // Test 2: Navigation
    function testOpenSynapse() {
      const logId = 'nav-log';
      log(logId, 'Testing open()...', 'info');
      
      if (!window.synapseApi) {
        log(logId, 'âŒ API not available', 'error');
        return;
      }
      
      try {
        window.synapseApi.open();
        log(logId, 'âœ… open() called successfully', 'success');
      } catch (err) {
        log(logId, `âŒ Error: ${err.message}`, 'error');
      }
    }

    function testFocusNode() {
      const logId = 'nav-log';
      log(logId, 'Testing focusNode()...', 'info');
      
      if (!window.synapseApi) {
        log(logId, 'âŒ API not available', 'error');
        return;
      }
      
      // Use a test UUID
      const testId = '12345678-1234-1234-1234-123456789abc';
      
      try {
        window.synapseApi.focusNode(testId);
        log(logId, `âœ… focusNode(${testId}) called`, 'success');
      } catch (err) {
        log(logId, `âŒ Error: ${err.message}`, 'error');
      }
    }

    function testFocusTheme() {
      const logId = 'nav-log';
      log(logId, 'Testing focusTheme()...', 'info');
      
      if (!window.synapseApi) {
        log(logId, 'âŒ API not available', 'error');
        return;
      }
      
      const testId = '12345678-1234-1234-1234-123456789abc';
      
      try {
        window.synapseApi.focusTheme(testId);
        log(logId, `âœ… focusTheme(${testId}) called`, 'success');
      } catch (err) {
        log(logId, `âŒ Error: ${err.message}`, 'error');
      }
    }

    function testShowActivity() {
      const logId = 'nav-log';
      log(logId, 'Testing showActivity()...', 'info');
      
      if (!window.synapseApi) {
        log(logId, 'âŒ API not available', 'error');
        return;
      }
      
      try {
        window.synapseApi.showActivity();
        log(logId, 'âœ… showActivity() called', 'success');
      } catch (err) {
        log(logId, `âŒ Error: ${err.message}`, 'error');
      }
    }

    // Test 3: Events
    function testFocusNodeEvent() {
      const logId = 'event-log';
      log(logId, 'Testing synapse:focus-node event...', 'info');
      
      const testId = '12345678-1234-1234-1234-123456789abc';
      
      // Listen for the event
      const listener = (event) => {
        log(logId, `âœ… Event received: ${event.detail.nodeId}`, 'success');
        window.removeEventListener('synapse:focus-node', listener);
      };
      
      window.addEventListener('synapse:focus-node', listener);
      
      // Dispatch the event
      window.dispatchEvent(new CustomEvent('synapse:focus-node', {
        detail: { nodeId: testId }
      }));
      
      log(logId, `Event dispatched with nodeId: ${testId}`, 'info');
    }

    function testFocusThemeEvent() {
      const logId = 'event-log';
      log(logId, 'Testing synapse:focus-theme event...', 'info');
      
      const testId = '12345678-1234-1234-1234-123456789abc';
      
      const listener = (event) => {
        log(logId, `âœ… Event received: ${event.detail.themeId}`, 'success');
        window.removeEventListener('synapse:focus-theme', listener);
      };
      
      window.addEventListener('synapse:focus-theme', listener);
      
      window.dispatchEvent(new CustomEvent('synapse:focus-theme', {
        detail: { themeId: testId }
      }));
      
      log(logId, `Event dispatched with themeId: ${testId}`, 'info');
    }

    function testShowActivityEvent() {
      const logId = 'event-log';
      log(logId, 'Testing synapse:show-activity event...', 'info');
      
      const testId = '12345678-1234-1234-1234-123456789abc';
      
      const listener = (event) => {
        log(logId, `âœ… Event received: ${event.detail.userId}`, 'success');
        window.removeEventListener('synapse:show-activity', listener);
      };
      
      window.addEventListener('synapse:show-activity', listener);
      
      window.dispatchEvent(new CustomEvent('synapse:show-activity', {
        detail: { userId: testId }
      }));
      
      log(logId, `Event dispatched with userId: ${testId}`, 'info');
    }

    // Test 4: Routing
    function testPersonRouting() {
      const logId = 'routing-log';
      log(logId, 'Testing person routing...', 'info');
      
      if (!window.DailySuggestionsUI) {
        log(logId, 'âŒ DailySuggestionsUI not available', 'error');
        return;
      }
      
      const testData = {
        targetId: '12345678-1234-1234-1234-123456789abc',
        suggestionType: 'person',
        name: 'Test Person'
      };
      
      try {
        window.DailySuggestionsUI.handleSuggestionAction('viewPerson', testData);
        log(logId, 'âœ… Person routing executed', 'success');
      } catch (err) {
        log(logId, `âŒ Error: ${err.message}`, 'error');
      }
    }

    function testProjectRouting() {
      const logId = 'routing-log';
      log(logId, 'Testing project routing...', 'info');
      
      if (!window.DailySuggestionsUI) {
        log(logId, 'âŒ DailySuggestionsUI not available', 'error');
        return;
      }
      
      const testData = {
        targetId: '12345678-1234-1234-1234-123456789abc',
        suggestionType: 'project',
        title: 'Test Project'
      };
      
      try {
        window.DailySuggestionsUI.handleSuggestionAction('viewProject', testData);
        log(logId, 'âœ… Project routing executed', 'success');
      } catch (err) {
        log(logId, `âŒ Error: ${err.message}`, 'error');
      }
    }

    function testThemeRouting() {
      const logId = 'routing-log';
      log(logId, 'Testing theme routing...', 'info');
      
      if (!window.DailySuggestionsUI) {
        log(logId, 'âŒ DailySuggestionsUI not available', 'error');
        return;
      }
      
      const testData = {
        targetId: '12345678-1234-1234-1234-123456789abc',
        suggestionType: 'theme',
        title: 'Test Theme'
      };
      
      try {
        window.DailySuggestionsUI.handleSuggestionAction('viewTheme', testData);
        log(logId, 'âœ… Theme routing executed', 'success');
      } catch (err) {
        log(logId, `âŒ Error: ${err.message}`, 'error');
      }
    }

    function testCoordinationRouting() {
      const logId = 'routing-log';
      log(logId, 'Testing coordination routing...', 'info');
      
      if (!window.DailySuggestionsUI) {
        log(logId, 'âŒ DailySuggestionsUI not available', 'error');
        return;
      }
      
      const testData = {
        targetId: '12345678-1234-1234-1234-123456789abc',
        suggestionType: 'coordination',
        subtype: 'theme_convergence'
      };
      
      try {
        window.DailySuggestionsUI.handleSuggestionAction('viewCoordination', testData);
        log(logId, 'âœ… Coordination routing executed', 'success');
      } catch (err) {
        log(logId, `âŒ Error: ${err.message}`, 'error');
      }
    }

    // Test 5: UUID Validation
    function testValidUUID() {
      const logId = 'uuid-log';
      log(logId, 'Testing valid UUID...', 'info');
      
      const validUUIDs = [
        '12345678-1234-1234-1234-123456789abc',
        'a1b2c3d4-e5f6-7890-abcd-ef1234567890',
        '00000000-0000-0000-0000-000000000000'
      ];
      
      validUUIDs.forEach(uuid => {
        const isValid = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(uuid);
        if (isValid) {
          log(logId, `âœ… Valid: ${uuid}`, 'success');
        } else {
          log(logId, `âŒ Invalid: ${uuid}`, 'error');
        }
      });
    }

    function testInvalidUUID() {
      const logId = 'uuid-log';
      log(logId, 'Testing invalid UUID...', 'info');
      
      const invalidUUIDs = [
        'not-a-uuid',
        '12345',
        'theme:12345678-1234-1234-1234-123456789abc',
        ''
      ];
      
      invalidUUIDs.forEach(uuid => {
        const isValid = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(uuid);
        if (!isValid) {
          log(logId, `âœ… Correctly rejected: ${uuid}`, 'success');
        } else {
          log(logId, `âŒ Incorrectly accepted: ${uuid}`, 'error');
        }
      });
    }

    function testThemeUUID() {
      const logId = 'uuid-log';
      log(logId, 'Testing theme UUID format...', 'info');
      
      const themeId = '12345678-1234-1234-1234-123456789abc';
      const themeNodeId = `theme:${themeId}`;
      
      log(logId, `Theme ID: ${themeId}`, 'info');
      log(logId, `Theme Node ID: ${themeNodeId}`, 'info');
      
      const isValidUUID = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(themeId);
      const isThemeFormat = themeNodeId.startsWith('theme:');
      
      if (isValidUUID && isThemeFormat) {
        log(logId, 'âœ… Theme UUID format correct', 'success');
      } else {
        log(logId, 'âŒ Theme UUID format incorrect', 'error');
      }
    }

    // Auto-run basic tests on load
    window.addEventListener('load', () => {
      setTimeout(() => {
        testApiAvailability();
        testApiMethods();
      }, 1000);
    });
  </script>
</body>
</html>
