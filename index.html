<head>
  <!-- —— Neuron redirect —— -->
  <script>
    const params = new URLSearchParams(window.location.search);
    if (params.get("source") === "neuron") {
      window.location.href = "/neural.html?" + params.toString();
    }
  </script>

  <!-- —— Google Analytics —— -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6NDKG07DY6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag("js", new Date());
    gtag("config", "G-6NDKG07DY6");
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>CharlestonHacks - Home</title>
  <meta name="description" content="CharlestonHacks – Making Invisible Networks Visible."/>
  <meta property="og:image" content="images/websitepanel.webp"/>
  <meta property="og:url" content="https://charlestonhacks.com"/>
  <meta name="theme-color" content="#0a0a0a"/>

  <link rel="icon" href="favicon.ico" type="image/x-icon"/>
  <link rel="apple-touch-icon" href="images/apple-touch-icon.png"/>
  <link rel="manifest" href="/manifest.json"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link rel="stylesheet" href="styles.css"/>

  <style>

/* ------------------------------------------------------------------
   FIX: Splash overlay must not block clicks after fade-out
   ------------------------------------------------------------------ */
#splash-overlay {
  opacity: 1;
  pointer-events: auto;
  transition: opacity .4s ease;
}

/* When fade-out class is added, the overlay disappears and cannot block clicks */
#splash-overlay.fade-out {
  opacity: 0 !important;
  pointer-events: none !important;
}


/* Background */
#neural-bg {
  pointer-events: none !important;
  z-index: 0;
}

/* Card wrapper is clickable */
.main-wrapper {
  position: relative;
  z-index: 2;
  pointer-events: auto !important;
}

/* BUT inner elements should not block hotspots */
.main-wrapper * {
  pointer-events: none !important;
}

/* Hotspots: clickable */
.clickable-area {
  pointer-events: auto !important;
  z-index: 5;
}

/* Card image & frame also clickable */
#missionImage,
#cardFrame,
#missionVideo {
  pointer-events: auto !important;
  z-index: 3;
}

/* Icon bar: clickable (no longer blocks the card) */
.icons-container {
  position: relative;
  z-index: 10;
  pointer-events: auto !important;
}

.icons-container a {
  pointer-events: auto !important;
  z-index: 11;
}

/* Calendar: ALWAYS clickable */
#open-calendar {
  pointer-events: auto !important;
  position: relative;
  z-index: 20 !important;
}

/* BBS drawer */
#bbs-container,
#bbs-online {
  pointer-events: auto !important;
  position: relative;
  z-index: 30;
}


  /* Drawer animation */
  .bbs-open {
    display: block !important;
    animation: slideDown 0.4s ease forwards;
  }

  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* ============================================================
     3. EVENTS MODAL
     ============================================================ */

  #events-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.88);
    backdrop-filter: blur(6px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    pointer-events: none;
  }

  #events-overlay.active {
    display: flex;
    pointer-events: auto;
    animation: fadeIn .3s ease;
  }

  .events-modal {
    background: #0b0b0b;
    border: 1.5px solid var(--gold);
    border-radius: 16px;
    padding: 1.5rem;
    width: 90%;
    max-width: 480px;
    text-align: center;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 0 20px rgba(201,163,94,0.4);
  }

  #events-list {
    max-height: 65vh;
    overflow-y: auto;
    padding-right: 8px;
  }

  .events-modal div::-webkit-scrollbar {
    width: 8px;
  }
  .events-modal div::-webkit-scrollbar-thumb {
    background: rgba(0,224,255,0.6);
    border-radius: 4px;
  }

  /* ============================================================
     4. ICON BAR (cleaned)
     ============================================================ */

  .icons-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    gap: 0.55rem;
    margin: 1.4rem auto 2rem;
    padding: 0 0.5rem;
  }

  .icons-container a {
    color: #fff;
    font-size: 1.4rem;
    width: 34px;
    height: 34px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform .2s ease;
  }
  .icons-container a:hover {
    transform: scale(1.18);
  }

  </style>
</head>
<body>
  <!-- Background Neural Canvas -->
  <canvas id="neural-bg"></canvas>

  <!-- —— Splash Screen —— -->
  <div id="splash-overlay" role="dialog" aria-modal="true" tabindex="-1">
    <div id="splash-content">
      <img src="images/charlestonhackslogo.svg" alt="CharlestonHacks Logo" style="width:200px;" />
      <h1 id="splash-title">Welcome to CharlestonHacks</h1>
      <p id="splash-desc">Loading…</p>

      <label style="margin-top:1em;font-size:.9rem;">
        <input type="checkbox" id="dont-show-again"/> Don’t show this again
      </label>

      <div style="margin-top:1rem;">
        <button id="community-site-btn" class="btn">Community Site</button>
        <button id="public-site-btn" class="btn">Public Site</button>
      </div>

      <p style="font-size:.8rem;opacity:.7;margin-top:2rem;">© 2025 CharlestonHacks. All rights reserved.</p>
    </div>
  </div>

  <!-- —— Audio —— -->
  <audio id="cardflipSound" src="assets/atmospherel.m4a" preload="auto"></audio>
  <audio id="chimeSound" src="assets/chime.mp3" preload="auto"></audio>
  <audio id="keysSound" src="assets/keys.m4a" preload="auto"></audio>

  <!-- ============================================================
       MAIN WRAPPER (Card + Interactive Areas)
       ============================================================ -->
  <main>
    <div class="main-wrapper">
      <div class="media-container">

        <!-- Countdown + BTC -->
        <div id="countdown"></div>
        <div id="btcPrice"></div>

        <!-- Big Card -->
        <img id="missionImage" src="icons/card.png" alt="Big Card"/>
        <img id="cardFrame" src="images/cardframe2.svg" alt="Frame" style="display:none;"/>

        <!-- Video Overlay -->
        <video id="missionVideo" muted playsinline controls style="display:none;opacity:0;">
          <source src="" type="video/mp4"/>
        </video>

        <!-- Hotspot Buttons -->
        <button type="button" class="clickable-area top-left"
          data-sound="chime" data-url="Poster.html"
          data-info="Learn more about the event poster.">
          <img src="images/informationbutton.webp" alt="Info"/>
        </button>

        <button type="button" class="clickable-area top-center"
          data-sound="chime" data-url="docs.html"
          data-info="Event documentation.">
          <img src="images/crestn.svg" alt="Docs"/>
        </button>

        <button type="button" class="clickable-area top-right"
          data-sound="chime" data-url="2card.html"
          data-info="Explore the innovation engine.">
          <img src="images/innovationenginebutton.webp" alt="Innovation"/>
        </button>

        <button type="button" class="clickable-area middle-left"
          data-sound="chime" data-url="experimental.html"
          data-info="Sandbox environment.">
          <img src="images/experiment.webp" alt="Experiment"/>
        </button>

        <button type="button" class="clickable-area middle-right"
          data-sound="chime" data-url="swag.html"
          data-info="View and order event swag.">
          <img src="images/case.webp" alt="Case"/>
        </button>

        <button type="button" class="clickable-area bottom-left"
          data-sound="chime" data-url="news.html"
          data-info="Catch up on news.">
          <img src="images/newsbutton.webp" alt="News"/>
        </button>

        <button type="button" class="clickable-area bottom-center"
          data-sound="keys" data-url="donations.html"
          data-info="Sponsor CharlestonHacks.">
          <img src="images/keysn.svg" alt="Keys"/>
        </button>

        <button type="button" class="clickable-area bottom-right"
          data-sound="chime" data-url="cardmatchgame.html"
          data-info="Play the card match game.">
          <img src="images/peoplebutton.webp" alt="People"/>
        </button>

        <!-- Info Tooltip Under Buttons -->
        <div id="infoLine" class="info-line">
          <span id="infoParticle"></span><span id="infoText"></span>
        </div>

      </div>
    </div>

    <!-- ============================================================
         ICON BAR (Social Links + Calendar Button)
         ============================================================ -->
    <section class="icons-container">
      <a href="https://github.com/sponsors/deckerd451" target="_blank"><i class="fas fa-heart"></i></a>
      <a href="2card.html"><i class="fas fa-people-arrows"></i></a>
      <a href="subscribe.html"><i class="fas fa-bell"></i></a>
      <a href="https://www.linkedin.com/company/charlestonhacks" target="_blank"><i class="fab fa-linkedin"></i></a>
      <a href="https://www.instagram.com/charlestonhacks/" target="_blank"><i class="fab fa-instagram"></i></a>
      <a href="mailto:hello@charlestonhacks.com"><i class="fas fa-envelope"></i></a>
      <a href="https://www.facebook.com/deckerdb26354" target="_blank"><i class="fab fa-facebook"></i></a>

      <!-- Calendar Button -->
      <a id="open-calendar" title="View Charleston Events">
        <i class="fas fa-calendar-alt"></i>
      </a>
    </section>

    <!-- ============================================================
         BBS TERMINAL: NOW A COLLAPSIBLE DRAWER (Piece 3 toggles it)
         ============================================================ -->
    <div id="bbs-container">
      <div id="bbs-screen"></div>
      <form id="bbs-form">
        <span class="bbs-prompt">></span>
        <input id="bbs-input" type="text" placeholder="type message…" autocomplete="off"/>
      </form>
    </div>

    <div id="bbs-online">
      <strong>Online:</strong>
      <div id="bbs-online-list"></div>
    </div>

  </main>

  <!-- ============================================================
       EVENTS MODAL
       ============================================================ -->
  <div id="events-overlay">
    <div class="events-modal">
      <h2>Upcoming Charleston Events</h2>
      <div id="events-list"></div>
      <button id="close-overlay">Close</button>
    </div>
  </div>

  <!-- ============================================================
       SCRIPT BOOTSTRAP (Piece 3 will replace this with full logic)
       ============================================================ -->

  <!-- Splash Logic -->
  <script>
    (function(){
      const splash = document.getElementById("splash-overlay");
      const cBtn = document.getElementById("community-site-btn");
      const pBtn = document.getElementById("public-site-btn");
      const box = document.getElementById("dont-show-again");
      const KEY = "chs_splash_seen_once";

      function hide(immediate=false){
        splash.classList.add("fade-out");
        document.body.classList.remove("splash-active");
        setTimeout(()=> splash.style.display="none", immediate?0:400);
      }

      function dismiss(){
        if(box.checked) localStorage.setItem(KEY,"true");
        hide();
      }

      window.addEventListener("DOMContentLoaded",()=>{
        if(localStorage.getItem(KEY)==="true"){
          hide(true);
          return;
        }
        splash.style.display="flex";
        document.body.classList.add("splash-active");

        cBtn.onclick=e=>{ e.preventDefault(); dismiss(); };
        pBtn.onclick=e=>{
          e.preventDefault();
          dismiss();
          window.location.href="https://charlestonhacks.mailchimpsites.com/";
        };
      });
    })();
  </script>

  <!-- Main Scripts (Piece 3 will replace this section with optimized JS) -->
  <script type="module" src="/assets/js/neuralBackground.js"></script>
  <script type="module" src="/assets/js/supabaseClient.js"></script>
  <script type="module" src="/assets/js/bbs.js"></script>

  <!-- Safe Loader for eventsFeed.js -->
  <script type="module">
    async function loadEventsFeedWhenReady() {
      while (!document.getElementById("events-list")) {
        await new Promise(r => setTimeout(r, 40));
      }
      await import("/assets/js/eventsFeed.js");
    }
    window.addEventListener("DOMContentLoaded", loadEventsFeedWhenReady);
  </script>

</body>
