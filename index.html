<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Cache refresh: 2026-01-18 FORCE DEPLOYMENT -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <title>CharlestonHacks Innovation Engine</title>
  <link rel="icon" href="favicon.ico"/>
  <link rel="manifest" href="./manifest.json">


  <!-- Core CSS (v=20260220-1 â€” bump this string on every CSS change) -->
  <link rel="stylesheet" href="assets/css/base.css?v=20260220-1" />
  <link rel="stylesheet" href="assets/css/engine.css?v=20260220-1" />
  <link rel="stylesheet" href="assets/css/overlays.css?v=20260220-1" />
  <link rel="stylesheet" href="assets/css/connections.css?v=20260220-1" />
  <link rel="stylesheet" href="assets/css/messaging.css?v=20260220-1" />
  <link rel="stylesheet" href="dashboard.css?v=20260220-1" />
  <link rel="stylesheet" href="assets/css/synapse-progressive-disclosure.css?v=20260220-1" />
  <link rel="stylesheet" href="assets/css/quiet-mode.css?v=20260220-1" />
  <link rel="stylesheet" href="assets/css/mobile-safe-area.css?v=20260220-1" />

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    /* Dynamic viewport height variables for mobile browser UI */
    :root {
      --vh: 1vh;
      --real-vh: 1vh;
    }

    /* NUCLEAR OPTION: Force black backgrounds everywhere */
    html,
    body,
    #main-content,
    #synapse-main-view,
    #synapse-svg,
    .unified-main {
      background: #000 !important;
      background-color: #000 !important;
    }

    /* Remove all borders, padding, and margins from containers */
    #main-content,
    #synapse-main-view,
    .unified-main {
      margin: 0 !important;
      padding: 0 !important;
      border: none !important;
      max-width: none !important;
    }

    /* Ensure full coverage with no gaps - use dynamic viewport height */
    html, body {
      margin: 0 !important;
      padding: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      height: calc(var(--vh, 1vh) * 100) !important;
      overflow: hidden !important;
      overflow-x: hidden !important;
      position: fixed !important;
      touch-action: pan-y pinch-zoom !important;
    }

    /* Prevent input zoom and keyboard-induced scrolling on mobile */
    input, textarea, select {
      font-size: 16px !important; /* Prevents iOS zoom on focus */
    }

    /* Prevent keyboard from causing horizontal scroll */
    @supports (-webkit-touch-callout: none) {
      /* iOS-specific fix */
      body {
        position: fixed !important;
        width: 100% !important;
      }
    }

    /* Override any pseudo-elements */
    body::before,
    body::after,
    html::before,
    html::after {
      display: none !important;
    }

    body { overflow: hidden; }

    /* Hover effects for action buttons */
    .action-btn:hover {
      transform: translateY(-5px) scale(1.1);
      filter: brightness(1.3);
    }

    .action-btn:active {
      transform: translateY(-2px) scale(1.05);
    }

    /* START button hover */
    #btn-start-center:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 40px rgba(0,255,136,0.6);
      filter: brightness(1.3);
      opacity: 0.75;
    }

    #btn-start-center:active {
      transform: scale(1.05);
      opacity: 0.75;
    }

    @keyframes softGlow {
      0%, 100% {
        box-shadow: 0 0 8px rgba(0,224,255,0.2), inset 0 0 8px rgba(0,224,255,0.05);
      }
      50% {
        box-shadow: 0 0 16px rgba(0,224,255,0.3), inset 0 0 12px rgba(0,224,255,0.08);
      }
    }

    .mentor-panel-close:hover {
      background: rgba(255,255,255,0.15) !important;
      border-color: rgba(255,255,255,0.3) !important;
      color: rgba(255,255,255,1) !important;
    }

    .mentor-panel {
      animation: mentorPanelSlide 0.3s ease-out;
    }

    @keyframes mentorPanelSlide {
      from {
        opacity: 0;
        transform: translate(-50%, -45%);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%);
      }
    }

    /* Responsive mentor nav */
    @media (max-width: 768px) {
      /* CRITICAL: Prevent horizontal scroll on mobile */
      html, body {
        max-width: 100vw !important;
        overflow-x: hidden !important;
        position: fixed !important;
        width: 100% !important;
      }

      #main-content,
      .unified-main,
      #synapse-main-view,
      #synapse-svg {
        max-width: 100vw !important;
        overflow-x: hidden !important;
        width: 100% !important;
      }

      /* Ensure all absolutely positioned elements stay within viewport */
      #main-content > div {
        max-width: 100vw !important;
      }

      /* MOBILE UI OPTIMIZATION: Move refresh button to bottom */
      #btn-refresh-network {
        position: fixed !important;
        top: auto !important;
        bottom: 80px !important; /* Above search bar */
        right: 20px !important;
        z-index: 1000 !important;
        width: 56px !important;
        height: 56px !important;
        box-shadow: 0 4px 12px rgba(0,224,255,0.3) !important;
      }

      /* Hide refresh button from top on mobile */
      .top-actions #btn-refresh-network {
        display: none !important;
      }

      /* Responsive mentor panels for mobile */
      .mentor-panel {
        width: 95vw !important;
        max-height: 90vh !important;
        padding: 1rem !important;
        border-radius: 12px !important;
      }

      .mentor-panel h2 {
        font-size: 1.2rem !important;
      }

      .mentor-panel p {
        font-size: 0.9rem !important;
      }

      .mentor-panel-close {
        width: 32px !important;
        height: 32px !important;
        top: 0.5rem !important;
        right: 0.5rem !important;
      }
    }

    .stat-card-mini:hover {
      transform: translateY(-3px);
      background: rgba(0,224,255,0.15) !important;
      border-color: rgba(0,224,255,0.5) !important;
      box-shadow: 0 4px 12px rgba(0,224,255,0.3);
    }

    /* Engagement system animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-100px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-30px); }
      60% { transform: translateY(-15px); }
    }

    @keyframes dropdownFadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* User Dropdown Styles */
    #user-menu:hover {
      background: rgba(0,224,255,0.15);
      border-color: rgba(0,224,255,0.5);
    }

    #user-dropdown button:hover {
      background: rgba(0,224,255,0.1);
    }

    #dropdown-logout:hover {
      background: rgba(255,107,107,0.15) !important;
    }

    /* Notification Bell Badge */
    .notification-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      background: #ff3b30;
      color: white;
      border-radius: 10px;
      padding: 2px 6px;
      font-size: 0.7rem;
      font-weight: bold;
      min-width: 18px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      z-index: 10;
    }

    /* Fix blue bar overlay on profile pages */
    .profile-overlay-bar,
    .blue-bar-overlay {
      display: none !important;
    }

    /* Hide search container when ANY modal is open */
    .modal.active ~ * #centered-search-container,
    .modal.active ~ #centered-search-container {
      display: none !important;
    }

    /* Ensure profile modal content is not overlapped */
    #profile-modal .modal-content {
      z-index: 1000;
      position: relative;
    }

    /* Make project details panel scrollable */
    .project-details-panel,
    .project-info-content {
      overflow-y: auto !important;
      max-height: calc(100vh - 200px) !important;
    }

    /* Ensure project members list is scrollable */
    .project-members-list {
      overflow-y: auto !important;
      max-height: 300px !important;
    }

    @media (max-width: 768px) {
      .stat-card-mini { padding: 0.5rem !important; }
      .stat-card-mini .label { font-size: 0.65rem !important; }
      .stat-card-mini .value { font-size: 1.25rem !important; }

      /* Mobile dropdown adjustments */
      #user-dropdown {
        right: -10px !important;
        min-width: 200px !important;
      }

      #user-name-header {
        display: none !important;
      }

      #user-menu {
        padding: 0.4rem 0.75rem !important;
        gap: 0.5rem !important;
      }

      /* XP Notification - Mobile responsive */
      .xp-notification {
        left: 1rem !important;
        right: 1rem !important;
        bottom: 1rem !important;
        max-width: calc(100vw - 2rem) !important;
        padding: 0.875rem 1.25rem !important;
        font-size: 0.9rem !important;
      }

      /* MOBILE LAYOUT FIXES */
      /* Line up all header elements horizontally at top */
      #main-content > div:first-child {
        top: 8px !important;
        right: 8px !important;
        left: auto !important;
      }

      #main-content > div:first-child img {
        height: 36px !important;
      }

      /* Header elements container - horizontal layout */
      #main-content > div:nth-child(2) {
        top: 8px !important;
        left: 8px !important;
        right: auto !important;
        flex-direction: row !important;
        gap: 0.5rem !important;
        align-items: center !important;
        max-width: calc(100vw - 120px) !important;
      }

      /* Hide combined profile button on mobile */
      #user-profile-combined {
        display: flex !important; /* Show on mobile */
        padding: 0.35rem 0.65rem 0.35rem 0.35rem !important;
        gap: 0.5rem !important;
      }
      
      #user-profile-combined > div:first-child {
        width: 32px !important;
        height: 32px !important;
        font-size: 0.8rem !important;
      }
      
      #user-profile-combined > div:last-child {
        font-size: 0.7rem !important;
      }
      
      #user-profile-combined > div:last-child > div:first-child {
        font-size: 0.75rem !important;
      }
      
      #user-profile-combined > div:last-child > div:last-child {
        font-size: 0.65rem !important;
      }

      /* Level badge - hide on mobile (shown in dropdown) */
      #level-badge-header {
        display: none !important;
      }

      /* Streak badge - hide on mobile (shown in dropdown) */
      #streak-badge-header {
        display: none !important;
      }

      /* Notification bell - compact */
      #notifications-bell {
        width: 40px !important;
        height: 40px !important;
        padding: 0.5rem !important;
      }

      #notifications-bell i {
        font-size: 1rem !important;
      }

      /* START button - compact */
      #btn-start-nav {
        width: 40px !important;
        height: 40px !important;
        padding: 0.5rem !important;
      }

      #btn-start-nav i {
        font-size: 1rem !important;
      }

      /* Refresh button - compact */
      #btn-refresh-network {
        width: 40px !important;
        height: 40px !important;
        padding: 0.5rem !important;
      }

      #btn-refresh-network i {
        font-size: 1rem !important;
      }

      /* Admin crown - compact */
      #btn-admin-top {
        width: 40px !important;
        height: 40px !important;
        padding: 0.5rem !important;
      }

      #btn-admin-top i {
        font-size: 1rem !important;
      }

      /* Placeholder circle - show on mobile for visual balance */
      #placeholder-circle {
        display: flex !important;
        width: 40px !important;
        height: 40px !important;
        padding: 0.5rem !important;
      }

      /* User menu - compact */
      #user-menu {
        padding: 0.35rem 0.65rem !important;
      }

      #user-avatar-header {
        width: 32px !important;
        height: 32px !important;
        font-size: 0.85rem !important;
      }

      /* Hide user name on mobile */
      #user-name-header {
        display: none !important;
      }

      /* Hide admin badge in header on mobile */
      #admin-badge-header {
        display: none !important;
      }

      /* Search container - move down significantly */
      #centered-search-container {
        bottom: 20px !important; /* Move to bottom with more space */
        width: calc(100vw - 20px) !important;
        max-width: calc(100vw - 20px) !important;
        left: 10px !important;
        right: 10px !important;
        transform: none !important;
        box-sizing: border-box !important;
      }

      #centered-search-container > div:first-child {
        flex-wrap: wrap !important;
        gap: 0.35rem !important;
        justify-content: flex-start !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
      }

      .search-category-btn {
        padding: 0.35rem 0.65rem !important;
        font-size: 0.7rem !important;
        white-space: nowrap !important;
      }

      #centered-search-container > div:nth-child(2) {
        padding: 0.5rem 0.75rem !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
      }

      #global-search {
        padding: 0.6rem 4rem 0.6rem 2.5rem !important;
        font-size: 16px !important; /* Prevents iOS zoom */
        max-width: 100% !important;
        box-sizing: border-box !important;
      }

      #search-button {
        padding: 0.5rem 0.75rem !important;
        font-size: 0.85rem !important;
      }

      /* Prevent keyboard from causing horizontal scroll */
      body.keyboard-open {
        position: fixed !important;
        width: 100% !important;
        overflow: hidden !important;
      }

      /* START button - compact */
      #btn-start-center {
        width: 140px !important;
        height: 140px !important;
      }

      #btn-start-center i {
        font-size: 2.2rem !important;
      }

      #btn-start-center span {
        font-size: 1.1rem !important;
      }

      /* Hide badges on mobile - they'll show in profile view */
      #level-badge-header,
      #streak-badge-header {
        display: none !important;
      }

      /* Show badges in dropdown on mobile */
      #dropdown-badges {
        display: flex !important;
      }

      /* Show badges in profile view on mobile */
      .mobile-only-badges {
        display: flex !important;
      }
    }

    @media (max-width: 480px) {
      #user-dropdown {
        position: fixed !important;
        top: 70px !important;
        right: 10px !important;
        left: 10px !important;
        min-width: auto !important;
      }
    }

  </style>
</head>

<body>
  <!-- Neural Background -->
  <canvas id="neural-bg"
    style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
    background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);"></canvas>

  <!-- Login -->
  <div id="login-section" class="active-tab-pane"
    style="position: fixed; inset: 0; width: 100vw; height: 100vh; height: calc(var(--vh, 1vh) * 100); display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
    z-index: 9999; overflow-y: auto; padding: 1.5rem 1rem; box-sizing: border-box; background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);">
    <div class="login-container">
      <img src="ieheader.webp"
           alt="CharlestonHacks Innovation Engine"
           style="max-width: 100%; height: auto; margin-bottom: 1rem;"
           onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
      <h1 style="display:none; color:#00e0ff; font-size:2rem; margin-bottom:1rem;">CharlestonHacks Innovation Engine</h1>

      <h2 style="color:#00e0ff; font-size:1.5rem; font-weight:bold; margin-bottom:0.75rem;">
        Making Invisible Networks Visible
      </h2>

      <p style="color:#ddd; font-size:1.1rem; line-height:1.6; margin-bottom:2rem; max-width:520px;">
        Discover people, skills, and collaboration opportunities in your innovation ecosystem.
        Connect with the right people, join projects, and build something amazing together.
      </p>

      <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:1.5rem; margin-bottom:2rem; max-width:620px;">
        <div style="text-align:center;">
          <i class="fas fa-network-wired" style="font-size:2rem; color:#00e0ff; margin-bottom:0.5rem;"></i>
          <div style="color:#ddd; font-size:0.9rem;">Visualize Your Network</div>
        </div>
        <div style="text-align:center;">
          <i class="fas fa-search" style="font-size:2rem; color:#00e0ff; margin-bottom:0.5rem;"></i>
          <div style="color:#ddd; font-size:0.9rem;">Find Skills & People</div>
        </div>
        <div style="text-align:center;">
          <i class="fas fa-users" style="font-size:2rem; color:#00e0ff; margin-bottom:0.5rem;"></i>
          <div style="color:#ddd; font-size:0.9rem;">Build Together</div>
        </div>
      </div>

      <div class="oauth-buttons">
        <button id="github-login" class="oauth-btn">
          <span class="oauth-icon-circle">
            <i class="fab fa-github"></i>
          </span>
          Continue with GitHub
        </button>
        <button id="google-login" class="oauth-btn">
          <span class="oauth-icon-circle">
            <i class="fab fa-google"></i>
          </span>
          Continue with Google
        </button>
      </div>

      <!-- Email / Password Login -->
      <div id="email-auth-section" style="margin-top:1.5rem; width:100%;">
        <div style="display:flex; align-items:center; gap:1rem; margin-bottom:1.25rem;">
          <hr style="flex:1; border:none; border-top:1px solid rgba(255,255,255,0.15);">
          <span style="color:#888; font-size:0.85rem; white-space:nowrap;">or sign in with email</span>
          <hr style="flex:1; border:none; border-top:1px solid rgba(255,255,255,0.15);">
        </div>
        <div style="display:flex; flex-direction:column; gap:0.75rem;">
          <input id="email-input" type="email" placeholder="Email address"
            style="width:100%; padding:0.875rem 1rem; background:rgba(255,255,255,0.07);
            border:1px solid rgba(0,224,255,0.25); border-radius:8px; color:#fff;
            font-size:1rem; outline:none; box-sizing:border-box;"
            onfocus="this.style.borderColor='rgba(0,224,255,0.6)'"
            onblur="this.style.borderColor='rgba(0,224,255,0.25)'" />
          <input id="password-input" type="password" placeholder="Password"
            style="width:100%; padding:0.875rem 1rem; background:rgba(255,255,255,0.07);
            border:1px solid rgba(0,224,255,0.25); border-radius:8px; color:#fff;
            font-size:1rem; outline:none; box-sizing:border-box;"
            onfocus="this.style.borderColor='rgba(0,224,255,0.6)'"
            onblur="this.style.borderColor='rgba(0,224,255,0.25)'" />
          <div id="email-auth-msg" style="display:none; font-size:0.875rem; text-align:left; padding:0.25rem 0;"></div>
          <button id="email-login-btn" class="oauth-btn"
            style="background:linear-gradient(135deg,rgba(0,224,255,0.1),rgba(0,128,255,0.1));
            border-color:rgba(0,224,255,0.35);">
            <span class="oauth-icon-circle">
              <i class="fas fa-envelope"></i>
            </span>
            Sign in with Email
          </button>
          <div style="text-align:right; margin-top:0.1rem;">
            <a id="forgot-password-link" href="#"
              style="color:#00e0ff; font-size:0.875rem; text-decoration:none; opacity:0.75;"
              onmouseover="this.style.opacity='1'"
              onmouseout="this.style.opacity='0.75'">Forgot password?</a>
          </div>
        </div>
      </div>

      <div id="login-hint" style="margin-top: 1rem; color: #aaa; font-size: 0.9rem;"></div>
    </div>
  </div>

  <!-- Main -->
  <div class="unified-main" id="main-content" style="position: fixed; inset: 0; overflow: hidden; background: #000000; width: 100vw; height: 100vh; height: calc(var(--vh, 1vh) * 100); max-width: 100vw; touch-action: pan-y pinch-zoom;">
    <!-- Header Elements (No Background Bar) -->
    <!-- Left side: Admin Crown, User Profile -->
    <div style="position:absolute; top:20px; left:20px; z-index:1000; display:flex; align-items:center; gap:1rem;">
      <!-- Admin Panel Button (Hidden by default) -->
      <div id="btn-admin-top-left" style="cursor:pointer; padding:0.75rem; background:rgba(255,170,0,0.1);
        border:1px solid rgba(255,170,0,0.3); border-radius:50%; width:48px; height:48px;
        display:none; align-items:center; justify-content:center;"
        title="Admin Panel">
        <i class="fas fa-crown" style="color:#ffa500; font-size:1.2rem;"></i>
      </div>

      <!-- Combined User Profile Button with Level Badge -->
      <div id="user-profile-combined" style="cursor:pointer; display:flex; align-items:center; gap:0.75rem; 
        padding:0.5rem 1rem 0.5rem 0.5rem; background:rgba(0,224,255,0.1); border:1px solid rgba(0,224,255,0.3); 
        border-radius:25px; transition:all 0.3s;"
        title="View your profile"
        onmouseenter="this.style.background='rgba(0,224,255,0.15)'; this.style.borderColor='rgba(0,224,255,0.5)'"
        onmouseleave="this.style.background='rgba(0,224,255,0.1)'; this.style.borderColor='rgba(0,224,255,0.3)'">
        <!-- User Avatar Circle -->
        <div style="width:40px; height:40px; border-radius:50%; 
          background:linear-gradient(135deg,#00e0ff,#0080ff); border:2px solid rgba(0,224,255,0.5);
          display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:0.9rem; color:white;">
          <span id="user-initials-left">DI</span>
        </div>
        <!-- Level Info -->
        <div style="display:flex; flex-direction:column; line-height:1.2;">
          <div class="level-display" style="color:#00e0ff; font-size:0.85rem; font-weight:700;">Level 1 <span style="color:#aaa; font-weight:400; font-size:0.75rem;">Newcomer</span></div>
          <div class="xp-display" style="color:#888; font-size:0.7rem;">0 / 100 XP</div>
        </div>
      </div>
    </div>

    <div style="position:absolute; top:20px; right:20px; z-index:1000; display:flex; align-items:center; gap:1rem;">
      <!-- START Button (Green Circle) -->
      <div id="btn-start-nav" style="cursor:pointer; padding:0.75rem; background:rgba(0,255,136,0.1);
        border:1px solid rgba(0,255,136,0.3); border-radius:50%; width:48px; height:48px;
        display:flex; align-items:center; justify-content:center; position:relative;"
        title="View START sequence" onclick="if(window.EnhancedStartUI && window.EnhancedStartUI.open) { window.EnhancedStartUI.open(); }">
        <i class="fas fa-play-circle" style="color:#00ff88; font-size:1.2rem;"></i>
        <span class="start-updates-badge hidden" id="start-updates-count"
          style="position:absolute; top:-5px; right:-5px; background:#00ff88; color:#000;
          font-size:0.7rem; font-weight:bold; padding:2px 6px; border-radius:10px; min-width:18px; text-align:center;">0</span>
      </div>

      <!-- Notification Bell (Hidden - replaced by unified notification system) -->
      <div id="notification-bell" style="display:none;">
        <i class="fas fa-bell" style="color:#00e0ff; font-size:1.2rem;"></i>
      </div>

      <!-- Refresh Network Button -->
      <div id="btn-refresh-network" style="cursor:pointer; padding:0.75rem; background:rgba(0,224,255,0.1);
        border:1px solid rgba(0,224,255,0.3); border-radius:50%; width:48px; height:48px;
        display:flex; align-items:center; justify-content:center; position:relative;"
        title="Refresh network view">
        <i class="fas fa-sync-alt" id="refresh-icon-header" style="color:#00e0ff; font-size:1.2rem;"></i>
      </div>

      <!-- Logout Button -->
      <div id="btn-logout-header" onclick="if(window.handleLogout) { if(confirm('Are you sure you want to logout?')) window.handleLogout(); }" 
        style="cursor:pointer; padding:0.75rem; background:rgba(255,107,107,0.1);
        border:1px solid rgba(255,107,107,0.3); border-radius:50%; width:48px; height:48px;
        display:flex; align-items:center; justify-content:center; transition:all 0.2s;"
        onmouseenter="this.style.background='rgba(255,107,107,0.2)'; this.style.borderColor='rgba(255,107,107,0.5)'"
        onmouseleave="this.style.background='rgba(255,107,107,0.1)'; this.style.borderColor='rgba(255,107,107,0.3)'"
        title="Logout">
        <i class="fas fa-sign-out-alt" style="color:#ff6b6b; font-size:1.2rem;"></i>
      </div>

      <!-- Admin Panel Button (Hidden - moved to left side) -->
      <div id="btn-admin-top" style="display:none;">
      </div>

      <!-- User Profile with Dropdown (Hidden - moved to left side) -->
      <div id="user-menu-container-right" style="display:none;">
        <div id="user-menu" style="cursor:pointer; padding:0.5rem 1rem; background:rgba(0,224,255,0.1);
          border:1px solid rgba(0,224,255,0.3); border-radius:25px; display:flex; align-items:center; gap:0.75rem;
          transition:all 0.3s;"
          title="View your profile">
          <div style="width:36px; height:36px; border-radius:50%; background:linear-gradient(135deg,#00e0ff,#0080ff);
            display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:0.9rem;" id="user-avatar-header">
            <span id="user-initials-header">?</span>
          </div>
          <span id="user-name-header" style="color:#fff; font-weight:600;">Loading...</span>
          <!-- Admin Badge (shown for admins) -->
          <span id="admin-badge-header" style="display:none; background:rgba(255,170,0,0.2); color:#ffa500; 
            font-size:0.7rem; font-weight:700; padding:0.25rem 0.5rem; border-radius:4px; border:1px solid rgba(255,170,0,0.4);">
            ADMIN
          </span>
          <i class="fas fa-chevron-down" id="user-menu-chevron" style="color:#00e0ff; font-size:0.9rem; transition:transform 0.3s;"></i>
        </div>

        <!-- Dropdown Menu -->
        <div id="user-dropdown" style="
          position:absolute;
          top:calc(100% + 0.5rem);
          right:0;
          min-width:220px;
          background:linear-gradient(135deg, rgba(10,14,39,0.98), rgba(16,20,39,0.98));
          border:2px solid rgba(0,224,255,0.4);
          border-radius:12px;
          padding:0.5rem;
          display:none;
          flex-direction:column;
          gap:0.25rem;
          box-shadow:0 8px 32px rgba(0,0,0,0.6), 0 0 20px rgba(0,224,255,0.2);
          backdrop-filter:blur(10px);
          z-index:10000;
          animation:dropdownFadeIn 0.2s ease;
        ">
          <!-- Level and Streak Badges (mobile only) -->
          <div id="dropdown-badges" style="display:none; flex-direction:column; gap:0.5rem; padding:0.5rem; margin-bottom:0.5rem; border-bottom:1px solid rgba(255,255,255,0.1);">
            <!-- Level Badge -->
            <div style="padding:0.5rem 0.75rem; background:rgba(0,224,255,0.15); border:1px solid rgba(0,224,255,0.3); border-radius:8px; display:flex; justify-content:space-between; align-items:center;">
              <div>
                <div style="color:#00e0ff; font-size:0.75rem; font-weight:600;">Level 6</div>
                <div style="color:#aaa; font-size:0.65rem;">Leader</div>
              </div>
              <div style="color:#888; font-size:0.6rem;">2173 / 5000 XP</div>
            </div>
            <!-- Streak Badge -->
            <div style="padding:0.5rem 0.75rem; background:rgba(255,59,48,0.15); border:1px solid rgba(255,59,48,0.3); border-radius:8px; display:flex; align-items:center; gap:0.5rem;">
              <i class="fas fa-fire" style="color:#ff3b30; font-size:1rem;"></i>
              <div style="flex:1;">
                <div style="color:#ff3b30; font-size:0.75rem; font-weight:700;">25 Day Streak</div>
                <div style="color:#ff8a80; font-size:0.6rem;">Keep it going!</div>
              </div>
            </div>
          </div>

          <!-- Profile Option -->
          <button id="dropdown-profile" style="
            width:100%;
            padding:0.75rem 1rem;
            background:transparent;
            border:none;
            border-radius:8px;
            color:#fff;
            font-size:0.95rem;
            font-weight:500;
            cursor:pointer;
            display:flex;
            align-items:center;
            gap:0.75rem;
            transition:all 0.2s;
            text-align:left;
          ">
            <i class="fas fa-user" style="color:#00e0ff; font-size:1.1rem; width:20px;"></i>
            <span>View Profile</span>
          </button>

          <!-- Settings Option -->
          <button id="dropdown-settings" style="
            width:100%;
            padding:0.75rem 1rem;
            background:transparent;
            border:none;
            border-radius:8px;
            color:#fff;
            font-size:0.95rem;
            font-weight:500;
            cursor:pointer;
            display:flex;
            align-items:center;
            gap:0.75rem;
            transition:all 0.2s;
            text-align:left;
          ">
            <i class="fas fa-cog" style="color:#00e0ff; font-size:1.1rem; width:20px;"></i>
            <span>Settings</span>
            <!-- Admin indicator in settings (shown for admins) -->
            <span id="admin-settings-indicator" style="display:none; margin-left:auto; background:rgba(255,170,0,0.2); 
              color:#ffa500; font-size:0.65rem; font-weight:700; padding:0.2rem 0.4rem; border-radius:3px; 
              border:1px solid rgba(255,170,0,0.4);">
              ADMIN
            </span>
          </button>

          <!-- Divider -->
          <div style="height:1px; background:rgba(255,255,255,0.1); margin:0.25rem 0;"></div>

          <!-- Logout Option -->
          <button id="dropdown-logout" style="
            width:100%;
            padding:0.75rem 1rem;
            background:transparent;
            border:none;
            border-radius:8px;
            color:#ff6b6b;
            font-size:0.95rem;
            font-weight:600;
            cursor:pointer;
            display:flex;
            align-items:center;
            gap:0.75rem;
            transition:all 0.2s;
            text-align:left;
          ">
            <i class="fas fa-sign-out-alt" style="color:#ff6b6b; font-size:1.1rem; width:20px;"></i>
            <span>Logout</span>
          </button>
        </div>
      </div>
    </div>

    <div id="synapse-main-view" style="position:absolute; inset:0; z-index:1; background: #000000; overflow: hidden; touch-action: pan-y pinch-zoom;">
      <svg id="synapse-svg" style="width:100%; height:100%; background: #000000; touch-action: none;"></svg>
    </div>

    <!-- Centered Round START Button with Background Panel (HIDDEN - replaced by nav button) -->
    <div id="start-button-container" style="position:fixed; top:0; left:0; width:100vw; height:100vh; height: calc(var(--vh, 1vh) * 100);
      z-index:1000; display:none; align-items:center; justify-content:center;">
      
      <!-- Background Panel with 75% opacity -->
      <div style="position:absolute; inset:0; background:rgba(10,14,39,0.75); backdrop-filter:blur(10px);"></div>
      
      <!-- Content Container -->
      <div style="position:relative; display:flex; flex-direction:column; align-items:center; gap:1.5rem;">
        <button id="btn-start-center"
          style="background:linear-gradient(135deg, rgba(0,255,136,0.3), rgba(0,224,255,0.25));
          border:3px solid rgba(0,255,136,0.6); border-radius:50%; color:#00ff88; font-weight:700; font-size:1.5rem;
          cursor:pointer; transition:all 0.3s; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:0.5rem;
          box-shadow:0 8px 30px rgba(0,255,136,0.4); padding:0; width:200px; height:200px; opacity:0.75;"
          title="Start your journey">
          <i class="fas fa-play-circle" style="font-size:3rem;"></i>
          <span style="font-size:1.5rem;">START</span>
        </button>
      </div>
    </div>

    <!-- Category Filter Buttons (Bottom Center) -->
    <div id="centered-search-container"
      style="position:absolute; bottom:100px; left:50%; transform:translateX(-50%);
      width:min(700px, 85vw); max-width:min(700px, 85vw); z-index:100; display:flex; flex-direction:column; align-items:center; gap:0.75rem;">

      <!-- Category Filter Buttons -->
      <div style="display:flex; gap:0.5rem; flex-wrap:wrap; justify-content:center; max-width:100%;">
        <button class="search-category-btn" data-category="all"
          style="padding:0.5rem 1rem; background:linear-gradient(135deg,#00e0ff,#0080ff); border:none; border-radius:20px;
          color:white; cursor:pointer; font-weight:600; font-size:0.8rem; transition:all 0.2s;">
          <i class="fas fa-globe"></i> All
        </button>
        <button class="search-category-btn" data-category="people"
          style="padding:0.5rem 1rem; background:rgba(0,224,255,0.15); border:1px solid rgba(0,224,255,0.3); border-radius:20px;
          color:#00e0ff; cursor:pointer; font-weight:600; font-size:0.8rem; transition:all 0.2s;">
          <i class="fas fa-users"></i> People
        </button>
        <button class="search-category-btn" data-category="organizations"
          style="padding:0.5rem 1rem; background:rgba(168,85,247,0.15); border:1px solid rgba(168,85,247,0.3); border-radius:20px;
          color:#a855f7; cursor:pointer; font-weight:600; font-size:0.8rem; transition:all 0.2s;">
          <i class="fas fa-building"></i> Organizations
        </button>
        <button class="search-category-btn" data-category="projects"
          style="padding:0.5rem 1rem; background:rgba(0,255,136,0.15); border:1px solid rgba(0,255,136,0.3); border-radius:20px;
          color:#00ff88; cursor:pointer; font-weight:600; font-size:0.8rem; transition:all 0.2s;">
          <i class="fas fa-lightbulb"></i> Projects
        </button>
        <button class="search-category-btn" data-category="themes"
          style="padding:0.5rem 1rem; background:rgba(255,170,0,0.15); border:1px solid rgba(255,170,0,0.3); border-radius:20px;
          color:#ffaa00; cursor:pointer; font-weight:600; font-size:0.8rem; transition:all 0.2s;">
          <i class="fas fa-palette"></i> Themes
        </button>
        <!-- Discovery Mode is now always on - visual indicators show connection status -->
      </div>

      <!-- Search Input -->
      <div id="search-container" style="position: relative; width:100%; max-width:100%; background:rgba(10,14,39,0.6); padding:0.75rem 1rem; border-radius:12px;
        border:2px solid rgba(0,224,255,0.3); backdrop-filter:blur(10px); box-shadow:0 4px 20px rgba(0,224,255,0.3);">
        <i class="fas fa-search"
           style="position:absolute; left:1.5rem; top:50%; transform:translateY(-50%); color:#00e0ff; pointer-events:none; z-index:1;"></i>
        <input type="text" id="global-search" placeholder="Search everything..."
          autocomplete="off"
          style="width:100%; padding:0.75rem 5rem 0.75rem 3rem; background:rgba(0,0,0,0.4);
          border:1px solid rgba(0,224,255,0.3); border-radius:8px; color:#fff; font-size:16px; outline:none;">
        <button id="search-button"
          style="position:absolute; right:1.25rem; top:50%; transform:translateY(-50%);
          background:linear-gradient(135deg,#00e0ff,#0080ff); border:none; padding:0.6rem 1rem; border-radius:8px;
          color:white; cursor:pointer; font-weight:600; font-size:0.9rem; transition:all 0.2s; z-index:1;">
          <i class="fas fa-search"></i>
        </button>
        
        <!-- Predictive Search Suggestions Dropdown -->
        <div id="search-suggestions" style="display:none; position:absolute; left:1rem; right:1rem;
          background:rgba(10,14,39,0.98); border:2px solid rgba(0,224,255,0.4); border-radius:12px;
          max-height:min(400px, 60vh); overflow-y:auto; -webkit-overflow-scrolling:touch; z-index:1000; 
          box-shadow:0 8px 32px rgba(0,224,255,0.3);"></div>
      </div>
      
      <style>
        /* Default: Show suggestions below search field on desktop */
        #search-suggestions {
          top: calc(100% + 0.5rem);
          bottom: auto;
        }

        /* Desktop: Shift search container up when showing suggestions */
        #centered-search-container.showing-suggestions {
          bottom: 40vh !important;
          transition: bottom 0.3s ease;
        }

        /* Responsive styles for search suggestions */
        @media (max-width: 768px) {
          /* On mobile, show suggestions ABOVE search field to avoid keyboard */
          #search-suggestions {
            top: auto !important;
            bottom: calc(100% + 0.5rem) !important;
            left: 0.5rem !important;
            right: 0.5rem !important;
            max-height: min(350px, 50vh) !important;
          }
          
          .search-suggestion-item {
            padding: 0.6rem 0.75rem !important;
          }
          
          .search-suggestion-item img,
          .search-suggestion-item > div:first-child {
            width: 35px !important;
            height: 35px !important;
          }
          
          .search-suggestion-item .fas.fa-arrow-right {
            display: none !important;
          }

          /* Shift search container up when keyboard is open */
          #centered-search-container.keyboard-open {
            bottom: 50vh !important;
            transition: bottom 0.3s ease;
          }
        }
        
        @media (max-width: 480px) {
          #search-suggestions {
            max-height: min(300px, 45vh) !important;
            font-size: 0.85rem;
          }
          
          .search-suggestion-item {
            padding: 0.5rem !important;
            gap: 0.75rem !important;
          }
          
          .search-suggestion-item img,
          .search-suggestion-item > div:first-child {
            width: 32px !important;
            height: 32px !important;
          }

          /* More aggressive shift on small screens */
          #centered-search-container.keyboard-open {
            bottom: 55vh !important;
          }
        }
        
        /* Smooth scrolling for suggestions */
        #search-suggestions {
          scrollbar-width: thin;
          scrollbar-color: rgba(0,224,255,0.3) rgba(0,0,0,0.2);
        }
        
        #search-suggestions::-webkit-scrollbar {
          width: 6px;
        }
        
        #search-suggestions::-webkit-scrollbar-track {
          background: rgba(0,0,0,0.2);
          border-radius: 10px;
        }
        
        #search-suggestions::-webkit-scrollbar-thumb {
          background: rgba(0,224,255,0.3);
          border-radius: 10px;
        }
        
        #search-suggestions::-webkit-scrollbar-thumb:hover {
          background: rgba(0,224,255,0.5);
        }
      </style>
    </div>
  </div>

  <!--Hidden elements for compatibility -->
  <div id="main-header" class="hidden"></div>
  <button id="logout-btn" style="display:none;"></button>
  <button id="btn-start-header" style="display:none;"></button>
  <button id="btn-start-fullwidth" style="display:none;"></button>
  <button id="btn-messages" style="display:none;"></button>
  <button id="btn-projects-modal" style="display:none;"></button>
  <button id="btn-endorsements" style="display:none;"></button>
  <button id="fab-bbs-trigger" style="display:none;"></button>

  <!-- Profile Modal -->
  <div class="modal" id="profile-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeProfileModal()"><i class="fas fa-times"></i></button>
      <div id="modal-profile-content"></div>
    </div>
  </div>

  <script>
    // Hide search container when any modal opens
    (function() {
      const searchContainer = document.getElementById('centered-search-container');
      
      if (!searchContainer) {
        console.warn('âš ï¸ Search container not found');
        return;
      }
      
      // Function to check if any modal is open
      function updateSearchVisibility() {
        const anyModalOpen = document.querySelector('.modal.active');
        const isModalOpen = !!anyModalOpen;
        
        if (searchContainer) {
          searchContainer.style.display = isModalOpen ? 'none' : 'flex';
          console.log(`ðŸ” Search container ${isModalOpen ? 'hidden' : 'visible'} (modal ${isModalOpen ? 'open' : 'closed'})`);
        }
      }
      
      // Watch for modal class changes
      const observer = new MutationObserver(() => {
        updateSearchVisibility();
      });
      
      // Observe all modals
      document.querySelectorAll('.modal').forEach(modal => {
        observer.observe(modal, { attributes: true, attributeFilter: ['class'] });
      });
      
      // Also check on page load
      setTimeout(updateSearchVisibility, 100);
      
      console.log('âœ… Search container visibility controller initialized');
    })();
  </script>

  <!-- Messages Modal -->
  <div class="modal" id="messages-modal">
    <div class="modal-content messages-modal-content" style="max-width: 1000px; max-height: 80vh;">
      <button class="modal-close" onclick="closeMessagesModal()"><i class="fas fa-times"></i></button>

      <!-- Container for messaging.js to render into -->
      <div id="messages-container"></div>
    </div>
  </div>

  <!-- Projects Modal -->
  <div class="modal" id="projects-modal">
    <div class="modal-content" style="max-width: 800px;">
      <button class="modal-close" onclick="closeProjectsModal()"><i class="fas fa-times"></i></button>
      <h2 style="color:#00e0ff; margin-bottom:1.5rem;"><i class="fas fa-lightbulb"></i> Projects</h2>

      <div style="margin-bottom:1.5rem;">
        <button onclick="showCreateProjectForm()" class="btn btn-primary"><i class="fas fa-plus"></i> New Project</button>
      </div>

      <div id="project-form" style="display:none; background: rgba(0,224,255,0.05); border:1px solid rgba(0,224,255,0.2);
          border-radius:12px; padding:1.5rem; margin-bottom:1.5rem;">
        <h3 style="color:#00e0ff; margin-bottom:1rem;">Create New Project</h3>
        <form onsubmit="createProject(event)">
          <div style="margin-bottom:1rem;">
            <label style="display:block; color:#aaa; margin-bottom:0.5rem;">Project Name *</label>
            <input type="text" id="project-name" required
                   style="width:100%; padding:0.75rem; background: rgba(0,224,255,0.05);
                   border:1px solid rgba(0,224,255,0.2); border-radius:8px; color:white; font-family:inherit;">
          </div>

          <div style="margin-bottom:1rem;">
            <label style="display:block; color:#aaa; margin-bottom:0.5rem;">Description *</label>
            <textarea id="project-description" rows="3" required
              style="width:100%; padding:0.75rem; background: rgba(0,224,255,0.05);
              border:1px solid rgba(0,224,255,0.2); border-radius:8px; color:white; font-family:inherit; resize:vertical;"></textarea>
          </div>

          <div style="margin-bottom:1rem;">
            <label style="display:block; color:#aaa; margin-bottom:0.5rem;">Required Skills (comma-separated)</label>
            <input type="text" id="project-skills" placeholder="e.g., JavaScript, React, Design"
                   style="width:100%; padding:0.75rem; background: rgba(0,224,255,0.05);
                   border:1px solid rgba(0,224,255,0.2); border-radius:8px; color:white; font-family:inherit;">
          </div>

          <div style="margin-bottom:1rem;">
            <label style="display:block; color:#aaa; margin-bottom:0.5rem;">
              <i class="fas fa-bullseye" style="color:#00e0ff;"></i> Associate with Theme Circle (optional)
            </label>
            <select id="project-theme"
                    style="width:100%; padding:0.75rem; background: rgba(0,224,255,0.05);
                    border:1px solid rgba(0,224,255,0.2); border-radius:8px; color:white; font-family:inherit;">
              <option value="">No theme (standalone project)</option>
            </select>
            <small style="color:#888; display:block; margin-top:0.3rem;">
              Link this project to an active theme to help others find it
            </small>
          </div>

          <div style="display:flex; gap:0.5rem;">
            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Create Project</button>
            <button type="button" onclick="hideCreateProjectForm()" class="btn" style="background:rgba(255,255,255,0.1);">Cancel</button>
          </div>
        </form>
      </div>

      <div id="projects-list" style="max-height: 400px; overflow-y:auto;"></div>
    </div>
  </div>

  <!-- Endorsements Modal -->
  <div class="modal" id="endorsements-modal">
    <div class="modal-content" style="max-width: 700px;">
      <button class="modal-close" onclick="closeEndorsementsModal()"><i class="fas fa-times"></i></button>
      <h2 style="color:#00e0ff; margin-bottom:1.5rem;"><i class="fas fa-star"></i> Endorsements</h2>

      <div style="margin-bottom:2rem;">
        <div style="display:flex; gap:0.5rem; margin-bottom:1rem;">
          <button onclick="showEndorsementsTab('received')" id="endorsements-tab-received"
                  style="flex:1; padding:0.75rem; background:linear-gradient(135deg,#00e0ff,#0080ff);
                  border:none; border-radius:8px; color:white; cursor:pointer; font-weight:bold;">Received</button>
          <button onclick="showEndorsementsTab('given')" id="endorsements-tab-given"
                  style="flex:1; padding:0.75rem; background:rgba(255,255,255,0.1); border:1px solid rgba(0,224,255,0.2);
                  border-radius:8px; color:white; cursor:pointer;">Given</button>
        </div>

        <div id="endorsements-received" style="max-height:400px; overflow-y:auto;"></div>
        <div id="endorsements-given" style="display:none; max-height:400px; overflow-y:auto;"></div>
      </div>
    </div>
  </div>

  <!-- Network Stats Modal -->
  <div class="modal" id="network-stats-modal">
    <div class="modal-content" style="max-width: 800px;">
      <button class="modal-close" onclick="closeNetworkStatsModal()">
        <i class="fas fa-times"></i>
      </button>
      <h2 style="color: #00e0ff; margin-bottom: 1.5rem;">
        <i class="fas fa-users"></i> Your Network Stats
      </h2>

      <div id="network-stats-content" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
        <div style="text-align: center; color: #aaa; padding: 3rem;">
          <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: #00e0ff;"></i>
          <p style="margin-top: 1rem;">Loading network stats...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Connect Modal -->
  <div class="modal" id="quick-connect-modal">
    <div class="modal-content" style="max-width: 1000px; max-height: 85vh;">
      <button class="modal-close" onclick="closeQuickConnectModal()"><i class="fas fa-times"></i></button>
      <h2 id="quick-connect-title" style="color:#00e0ff; margin-bottom:1rem;"><i class="fas fa-search"></i> Search Results</h2>
      <p id="quick-connect-subtitle" style="color:#aaa; margin-bottom:1.5rem;">Showing results across all categories</p>
      <div id="quick-connect-list" style="max-height: 65vh; overflow-y:auto;"></div>
    </div>
  </div>

  <!-- Notification Center Modal -->
  <div class="modal" id="notification-center-modal">
    <div class="modal-content" style="max-width: 700px;">
      <button class="modal-close" onclick="closeNotificationCenter()"><i class="fas fa-times"></i></button>
      <h2 style="color:#00e0ff; margin-bottom:1.5rem;"><i class="fas fa-bell"></i> Notifications</h2>

      <div style="margin-bottom:1.5rem;">
        <div style="display:flex; gap:0.5rem; margin-bottom:1rem;">
          <button onclick="showNotificationsTab('all')" id="notifications-tab-all"
                  style="flex:1; padding:0.75rem; background:linear-gradient(135deg,#00e0ff,#0080ff);
                  border:none; border-radius:8px; color:white; cursor:pointer; font-weight:bold;">All</button>
          <button onclick="showNotificationsTab('unread')" id="notifications-tab-unread"
                  style="flex:1; padding:0.75rem; background:rgba(255,255,255,0.1); border:1px solid rgba(0,224,255,0.2);
                  border-radius:8px; color:white; cursor:pointer;">Unread</button>
        </div>

        <div id="notifications-all" style="max-height:400px; overflow-y:auto;"></div>
        <div id="notifications-unread" style="display:none; max-height:400px; overflow-y:auto;"></div>
      </div>

      <div style="text-align:center; padding-top:1rem; border-top:1px solid rgba(255,255,255,0.1);">
        <button onclick="clearAllNotifications()" style="padding:0.5rem 1.5rem; background:rgba(255,255,255,0.1);
          border:1px solid rgba(0,224,255,0.2); border-radius:8px; color:#00e0ff; cursor:pointer;">
          <i class="fas fa-check-double"></i> Mark All as Read
        </button>
      </div>
    </div>
  </div>

  <!-- BBS Modal -->
  <div id="bbs-modal"></div>

  <!-- Mentor Panels - Daily Briefing Contextual Overlays -->

  <!-- Panel 1: Your Focus Today -->
  <div id="mentor-panel-focus" class="mentor-panel mentor-panel-draggable" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
    width:min(650px, 92vw); max-width:650px; max-height:85vh; background:linear-gradient(135deg, rgba(10,14,39,0.75), rgba(16,20,39,0.75));
    border:2px solid rgba(0,224,255,0.25); border-radius:16px; padding:2rem; z-index:10001; overflow-y:auto;
    box-shadow:0 20px 60px rgba(0,0,0,0.4), 0 0 40px rgba(0,224,255,0.1); backdrop-filter:blur(20px);">

    <!-- Drag Handle -->
    <div class="mentor-panel-drag-handle" style="position:absolute; top:0; left:0; right:0; height:3rem; cursor:move; display:flex; align-items:center; justify-content:center; padding:0.5rem;">
      <div style="width:40px; height:4px; background:rgba(255,255,255,0.2); border-radius:2px;"></div>
    </div>

    <button class="mentor-panel-close" onclick="closeMentorPanel('focus')"
      style="position:absolute; top:1rem; right:1rem; width:36px; height:36px; background:rgba(255,255,255,0.1);
      border:1px solid rgba(255,255,255,0.2); border-radius:50%; color:rgba(255,255,255,0.7); cursor:pointer;
      display:flex; align-items:center; justify-content:center; transition:all 0.2s; z-index:1;">
      <i class="fas fa-times"></i>
    </button>

    <h2 style="color:#00e0ff; margin-bottom:0.5rem; font-size:clamp(1.2rem, 4vw, 1.5rem); font-weight:600; margin-top:2rem;">
      <i class="fas fa-compass" style="margin-right:0.5rem;"></i>
      Your focus today
    </h2>
    <p style="color:rgba(255,255,255,0.5); margin-bottom:2rem; font-size:clamp(0.8rem, 3vw, 0.9rem);">
      Where your interests and activity currently overlap
    </p>

    <div id="mentor-focus-content"></div>
  </div>

  <!-- Panel 2: Projects Gaining Momentum -->
  <div id="mentor-panel-projects" class="mentor-panel mentor-panel-draggable" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
    width:min(650px, 92vw); max-width:650px; max-height:85vh; background:linear-gradient(135deg, rgba(10,14,39,0.75), rgba(16,20,39,0.75));
    border:2px solid rgba(0,224,255,0.25); border-radius:16px; padding:2rem; z-index:10001; overflow-y:auto;
    box-shadow:0 20px 60px rgba(0,0,0,0.4), 0 0 40px rgba(0,224,255,0.1); backdrop-filter:blur(20px);">

    <!-- Drag Handle -->
    <div class="mentor-panel-drag-handle" style="position:absolute; top:0; left:0; right:0; height:3rem; cursor:move; display:flex; align-items:center; justify-content:center; padding:0.5rem;">
      <div style="width:40px; height:4px; background:rgba(255,255,255,0.2); border-radius:2px;"></div>
    </div>

    <button class="mentor-panel-close" onclick="closeMentorPanel('projects')"
      style="position:absolute; top:1rem; right:1rem; width:36px; height:36px; background:rgba(255,255,255,0.1);
      border:1px solid rgba(255,255,255,0.2); border-radius:50%; color:rgba(255,255,255,0.7); cursor:pointer;
      display:flex; align-items:center; justify-content:center; transition:all 0.2s; z-index:1;">
      <i class="fas fa-times"></i>
    </button>

    <h2 style="color:#00e0ff; margin-bottom:0.5rem; font-size:clamp(1.2rem, 4vw, 1.5rem); font-weight:600; margin-top:2rem;">
      <i class="fas fa-rocket" style="margin-right:0.5rem;"></i>
      Projects gaining momentum
    </h2>
    <p style="color:rgba(255,255,255,0.5); margin-bottom:2rem; font-size:clamp(0.8rem, 3vw, 0.9rem);">
      Places where people are already building
    </p>

    <div id="mentor-projects-content"></div>
  </div>

  <!-- Panel 3: People Worth Knowing -->
  <div id="mentor-panel-people" class="mentor-panel mentor-panel-draggable" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
    width:min(650px, 92vw); max-width:650px; max-height:85vh; background:linear-gradient(135deg, rgba(10,14,39,0.75), rgba(16,20,39,0.75));
    border:2px solid rgba(0,224,255,0.25); border-radius:16px; padding:2rem; z-index:10001; overflow-y:auto;
    box-shadow:0 20px 60px rgba(0,0,0,0.4), 0 0 40px rgba(0,224,255,0.1); backdrop-filter:blur(20px);">

    <!-- Drag Handle -->
    <div class="mentor-panel-drag-handle" style="position:absolute; top:0; left:0; right:0; height:3rem; cursor:move; display:flex; align-items:center; justify-content:center; padding:0.5rem;">
      <div style="width:40px; height:4px; background:rgba(255,255,255,0.2); border-radius:2px;"></div>
    </div>

    <button class="mentor-panel-close" onclick="closeMentorPanel('people')"
      style="position:absolute; top:1rem; right:1rem; width:36px; height:36px; background:rgba(255,255,255,0.1);
      border:1px solid rgba(255,255,255,0.2); border-radius:50%; color:rgba(255,255,255,0.7); cursor:pointer;
      display:flex; align-items:center; justify-content:center; transition:all 0.2s; z-index:1;">
      <i class="fas fa-times"></i>
    </button>

    <h2 style="color:#00e0ff; margin-bottom:0.5rem; font-size:clamp(1.2rem, 4vw, 1.5rem); font-weight:600; margin-top:2rem;">
      <i class="fas fa-users" style="margin-right:0.5rem;"></i>
      People worth knowing
    </h2>
    <p style="color:rgba(255,255,255,0.5); margin-bottom:2rem; font-size:clamp(0.8rem, 3vw, 0.9rem);">
      Connected through your projects and themes
    </p>

    <div id="mentor-people-content"></div>
  </div>

  <!-- Mentor Panel Backdrop -->
  <div id="mentor-panel-backdrop" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.75);
    backdrop-filter:blur(4px); z-index:10000;" onclick="closeAllMentorPanels()"></div>

  <!-- START Modal - Simplified and Efficient -->
  <div id="start-modal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%) scale(0.95);
    width:auto; max-width:min(600px, 90vw); max-height:90vh; 
    background:linear-gradient(135deg, rgba(10,14,39,0.95), rgba(16,20,39,0.95));
    border:2px solid rgba(0,255,136,0.4); border-radius:16px; padding:2rem; z-index:10002; 
    overflow-y:auto; box-shadow:0 20px 60px rgba(0,0,0,0.8), 0 0 40px rgba(0,255,136,0.2);
    backdrop-filter:blur(20px); opacity:0; transition:all 0.3s ease;">

    <!-- Close Button -->
    <button class="mentor-panel-close" onclick="closeStartModal()"
      style="position:absolute; top:1rem; right:1rem; 
      background:rgba(255,102,102,0.2); border:1px solid rgba(255,102,102,0.4);
      border-radius:50%; width:36px; height:36px; 
      display:flex; align-items:center; justify-content:center; cursor:pointer; color:#f66;
      font-size:1.2rem; transition:all 0.2s;">
      <i class="fas fa-times"></i>
    </button>

    <!-- Header -->
    <div style="text-align:center; margin-bottom:2rem;">
      <div style="font-size:3rem; color:#00ff88; margin-bottom:0.5rem;">
        <i class="fas fa-play-circle"></i>
      </div>
      <h2 style="color:#00ff88; font-size:2rem; margin:0 0 0.5rem 0; font-weight:700;">Your focus today</h2>
      <p style="color:rgba(255,255,255,0.6); font-size:1rem; margin:0;">Based on your activity and interests</p>
    </div>

    <!-- Dynamic Recommendations Container -->
    <div id="start-options-container" style="display:flex; flex-direction:column; gap:1rem; margin-bottom:1.5rem;">
      <!-- Populated by start-ui-enhanced.js -->
      <!-- Note: "Go to Dashboard" and "Download Report" buttons are rendered by start-ui-enhanced.js -->
    </div>
  </div>

  <!-- START Modal Backdrop -->
  <div id="start-modal-backdrop" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5);
    backdrop-filter:blur(5px); z-index:10001;"></div>

   <!-- External libs (ONLY ONCE) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>

  <!-- Centralized Logger (MUST LOAD FIRST) -->
  <!-- Boot diagnostics: must be first JS â€” stamps BUILD_ID banner and watches key globals -->
  <script src="assets/js/boot-diagnostics.js?v=20260220-1"></script>

  <script type="module" src="assets/js/logger.js?v=fc09b39b-17701461547"></script>
  
  <!-- Animation Lifecycle Controller (MUST LOAD EARLY) -->
  <script type="module" src="assets/js/animation-lifecycle.js?v=1"></script>

  <!-- Boot Gate (Auth-Aware Boot Coordinator) -->
  <script src="assets/js/boot-gate.js?v=1"></script>

  <!-- Required base modules -->
  <!-- Cache-busting using git commit hash - changes on every deploy -->
  <script type="module" src="assets/js/supabaseClient.js?v=fc09b39b-1770146154f916933b2da"></script>
  
  <!-- âœ… SUPABASE OPTIMIZATION: Bootstrap Session (Single Source of Truth) -->
  <script src="assets/js/bootstrapSession.js?v=6e6a1b33"></script>
  
  <!-- âœ… SUPABASE OPTIMIZATION: Realtime Manager (Subscription Deduping) -->
  <script src="assets/js/realtimeManager.js?v=6e6a1b33"></script>
  
  <!-- âœ… SUPABASE OPTIMIZATION: Migration Helper (Temporary Compatibility) -->
  <script src="assets/js/migrationHelper.js?v=phase2"></script>
  
  <!-- âœ… SUPABASE OPTIMIZATION: Startup Metrics (Dev Only) -->
  <script src="assets/js/startupMetrics.js?v=6e6a1b33"></script>
  
  <!-- Realtime Helper (load early for all subscriptions) -->
  <script type="module">
    import * as realtimeHelper from './assets/js/realtime-helper.js?v=fc09b39b-1770146154f916933b2da';
    window.realtimeHelper = realtimeHelper;
  </script>

  <!-- Non-module scripts with commit-based cache-busting -->
  <script src="assets/js/ecosystem-connector.js?v=fc09b39b-1770146154f916933b2da"></script>

  <!-- Feature modules with commit-based cache-busting -->
  <script type="module" src="assets/js/onboarding.js?v=fc09b39b-1770146154f916933b2da"></script>
  <!-- node-panel.js loaded dynamically by dashboardPane.js -->
  <!--  <script type="module" src="assets/js/node-panel.js?v=66d4b925-20260205"></script> -->
  <script type="module" src="assets/js/network-filters.js?v=fc09b39b-1770146154f916933b2da"></script>
  <script type="module" src="assets/js/graph-legend.js?v=fc09b39b-1770146154f916933b2da"></script>
  <script type="module" src="assets/js/admin-analytics.js?v=fc09b39b-1770146154f916933b2da"></script>
  <script type="module" src="assets/js/theme-admin.js?v=fc09b39b-1770146154f916933b2da"></script>
  <script type="module" src="assets/js/theme-discovery.js?v=fc09b39b-1770146154f916933b2da"></script>
  <script type="module" src="assets/js/daily-engagement.js?v=fc09b39b-1770146154f916933b2da"></script>
  <script type="module" src="assets/js/connectionRequests.js?v=fc09b39b-1770146154f916933b2da"></script>

  <!-- Messaging with commit-based cache-busting -->
  <script src="assets/js/messaging.js?v=fc09b39b-1770146154f916933b2da"></script>

  <!-- Auth + profile with commit-based cache-busting for auth fix -->
  <script type="module" src="auth.js?v=fc09b39b-1770146154f916933b2da"></script>
  <script type="module" src="profile.js?v=20260220-1"></script>

  <!-- Synapse initialization helper with commit-based cache-busting -->
  <script src="assets/js/synapse-init-helper.js?v=fc09b39b-1770146154f916933b2da"></script>
  
  <!-- Theme strategy toggle -->
  <script src="assets/js/theme-strategy-toggle.js?v=fc09b39b-1770146154f916933b2da"></script>

  <!-- Comprehensive Fixes Module -->
  <script src="assets/js/comprehensive-fixes.js?v=fc09b39b-17701461543"></script>

  <!-- Critical UX Fixes Module -->
  <script src="assets/js/critical-ux-fixes.js?v=fc09b39b-17701461543"></script>

  <!-- Notification Bell Module -->
  <script src="assets/js/notification-bell.js?v=08a7ab3a"></script>

  <!-- Avatar Upload Module -->
  <script src="assets/js/avatar-upload.js?v=fc09b39b-17701461543"></script>

  <!-- Node Panel Fixes -->
  <script src="assets/js/node-panel-fixes.js?v=fc09b39b-17701461543"></script>

  <!-- Non-module controllers with commit-based cache-busting -->
  <script src="assets/js/dashboard-actions.js?v=fc09b39b-1770146154f916933b2da"></script>

  <!-- adminPeopleService.js imported by adminPeoplePanel.js -->
  <!--  <!-- Admin People Management Modules --> -->
  <script type="module" src="assets/js/adminPeoplePanel.js?v=fc09b39b-17701461543"></script>

  <!-- Synapse boot with commit-based cache-busting -->
  <script type="module" src="assets/js/synapse.js?v=fc09b39b-1770146154f916933b2da"></script>

  <!-- Unified Network Discovery Integration (Feature Flag Controlled) -->
  <script type="module" src="assets/js/unified-network-integration.js?v=fc09b39b-17701461547"></script>

  <!-- Mobile Safe Area Debug Helper (Mobile Only) -->
  <script src="assets/js/mobile-safe-area-debug.js?v=1"></script>

  <!-- Presence Realtime System (Supabase Realtime Presence + low-frequency DB) -->
  <script src="assets/js/presence-realtime.js?v=20260211-1"></script>
  
  <!-- Presence UI (Displays online/offline indicators) -->
  <script src="assets/js/presence-ui.js?v=20260211-1"></script>
  
  <!-- Synapse Presence Indicator (Shows online status in graph) -->
  <script src="assets/js/synapse-presence-indicator.js?v=20260211-1"></script>
  
  <!-- Synapse Message Badges (Shows unread message counts on nodes) -->
  <script src="assets/js/synapse-message-badges.js?v=20260211-2"></script>
  
  <!-- Unified Network - Synapse Bridge (Deep Integration) -->
  <script type="module" src="assets/js/unified-network-synapse-bridge.js?v=fc09b39b-17701461547"></script>
  
  <!-- Quiet Mode Auto-Disable (Disables quiet mode when filters/search are used) -->
  <script type="module" src="assets/js/quiet-mode-auto-disable.js?v=1"></script>
  
  <!-- Unified Network Admin Controls (Ctrl+Shift+U to toggle) -->
  <!-- TEMPORARILY DISABLED: Loads after auth in main.js instead -->
  <!-- <script src="assets/js/unified-network-admin.js?v=1"></script> -->

  <!-- Main app boot with commit-based cache-busting -->
  <script type="module" src="main.js?v=fc09b39b-1770146154f916933b2da"></script>

  <!-- Dashboard controller with commit-based cache-busting -->
  <script type="module" src="assets/js/dashboardPane.js?v=fc09b39b-1770146154f916933b2da"></script>

  <!-- Unified START Flow - DISABLED: Using Enhanced START UI instead -->
  <!-- <script src="assets/js/start-flow-unified.js?v=fc09b39b-1770146154f916933b2da"></script> -->
  
  <!-- Prevent old START flow from running if cached -->
  <script>
    // Disable old START flow if it somehow loaded from cache
    if (window.startFlowManager) {
      console.log('âš ï¸ Old START flow detected, disabling...');
      window.startFlowManager = null;
    }
  </script>

  <!-- Mentor Guide System with commit-based cache-busting -->
  <script src="assets/js/mentor-guide.js?v=fc09b39b-1770146154f916933b2da"></script>

  <!-- Initialize Notification Bell on Profile Load -->
  <script>
    window.addEventListener('profile-loaded', (e) => {
      const { profile } = e.detail;
      if (window.NotificationBell && profile) {
        console.log('ðŸ”” Initializing notification bell for user:', profile.id);
        window.NotificationBell.init(profile);
      }
      
      // Initialize Unified Notification System
      if (window.UnifiedNotifications && profile) {
        console.log('ðŸ”” Initializing unified notifications for user:', profile.id);
        window.UnifiedNotifications.init(profile);
      }
    });
  </script>

  <!-- Logout Button Handler -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const logoutBtn = document.getElementById('logout-btn');
      if (!logoutBtn) return;

      logoutBtn.addEventListener('click', async () => {
        if (!window.handleLogout) {
          console.error('âŒ Logout function not available');
          return;
        }

        console.log('ðŸšª Logging out...');
        await window.handleLogout();

        console.log('ðŸ§¹ Clearing cached state...');
        localStorage.removeItem('start_flow_state');
        localStorage.removeItem('chs_splash_seen_v2');

        setTimeout(() => {
          window.location.href = '/index.html';
        }, 500);
      });
    });
  </script>

  <!-- Session Restoration Handler - Fixes tab switching issues -->
  <script>
    (function() {
      let lastActiveTime = Date.now();
      let restoreInFlight = false;

      document.addEventListener('visibilitychange', async () => {
        if (document.hidden) return;

        const timeSinceActive = Date.now() - lastActiveTime;
        console.log(`ðŸ‘ï¸ Tab visible again (was away for ${Math.floor(timeSinceActive / 1000)}s)`);

        // Do not collide with auth boot
        if (!window.__authReady) {
          lastActiveTime = Date.now();
          return;
        }

        // Single-flight: never overlap getSession calls
        if (restoreInFlight) {
          lastActiveTime = Date.now();
          return;
        }

        if (timeSinceActive > 30000 && window.supabase) {
          restoreInFlight = true;
          console.log('ðŸ”„ Checking session after being away...');

          try {
            const { data: { session }, error } = await window.supabase.auth.getSession();

            if (error) {
              console.error('âŒ Session check error:', error);
              return;
            }

            if (session?.user) {
              console.log('âœ… Session valid for:', session.user.email);

              const loginSection = document.getElementById('login-section');
              const mainContent = document.getElementById('main-content');

              if (loginSection && !loginSection.classList.contains('hidden')) {
                console.log('ðŸ”§ Fixing UI - showing app instead of login');
                loginSection.classList.add('hidden');
                loginSection.classList.remove('active-tab-pane');

                if (mainContent) mainContent.classList.remove('hidden');

                const mainHeader = document.getElementById('main-header');
                if (mainHeader) mainHeader.classList.remove('hidden');

                document.body.style.overflow = 'auto';

                if (!window.currentUserProfile) {
                  console.log('ðŸ“‹ Reloading user profile...');
                  try {
                    const { data: profile } = await window.supabase
                      .from('community')
                      .select('*')
                      .eq('user_id', session.user.id)
                      .limit(1);

                    if (profile && profile.length > 0) {
                      window.currentUserProfile = profile[0];
                      window.dispatchEvent(
                        new CustomEvent('profile-loaded', {
                          detail: { user: session.user, profile: profile[0] }
                        })
                      );
                      console.log('âœ… Profile reloaded:', profile[0].name);
                    }
                  } catch (e) {
                    console.error('âŒ Error reloading profile:', e);
                  }
                }
              }
            } else {
              console.log('âš ï¸ No active session found');

              const loginSection = document.getElementById('login-section');
              if (loginSection && loginSection.classList.contains('hidden')) {
                console.log('ðŸ”’ Showing login screen');
                loginSection.classList.remove('hidden');
                loginSection.classList.add('active-tab-pane');

                const mainContent = document.getElementById('main-content');
                if (mainContent) mainContent.classList.add('hidden');

                const mainHeader = document.getElementById('main-header');
                if (mainHeader) mainHeader.classList.add('hidden');

                document.body.style.overflow = 'hidden';
              }
            }
          } catch (e) {
            console.error('âŒ Error checking session:', e);
          } finally {
            restoreInFlight = false;
          }
        }

        lastActiveTime = Date.now();
      });

      setInterval(() => {
        if (!document.hidden) lastActiveTime = Date.now();
      }, 5000);

      console.log('âœ… Session restoration handler initialized');
    })();
  </script>

  <!-- START Button Logic -->
  <script>
    (function() {
      // Prevent horizontal scroll when keyboard appears on mobile
      const preventHorizontalScroll = () => {
        document.documentElement.style.overflowX = 'hidden';
        document.body.style.overflowX = 'hidden';
        document.body.style.position = 'fixed';
        document.body.style.width = '100%';
      };

      // Handle input focus to prevent scroll issues and detect keyboard on mobile
      const searchInput = document.getElementById('global-search');
      const searchContainer = document.getElementById('centered-search-container');
      
      if (searchInput && searchContainer) {
        // Detect keyboard opening on mobile
        searchInput.addEventListener('focus', () => {
          preventHorizontalScroll();
          // Prevent viewport from shifting
          window.scrollTo(0, 0);
          
          // On mobile, shift search container up when keyboard opens
          if (window.innerWidth <= 768) {
            searchContainer.classList.add('keyboard-open');
          }
        });

        searchInput.addEventListener('blur', () => {
          preventHorizontalScroll();
          window.scrollTo(0, 0);
          
          // Remove keyboard-open class when keyboard closes
          searchContainer.classList.remove('keyboard-open');
        });

        // Also detect window resize (keyboard opening/closing changes viewport height)
        let lastHeight = window.innerHeight;
        window.addEventListener('resize', () => {
          const currentHeight = window.innerHeight;
          
          // If height decreased significantly and search is focused, keyboard is open
          if (currentHeight < lastHeight - 100 && document.activeElement === searchInput) {
            if (window.innerWidth <= 768) {
              searchContainer.classList.add('keyboard-open');
            }
          }
          // If height increased and keyboard-open class exists, keyboard closed
          else if (currentHeight > lastHeight + 100) {
            searchContainer.classList.remove('keyboard-open');
          }
          
          lastHeight = currentHeight;
        });
      }

      // Continuously enforce no horizontal scroll
      setInterval(preventHorizontalScroll, 100);

      // Prevent any scroll on window
      window.addEventListener('scroll', (e) => {
        window.scrollTo(0, 0);
      }, { passive: false });

      const startContainer = document.getElementById('start-button-container');
      const startBtn = document.getElementById('btn-start-center');
      
      // Track if START has been dismissed
      let startDismissed = sessionStorage.getItem('start_dismissed') === 'true';

      // Hide START button and show user node
      function hideStartButton() {
        if (startContainer) {
          startContainer.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
          startContainer.style.opacity = '0';
          startContainer.style.transform = 'translate(-50%, -50%) scale(0.5)';

          setTimeout(() => {
            startContainer.style.display = 'none';
          }, 500);
        }

        // Mark that START was dismissed
        startDismissed = true;
        sessionStorage.setItem('start_dismissed', 'true');
        sessionStorage.setItem('chs_session_started', 'true');
        localStorage.setItem('chs_start_last_used', Date.now());
      }

      // START button click handler
      if (startBtn) {
        startBtn.addEventListener('click', async (e) => {
          // Prevent if modal is already open
          if (window.EnhancedStartUI && window.EnhancedStartUI.isOpen) {
            console.log('âš ï¸ START modal already open, ignoring click');
            e.stopPropagation();
            e.preventDefault();
            return;
          }
          
          console.log('ðŸš€ START button clicked');

          // Hide START button
          hideStartButton();

          // Open enhanced START UI
          setTimeout(async () => {
            if (typeof window.EnhancedStartUI !== 'undefined' && window.EnhancedStartUI.open) {
              console.log('âœ¨ Opening Enhanced START UI');
              await window.EnhancedStartUI.open();
            } else if (typeof window.openStartModal === 'function') {
              console.log('âš ï¸ Fallback to old START modal');
              window.openStartModal();
            } else {
              console.warn('âŒ No START modal function available');
            }
          }, 500);
        });
      }

      // PHASE 3: START button moved to navigation - keep overlay hidden
      // (Old code disabled - we now use btn-start-nav in the top bar)

      console.log('âœ… START button logic initialized (overlay disabled - using nav button)');
    })();
  </script>

  <!-- User Dropdown Menu Logic -->
  <script>
    (function() {
      // Wire up refresh network button
      const refreshBtn = document.getElementById('btn-refresh-network');
      const refreshIcon = document.getElementById('refresh-icon-header');
      
      if (refreshBtn && refreshIcon) {
        refreshBtn.addEventListener('click', () => {
          console.log('ðŸ”„ Refreshing network view...');
          
          // Add spinning animation
          refreshIcon.style.animation = 'spin 1s linear infinite';
          
          // Trigger network refresh
          if (typeof window.refreshSynapseView === 'function') {
            window.refreshSynapseView();
          } else if (typeof window.renderSynapse === 'function') {
            window.renderSynapse();
          } else {
            console.warn('âš ï¸ No refresh function available');
          }
          
          // Stop spinning after 1 second
          setTimeout(() => {
            refreshIcon.style.animation = '';
          }, 1000);
        });
      }

      // Add spin animation
      const style = document.createElement('style');
      style.textContent = `
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `;
      document.head.appendChild(style);

      let isDropdownOpen = false;

      // Wait for DOM to be fully loaded and other scripts to initialize
      setTimeout(() => {
        const userMenu = document.getElementById('user-menu');
        const userDropdown = document.getElementById('user-dropdown');
        const chevron = document.getElementById('user-menu-chevron');
        const dropdownProfile = document.getElementById('dropdown-profile');
        const dropdownSettings = document.getElementById('dropdown-settings');
        const dropdownLogout = document.getElementById('dropdown-logout');

        if (!userMenu || !userDropdown) {
          console.warn('âš ï¸ User menu elements not found');
          return;
        }

        // Toggle dropdown
        function toggleDropdown(e) {
          e.stopPropagation();
          e.preventDefault(); // Prevent profile modal from opening
          
          isDropdownOpen = !isDropdownOpen;
          
          if (isDropdownOpen) {
            userDropdown.style.display = 'flex';
            if (chevron) chevron.style.transform = 'rotate(180deg)';
            userMenu.style.background = 'rgba(0,224,255,0.15)';
            userMenu.style.borderColor = 'rgba(0,224,255,0.5)';
          } else {
            userDropdown.style.display = 'none';
            if (chevron) chevron.style.transform = 'rotate(0deg)';
            userMenu.style.background = 'rgba(0,224,255,0.1)';
            userMenu.style.borderColor = 'rgba(0,224,255,0.3)';
          }
        }

        // Close dropdown
        function closeDropdown() {
          if (isDropdownOpen) {
            isDropdownOpen = false;
            userDropdown.style.display = 'none';
            if (chevron) chevron.style.transform = 'rotate(0deg)';
            userMenu.style.background = 'rgba(0,224,255,0.1)';
            userMenu.style.borderColor = 'rgba(0,224,255,0.3)';
          }
        }

        // Profile action
        function openProfile(e) {
          e.stopPropagation();
          closeDropdown();
          
          setTimeout(() => {
            if (typeof window.openProfileModal === 'function') {
              window.openProfileModal();
            }
          }, 100);
        }

        // Settings action
        function openSettings(e) {
          e.stopPropagation();
          closeDropdown();
          
          // Check if user is admin
          if (typeof window.isAdminUser === 'function' && window.isAdminUser()) {
            console.log('ðŸ‘‘ Opening admin panel from settings (admin user)');
            if (typeof window.openAdminPanel === 'function') {
              window.openAdminPanel();
            } else {
              console.error('âŒ openAdminPanel function not found');
              alert('Admin panel not available');
            }
          } else {
            console.log('Settings clicked (non-admin)');
            alert('Settings feature coming soon!');
          }
        }

        // Logout action
        async function logout(e) {
          e.stopPropagation();
          closeDropdown();
          
          if (!confirm('Are you sure you want to logout?')) {
            return;
          }

          try {
            console.log('ðŸšª Logging out...');
            
            if (window.supabase) {
              const { error } = await window.supabase.auth.signOut();
              if (error) throw error;
            }

            localStorage.clear();
            sessionStorage.clear();
            window.dispatchEvent(new CustomEvent('user-logged-out'));
            
            console.log('âœ… Logged out successfully');
            window.location.reload();
            
          } catch (error) {
            console.error('âŒ Logout error:', error);
            alert('Error logging out. Please try again.');
          }
        }

        // Add event listeners with capture phase to intercept before other handlers
        userMenu.addEventListener('click', toggleDropdown, true);

        if (dropdownProfile) {
          dropdownProfile.addEventListener('click', openProfile);
        }

        if (dropdownSettings) {
          dropdownSettings.addEventListener('click', openSettings);
        }

        if (dropdownLogout) {
          dropdownLogout.addEventListener('click', logout);
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
          if (!userMenu.contains(e.target) && !userDropdown.contains(e.target)) {
            closeDropdown();
          }
        });

        // Close dropdown on escape key
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && isDropdownOpen) {
            closeDropdown();
          }
        });

        console.log('âœ… User dropdown menu initialized');
      }, 500); // Wait for other scripts to load

      // Wire up new left-side user profile button
      setTimeout(() => {
        const userProfileCombined = document.getElementById('user-profile-combined');
        const adminBtnLeft = document.getElementById('btn-admin-top-left');
        
        if (userProfileCombined) {
          // Open profile panel when clicking the combined profile button
          userProfileCombined.addEventListener('click', (e) => {
            e.stopPropagation();
            
            // Open the profile panel
            if (typeof window.openProfileModal === 'function') {
              console.log('ðŸ”µ Opening profile panel from combined button');
              window.openProfileModal();
            } else {
              console.warn('âš ï¸ openProfileModal function not available');
            }
          });
          
          console.log('âœ… Combined user profile button initialized');
        }
        
        // Wire up admin button on left side
        if (adminBtnLeft) {
          adminBtnLeft.addEventListener('click', () => {
            if (typeof window.openAdminPanel === 'function') {
              window.openAdminPanel();
            }
          });
        }
      }, 600);
    })();
  </script>

  <script src="assets/js/start-sequence-report.js?v=3"></script>
<script src="assets/js/start-synapse-integration.js?v=3"></script>
<script src="assets/js/start-onboarding.js?v=3"></script>
<script src="assets/js/start-daily-digest.js?v=1739311200"></script>
<script src="assets/js/start-ui-enhanced.js?v=1739311200"></script>

<!-- Unified Notification System (Replaces START button with enhanced notifications) -->
<script src="assets/js/unified-notification-system.js?v=1"></script>

<!-- Daily Suggestions Engine -->
<script type="module" src="assets/js/suggestions/index-v2.js"></script>
<script type="module" src="assets/js/suggestions/start-integration.js?v=1"></script>
<script type="module" src="assets/js/suggestions/navigation.js?v=1"></script>

<!-- Wire up global functions for enhanced START UI -->
<script>
  // Make sure closeStartModal works with enhanced UI
  window.closeStartModal = function() {
    if (window.EnhancedStartUI && window.EnhancedStartUI.close) {
      window.EnhancedStartUI.close();
    }
  };
  
  // Make sure openStartModal uses enhanced UI
  window.openStartModal = async function() {
    if (window.EnhancedStartUI && window.EnhancedStartUI.open) {
      await window.EnhancedStartUI.open();
    }
  };
</script>

<!-- Dynamic Viewport Height Detection for Mobile Browser UI -->
<script>
  (function() {
    // Function to set the viewport height CSS variable
    function setViewportHeight() {
      // Get the actual viewport height
      const vh = window.innerHeight * 0.01;
      
      // Set the CSS variable
      document.documentElement.style.setProperty('--vh', `${vh}px`);
      
      // Log for debugging (remove in production if needed)
      if (window.location.search.includes('debug')) {
        console.log(`ðŸ“ Viewport height updated: ${window.innerHeight}px (--vh: ${vh}px)`);
      }
    }
    
    // Set on initial load
    setViewportHeight();
    
    // Update on resize (handles browser UI showing/hiding)
    let resizeTimer;
    window.addEventListener('resize', () => {
      // Debounce to avoid too many updates
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        setViewportHeight();
      }, 100);
    });
    
    // Update on orientation change
    window.addEventListener('orientationchange', () => {
      setTimeout(setViewportHeight, 100);
    });
    
    // iOS-specific: Update when scrolling (Safari shows/hides UI on scroll)
    let scrollTimer;
    window.addEventListener('scroll', () => {
      clearTimeout(scrollTimer);
      scrollTimer = setTimeout(() => {
        setViewportHeight();
      }, 150);
    }, { passive: true });
    
    // Update when page becomes visible again (handles tab switching)
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) {
        setTimeout(setViewportHeight, 100);
      }
    });
    
    console.log('âœ… Dynamic viewport height detection initialized');
  })();
</script>
  
  <script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker
        .register("./sw.js", { scope: "./" })
        .catch((err) => console.error("SW registration failed:", err));
    });
  }
</script>

  <!-- Force sign-out: ensures no stale Supabase session persists across page loads.
       Runs as an inline script so it fires before any module is evaluated.
       Auth.js then starts a fresh session from scratch on every load. -->
  <script>
  (function () {
    // Wait for supabase to be available, then sign out any existing session.
    // We use a short poll because supabaseClient.js loads asynchronously.
    var _forceSignOutAttempts = 0;
    var _forceSignOutMax = 100; // 5 s max wait

    function tryForceSignOut() {
      if (typeof window.supabase !== 'undefined' && typeof window.supabase.auth !== 'undefined') {
        window.supabase.auth.signOut({ scope: 'local' }).then(function () {
          console.log('[force-signout] âœ… Stale session cleared on page load.');
        }).catch(function (e) {
          console.warn('[force-signout] signOut error (ignored):', e.message);
        });
        return;
      }
      if (_forceSignOutAttempts++ < _forceSignOutMax) {
        setTimeout(tryForceSignOut, 50);
      } else {
        console.warn('[force-signout] supabase not available after 5 s â€” skipping forced sign-out.');
      }
    }

    // Also sign out on page hide (tab close / background) to prevent
    // session tokens from being visible in a suspended tab's memory.
    window.addEventListener('pagehide', function () {
      if (typeof window.supabase !== 'undefined') {
        window.supabase.auth.signOut({ scope: 'local' }).catch(function () {});
      }
    });

    tryForceSignOut();
  })();
  </script>


  </body>
</html>
<- Search suggestions not scrolling smoothly on Force rebuild Tue Feb 10 16:16:09 EST 2026 -->
