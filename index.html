<!DOCTYPE html>
<html lang="en-US">
<head>
  <!-- —— Redirect if landed via magic link —— -->
  <script>
    const params = new URLSearchParams(window.location.search);
    if (params.get('source') === 'neuron') {
      window.location.href = '/neural.html?' + params.toString();
    }
  </script>

  <!-- —— Google Analytics —— -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6NDKG07DY6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-6NDKG07DY6');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, viewport-fit=cover, initial-scale=1.0" />
  <title>CharlestonHacks - Home</title>
  <meta name="description" content="Join CharlestonHacks for transformative hackathons and tech meetups in Charleston, SC."/>
  <link rel="icon" href="favicon.ico" type="image/x-icon"/>
  <meta name="theme-color" content="#ff6600"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link rel="stylesheet" href="styles.css" />

  <!-- —— Discord Embed Styles —— -->
  <style>
    #discord-bubble {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 9999;
      width: 340px;
      height: 480px;
      background: #23272a;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 0 25px rgba(0,0,0,0.5);
      touch-action: none;
      animation: bounceIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    #discord-minimize {
      position: absolute;
      top: -10px;
      right: -10px;
      background: #ff6600;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      font-weight: bold;
      font-size: 14px;
    }
    #discord-badge {
      position: absolute;
      top: 6px;
      left: 6px;
      background: red;
      color: white;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      font-size: 11px;
      display: none;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      animation: pulseBadge 1.5s infinite ease-in-out;
      box-shadow: 0 0 10px rgba(255,0,0,0.7);
    }
    @keyframes pulseBadge {
      0%,100% { transform: scale(1); box-shadow: 0 0 6px rgba(255,0,0,0.5); }
      50% { transform: scale(1.3); box-shadow: 0 0 14px rgba(255,0,0,0.8); }
    }
    @keyframes bounceIn {
      0% { transform: scale(0.5); opacity: 0; }
      60% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); }
    }
    @media (max-width: 600px) {
      #discord-bubble {
        width: 90vw;
        height: 65vh;
        bottom: 10px;
        right: 10px;
      }
      #discord-minimize { top: -8px; right: -8px; width: 22px; height: 22px; font-size: 12px; }
    }
  </style>
</head>

<body>
  <!-- —— Background —— -->
  <canvas id="neural-bg"></canvas>

  <!-- —— Splash Screen (first visit only) —— -->
  <div id="splash-overlay" style="display:none;">
    <div id="splash-content">
      <img id="splash-logo" src="images/charlestonhackslogo.svg" alt="CharlestonHacks Logo" />
      <h1>Welcome to CharlestonHacks</h1>
      <p>Loading...</p>
      <label style="display:flex;align-items:center;gap:.5em;">
        <input type="checkbox" id="dont-show-again" /> Don’t show this again
      </label>
      <div>
        <button id="community-site-btn" class="btn">Community Site</button>
        <button id="public-site-btn" class="btn">Public Site</button>
      </div>
      <p style="font-size:.8rem;opacity:.7;margin-top:1rem;">© 2025 CharlestonHacks</p>
    </div>
  </div>

  <!-- —— Audio —— -->
  <audio id="cardflipSound" src="assets/atmospherel.m4a" preload="auto"></audio>
  <audio id="chimeSound" src="assets/chime.mp3" preload="auto"></audio>
  <audio id="keysSound" src="assets/keys.m4a" preload="auto"></audio>

  <!-- —— Main Card —— -->
  <main>
    <div class="main-wrapper">
      <div class="media-container" tabindex="0">
        <img id="missionImage" src="icons/card.png" alt="Main Card" />
        <button class="clickable-area top-left" data-url="Poster.html"><img src="images/informationbutton.webp" alt="Info"></button>
        <button class="clickable-area top-center" data-url="docs.html"><img src="images/crestn.svg" alt="Docs"></button>
        <button class="clickable-area top-right" data-url="2card.html"><img src="images/innovationenginebutton.webp" alt="Innovation"></button>
      </div>
    </div>
    <section class="icons-container">
      <a href="https://github.com/sponsors/deckerd451" target="_blank"><i class="fas fa-heart"></i></a>
      <a href="2card.html"><i class="fas fa-people-arrows"></i></a>
      <a href="subscribe.html"><i class="fas fa-bell"></i></a>
      <a href="https://www.linkedin.com/company/charlestonhacks" target="_blank"><i class="fab fa-linkedin"></i></a>
    </section>
  </main>

  <!-- —— Discord Chat Bubble —— -->
  <div id="discord-bubble">
    <div id="discord-badge">!</div>
    <widgetbot
      id="discord-widget"
      server="YOUR_SERVER_ID"
      channel="YOUR_CHANNEL_ID"
      width="100%"
      height="100%"
    ></widgetbot>
    <button id="discord-minimize">–</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@widgetbot/html-embed"></script>

  <!-- —— Logic —— -->
  <script>
    const splashKey = 'chs_splash_seen_once';
    const splash = document.getElementById('splash-overlay');
    const discordBubble = document.getElementById('discord-bubble');
    const discordMinimize = document.getElementById('discord-minimize');
    const discordBadge = document.getElementById('discord-badge');
    const mediaContainer = document.querySelector('.media-container');
    let minimized = false, shown = false;

    // SPLASH
    window.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem(splashKey) === 'true') return;
      splash.style.display = 'flex';
      document.getElementById('community-site-btn').onclick = dismissSplash;
      document.getElementById('public-site-btn').onclick = () => {
        dismissSplash(); window.location.href = 'https://charlestonhacks.mailchimpsites.com/';
      };
    });
    function dismissSplash() {
      if (document.getElementById('dont-show-again').checked) localStorage.setItem(splashKey, 'true');
      splash.style.display = 'none';
    }

    // Discord Bubble Logic
    mediaContainer.addEventListener('click', () => {
      if (!shown) {
        discordBubble.style.display = 'block';
        discordBubble.classList.add('bouncing');
        shown = true;
      }
    });

    discordMinimize.onclick = () => {
      minimized = !minimized;
      if (minimized) {
        discordBubble.style.width = '80px';
        discordBubble.style.height = '80px';
        discordBubble.style.borderRadius = '50%';
        discordMinimize.textContent = '+';
      } else {
        discordBubble.style.width = window.innerWidth < 600 ? '90vw' : '340px';
        discordBubble.style.height = window.innerWidth < 600 ? '65vh' : '480px';
        discordBubble.style.borderRadius = '16px';
        discordMinimize.textContent = '–';
        discordBadge.style.display = 'none';
      }
    };

    // Fake badge trigger
    setTimeout(() => { if (minimized) discordBadge.style.display = 'flex'; }, 15000);

    // Draggable
    let drag = false, offsetX, offsetY;
    discordBubble.addEventListener('mousedown', e => { drag = true; offsetX = e.clientX - discordBubble.offsetLeft; offsetY = e.clientY - discordBubble.offsetTop; });
    window.addEventListener('mousemove', e => { if (drag) { discordBubble.style.left = e.clientX - offsetX + 'px'; discordBubble.style.top = e.clientY - offsetY + 'px'; discordBubble.style.right = 'auto'; discordBubble.style.bottom = 'auto'; }});
    window.addEventListener('mouseup', () => drag = false);
  </script>
</body>
</html>
