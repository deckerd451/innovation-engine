<!DOCTYPE html>
<html lang="en-US">
<head>
  <script>
    const params = new URLSearchParams(window.location.search);
    if (params.get("source") === "neuron") {
      window.location.href = "/neural.html?" + params.toString();
    }
  </script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6NDKG07DY6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag("js", new Date());
    gtag("config", "G-6NDKG07DY6");
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>CharlestonHacks - Portal to Innovation</title>
  <meta name="description" content="CharlestonHacks â€” Making Invisible Networks Visible. Explore 9 interactive portals to innovation, community, and collaboration."/>
  <meta property="og:image" content="images/websitepanel.webp"/>
  <meta property="og:url" content="https://charlestonhacks.com"/>
  <meta name="theme-color" content="#0a0a0a"/>
  <link rel="icon" href="favicon.ico" type="image/x-icon"/>
  
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
  <video id="background-video" autoplay muted loop playsinline>
    <source src="videos/background.mp4" type="video/mp4">
  </video>
  <canvas id="neural-bg"></canvas>

  <div id="countdown">00:00:00:00</div>
  <div id="btcPrice">BTC: Loading...</div>

  <main class="main-wrapper">
    <div class="media-container">
      <img id="missionImage" src="images/portal-base.webp" alt="CharlestonHacks Portal">
      
      <a href="/community" class="clickable-area top-left" title="Community Hub"></a>
      <a href="/innovation" class="clickable-area top-right" title="Innovation Engine"></a>
      <a href="/collaboration" class="clickable-area middle-left" title="Collab Center"></a>
      <a href="/resources" class="clickable-area middle-right" title="Developer Tools"></a>
      
      <button class="clickable-area center" id="open-calendar" style="background:none; border:none; padding:0; cursor:pointer;">
          <img src="images/icon-calendar.png" alt="Events Calendar" style="width:100%; height:100%;">
      </button>

      <a href="/network" class="clickable-area bottom-left" title="Neural Network"></a>
      <a href="/growth" class="clickable-area bottom-right" title="Growth Metrics"></a>
    </div>
  </main>

  <div id="events-overlay" class="overlay">
    <div class="events-modal">
      <button id="close-overlay" class="close-btn">&times;</button>
      <div class="modal-content">
          <h2 class="section-title" style="color: var(--gold); border-bottom: 1px solid var(--gold); padding-bottom: 10px;">Charleston Live Feed</h2>
          <div id="events-list">
            <p class="loading-text" style="text-align:center; padding: 20px; opacity: 0.6;">Initiating neural link to local events...</p>
          </div>
      </div>
    </div>
  </div>

  <div id="mystery-overlay" class="overlay">
    <div class="mystery-modal">
      <button id="close-mystery" class="close-btn">&times;</button>
      <div class="mystery-content">
        <h2>Mystery Unlocked</h2>
        <p>You have discovered a hidden network node.</p>
      </div>
    </div>
  </div>

  <div class="icons-container">
      <a href="https://discord.gg/charlestonhacks" target="_blank"><i class="fab fa-discord"></i></a>
      <a href="https://twitter.com/charlestonhacks" target="_blank"><i class="fab fa-twitter"></i></a>
      <a href="https://github.com/charlestonhacks" target="_blank"><i class="fab fa-github"></i></a>
  </div>

  <script src="assets/js/neural-background.js"></script>
  
  <script>
    // 1. BTC PRICE TRACKER (Original Logic)
    async function updateBTC() {
      try {
        const res = await fetch('https://api.coinbase.com/v2/prices/BTC-USD/spot');
        const data = await res.json();
        const price = parseFloat(data.data.amount).toLocaleString();
        document.getElementById('btcPrice').innerText = `BTC: $${price}`;
      } catch(e) { console.warn("BTC feed delayed"); }
    }
    setInterval(updateBTC, 30000);
    updateBTC();

    // 2. COUNTDOWN TIMER (Original Logic)
    function updateCountdown() {
      const target = new Date("2026-01-01T00:00:00").getTime();
      const now = new Date().getTime();
      const diff = target - now;
      if (diff <= 0) return;
      const d = Math.floor(diff / (1000 * 60 * 60 * 24));
      const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const s = Math.floor((diff % (1000 * 60)) / 1000);
      document.getElementById('countdown').innerText = `${d}d ${h}h ${m}m ${s}s`;
    }
    setInterval(updateCountdown, 1000);

    // 3. [FIXED] MODAL & SCRAPER CONTROLLER
    // This replaces the broken 'while' loop and duplicate listeners
    const openCalendarBtn = document.getElementById("open-calendar");
    const closeCalendarBtn = document.getElementById("close-overlay");
    const eventsOverlay = document.getElementById("events-overlay");

    const toggleEvents = (show) => {
      if (show) {
        eventsOverlay.classList.add("active");
        // Load external scraper only when clicked
        if (!window.eventsFeedLoaded) {
          const script = document.createElement('script');
          script.src = "./eventsFeed.js"; 
          document.body.appendChild(script);
          window.eventsFeedLoaded = true;
        } else if (typeof loadEvents === "function") {
          loadEvents(); 
        }
      } else {
        eventsOverlay.classList.remove("active");
      }
    };

    openCalendarBtn?.addEventListener("click", (e) => {
      e.preventDefault();
      toggleEvents(true);
    });

    closeCalendarBtn?.addEventListener("click", () => toggleEvents(false));

    // Outside click and Escape key behavior
    eventsOverlay?.addEventListener("click", (e) => {
      if (e.target === eventsOverlay) toggleEvents(false);
    });
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        eventsOverlay?.classList.remove("active");
        document.getElementById("mystery-overlay")?.classList.remove("active");
      }
    });

    // Mystery Modal close
    document.getElementById("close-mystery")?.addEventListener("click", () => {
      document.getElementById("mystery-overlay").classList.remove("active");
    });
  </script>
</body>
</html>
