<!DOCTYPE html>
<html lang="en-US">
<head>
  <script>
    const params = new URLSearchParams(window.location.search);
    if (params.get("source") === "neuron") {
      window.location.href = "/neural.html?" + params.toString();
    }
  </script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6NDKG07DY6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag("js", new Date());
    gtag("config", "G-6NDKG07DY6");
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>CharlestonHacks - Portal to Innovation</title>
  <meta name="description" content="CharlestonHacks â€” Making Invisible Networks Visible. Explore 9 interactive portals to innovation, community, and collaboration."/>
  <meta property="og:image" content="images/websitepanel.webp"/>
  <meta property="og:url" content="https://charlestonhacks.com"/>
  <meta name="theme-color" content="#0a0a0a"/>
  <link rel="icon" href="favicon.ico" type="image/x-icon"/>
  
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <style>
    /* Critical UI Overrides for the Events Modal */
    #events-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.92);
      backdrop-filter: blur(10px);
      display: none; 
      justify-content: center;
      align-items: center;
      z-index: 10000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    #events-overlay.active {
      display: flex !important;
      opacity: 1;
    }

    .events-modal {
      background: #111;
      border: 1px solid var(--gold, #c9a35e);
      padding: 2.5rem;
      width: 90%;
      max-width: 650px;
      max-height: 85vh;
      overflow-y: auto;
      position: relative;
      border-radius: 12px;
      box-shadow: 0 0 40px rgba(0,0,0,0.8);
    }

    .close-btn {
      position: absolute;
      top: 1rem;
      right: 1.5rem;
      background: none;
      border: none;
      color: var(--gold, #c9a35e);
      font-size: 2.5rem;
      cursor: pointer;
      line-height: 1;
    }

    #events-list {
      margin-top: 2rem;
      font-family: var(--font-primary);
    }

    /* Styles for the dynamically generated content */
    .event-item {
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding: 1.2rem 0;
      animation: fadeIn 0.5s ease forwards;
    }
    .event-date { color: var(--gold); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; }
    .event-title a { color: #fff; text-decoration: none; font-size: 1.2rem; display: block; margin: 5px 0; }
    .event-title a:hover { color: var(--cyan, #00e0ff); }
    .event-desc { color: #888; font-size: 0.9rem; line-height: 1.4; }
  </style>
</head>

<body>
  <video id="background-video" autoplay muted loop playsinline>
    <source src="videos/background.mp4" type="video/mp4">
  </video>
  <canvas id="neural-bg"></canvas>

  <div id="countdown">00:00:00:00</div>
  <div id="btcPrice">BTC: --.---</div>

  <main class="main-wrapper">
    <div class="media-container">
      <img id="missionImage" src="images/portal-base.webp" alt="CharlestonHacks Portal">
      
      <a href="/community" class="clickable-area top-left"></a>
      <a href="/innovation" class="clickable-area top-right"></a>
      <a href="/collaboration" class="clickable-area middle-left"></a>
      <a href="/resources" class="clickable-area middle-right"></a>
      
      <button class="clickable-area center" id="open-calendar" style="background:none; border:none; padding:0;">
          <img src="images/icon-calendar.png" alt="Events Calendar" style="width:100%; height:100%;">
      </button>

      <a href="/network" class="clickable-area bottom-left"></a>
      <a href="/growth" class="clickable-area bottom-right"></a>
    </div>
  </main>

  <div id="events-overlay">
    <div class="events-modal">
      <button id="close-overlay" class="close-btn">&times;</button>
      <h2 style="color: var(--gold, #c9a35e); font-family: var(--font-primary); text-transform: uppercase;">Charleston Live Feed</h2>
      <div id="events-list">
        <p style="text-align:center; opacity:0.6; font-style: italic;">Syncing with local pulse...</p>
      </div>
    </div>
  </div>

  <div class="icons-container">
      <a href="https://discord.gg/charlestonhacks" target="_blank" title="Discord"><i class="fab fa-discord"></i></a>
      <a href="https://twitter.com/charlestonhacks" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a>
      <a href="https://github.com/charlestonhacks" target="_blank" title="GitHub"><i class="fab fa-github"></i></a>
  </div>

  <script src="assets/js/neural-background.js"></script>
  
  <script>
    /* ----------------------------------------------------
       1. BTC Price Tracker
    ---------------------------------------------------- */
    async function updateBTC() {
      try {
        const res = await fetch('https://api.coinbase.com/v2/prices/BTC-USD/spot');
        const data = await res.json();
        const price = parseFloat(data.data.amount).toLocaleString();
        document.getElementById('btcPrice').innerText = `BTC: $${price}`;
      } catch(e) { console.warn("BTC update throttled"); }
    }
    setInterval(updateBTC, 30000);
    updateBTC();

    /* ----------------------------------------------------
       2. Countdown Timer
    ---------------------------------------------------- */
    function updateCountdown() {
      const target = new Date("2026-01-01T00:00:00").getTime();
      const now = new Date().getTime();
      const diff = target - now;
      if (diff <= 0) return;
      
      const d = Math.floor(diff / (1000 * 60 * 60 * 24));
      const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const s = Math.floor((diff % (1000 * 60)) / 1000);
      document.getElementById('countdown').innerText = `${d}d ${h}h ${m}m ${s}s`;
    }
    setInterval(updateCountdown, 1000);

    /* ----------------------------------------------------
       3. Modal & Scraper Integration Logic
    ---------------------------------------------------- */
    const openBtn = document.getElementById("open-calendar");
    const closeBtn = document.getElementById("close-overlay");
    const overlay = document.getElementById("events-overlay");

    const toggleModal = (active) => {
      if (active) {
        overlay.classList.add("active");
        // Lazy-load the script only when user clicks
        if (!window.eventsFeedInitialized) {
          const script = document.createElement('script');
          script.src = "./eventsFeed.js"; 
          document.body.appendChild(script);
          window.eventsFeedInitialized = true;
        } else if (typeof loadEvents === "function") {
          loadEvents(); // Re-trigger fetch if script is already there
        }
      } else {
        overlay.classList.remove("active");
      }
    };

    openBtn?.addEventListener("click", (e) => {
      e.preventDefault();
      toggleModal(true);
    });

    closeBtn?.addEventListener("click", () => toggleModal(false));
    
    // UI Helpers: Close on background click or Escape key
    overlay?.addEventListener("click", (e) => { 
      if(e.target === overlay) toggleModal(false); 
    });
    document.addEventListener("keydown", (e) => { 
      if(e.key === "Escape") toggleModal(false); 
    });
  </script>
</body>
</html>
