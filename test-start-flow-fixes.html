<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start Flow Error Fix Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: #1a1a2e; 
            color: white; 
            padding: 2rem; 
        }
        .test-section { 
            margin: 2rem 0; 
            padding: 1rem; 
            border: 1px solid #333; 
            border-radius: 8px; 
        }
        button { 
            background: #00e0ff; 
            color: #000; 
            border: none; 
            padding: 0.75rem 1.5rem; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 0.5rem; 
        }
        #console-output { 
            background: #000; 
            padding: 1rem; 
            border-radius: 6px; 
            font-family: monospace; 
            height: 300px; 
            overflow-y: auto; 
            white-space: pre-wrap; 
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª Start Flow Error Fix Test</h1>
    
    <div class="test-section">
        <h2>Test Scenario</h2>
        <p>This test simulates the error conditions you were experiencing:</p>
        <ul>
            <li>D3 library not loaded</li>
            <li>Synapse SVG element missing</li>
            <li>Synapse network not initialized</li>
            <li>Main content hidden</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>Test Controls</h2>
        <button onclick="testWithoutD3()">Test Without D3</button>
        <button onclick="testWithoutSVG()">Test Without SVG</button>
        <button onclick="testWithoutNodes()">Test Without Nodes</button>
        <button onclick="testWithHiddenContent()">Test With Hidden Content</button>
        <button onclick="testNormalFlow()">Test Normal Flow</button>
        <button onclick="clearConsole()">Clear Console</button>
    </div>

    <div class="test-section">
        <h2>Console Output</h2>
        <div id="console-output"></div>
    </div>

    <!-- Mock synapse SVG for testing -->
    <div id="main-content" style="display: none;">
        <svg id="synapse-svg" style="width: 100px; height: 100px;">
            <circle class="synapse-node" cx="50" cy="50" r="10" fill="#00e0ff"></circle>
        </svg>
    </div>

    <!-- Load D3 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    
    <!-- Load our fixed start flow scripts -->
    <script src="assets/js/start-flow-enhanced.js"></script>
    <script src="assets/js/start-flow-phase2.js"></script>

    <script>
        // Capture console output
        const consoleOutput = document.getElementById('console-output');
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;

        function addToConsole(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.textContent += `[${timestamp}] ${type}: ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole('LOG', args.join(' '));
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsole('WARN', args.join(' '));
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole('ERROR', args.join(' '));
        };

        // Test functions
        function testWithoutD3() {
            addToConsole('TEST', '=== Testing without D3 ===');
            const originalD3 = window.d3;
            delete window.d3;
            
            try {
                window.animateNetworkForChoice('focus', { bestTheme: { id: 'test' } });
            } catch (e) {
                addToConsole('ERROR', e.message);
            }
            
            window.d3 = originalD3;
        }

        function testWithoutSVG() {
            addToConsole('TEST', '=== Testing without SVG ===');
            const svg = document.getElementById('synapse-svg');
            if (svg) svg.remove();
            
            try {
                window.animateNetworkForChoice('focus', { bestTheme: { id: 'test' } });
            } catch (e) {
                addToConsole('ERROR', e.message);
            }
            
            // Restore SVG
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = '<svg id="synapse-svg" style="width: 100px; height: 100px;"><circle class="synapse-node" cx="50" cy="50" r="10" fill="#00e0ff"></circle></svg>';
        }

        function testWithoutNodes() {
            addToConsole('TEST', '=== Testing without nodes ===');
            const svg = document.getElementById('synapse-svg');
            if (svg) svg.innerHTML = '';
            
            try {
                window.animateNetworkForChoice('focus', { bestTheme: { id: 'test' } });
            } catch (e) {
                addToConsole('ERROR', e.message);
            }
            
            // Restore node
            svg.innerHTML = '<circle class="synapse-node" cx="50" cy="50" r="10" fill="#00e0ff"></circle>';
        }

        function testWithHiddenContent() {
            addToConsole('TEST', '=== Testing with hidden content ===');
            const mainContent = document.getElementById('main-content');
            mainContent.classList.add('hidden');
            
            try {
                window.animateNetworkForChoice('focus', { bestTheme: { id: 'test' } });
            } catch (e) {
                addToConsole('ERROR', e.message);
            }
            
            mainContent.classList.remove('hidden');
        }

        function testNormalFlow() {
            addToConsole('TEST', '=== Testing normal flow ===');
            const mainContent = document.getElementById('main-content');
            mainContent.style.display = 'block';
            mainContent.classList.remove('hidden');
            
            try {
                window.animateNetworkForChoice('focus', { bestTheme: { id: 'test' } });
            } catch (e) {
                addToConsole('ERROR', e.message);
            }
        }

        function clearConsole() {
            consoleOutput.textContent = '';
        }

        // Initial message
        addToConsole('INFO', 'Start Flow Error Fix Test Ready');
        addToConsole('INFO', 'Click the test buttons to simulate different error conditions');
    </script>
</body>
</html>