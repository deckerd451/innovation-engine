<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Reset Password</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body style="font-family: system-ui; max-width: 520px; margin: 40px auto;">
  <h1>Reset Password</h1>

  <p id="status">Loadingâ€¦</p>

  <div id="form" style="display:none;">
    <label>New password</label><br/>
    <input id="p1" type="password" style="width:100%; padding:10px; margin:8px 0;" />

    <label>Confirm password</label><br/>
    <input id="p2" type="password" style="width:100%; padding:10px; margin:8px 0;" />

    <button id="btn" style="padding:10px 14px;">Set new password</button>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

    const supabaseUrl = "https://mqbsjlgnsirqsmfnreqd.supabase.co";
    const supabaseAnonKey = "PASTE_YOUR_ANON_KEY_HERE"; // same as your web app uses
    const supabase = createClient(supabaseUrl, supabaseAnonKey);

    const statusEl = document.getElementById("status");
    const formEl = document.getElementById("form");

    // When Supabase redirects here after recovery, the session will be available.
    const { data, error } = await supabase.auth.getSession();

    if (error) {
      statusEl.textContent = "Error: " + error.message;
    } else if (!data.session) {
      statusEl.textContent = "No reset session found. Open the link from your reset email again.";
    } else {
      statusEl.textContent = "Enter a new password.";
      formEl.style.display = "block";
    }

    document.getElementById("btn").addEventListener("click", async () => {
      const p1 = document.getElementById("p1").value;
      const p2 = document.getElementById("p2").value;

      if (p1.length < 8) return alert("Password must be at least 8 characters.");
      if (p1 !== p2) return alert("Passwords do not match.");

      const { error } = await supabase.auth.updateUser({ password: p1 });
      if (error) return alert("Error: " + error.message);

      alert("Password updated. You can now sign in with email/password.");
      window.location.href = "./";
    });
  </script>
</body>
</html>
