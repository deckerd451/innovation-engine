<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  
  <title>CharlestonHacks Innovation Engine</title>
  <meta name="description" content="Making Invisible Networks Visible"/>
  
  <link rel="icon" href="favicon.ico"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  
  <style>
    :root {
      --gold: #c9a35e;
      --gold-glow: rgba(201, 163, 94, 0.6);
      --cyan: #00e0ff;
      --cyan-glow: rgba(0, 224, 255, 0.4);
      --bg-dark: #000;
      --bg-card: #0a0a0a;
      --text-primary: #fff;
      --text-secondary: #aaa;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg-dark);
      color: var(--text-primary);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: rgba(0, 0, 0, 0.95);
      border-bottom: 2px solid var(--cyan);
      padding: 1.5rem 2rem;
      position: sticky;
      top: 0;
      z-index: 1000;
      backdrop-filter: blur(10px);
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: bold;
      background: linear-gradient(135deg, var(--gold), var(--cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .tagline {
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin-top: 0.2rem;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-badge {
      color: var(--cyan);
      font-size: 0.9rem;
    }

    /* Navigation */
    .nav-tabs {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .nav-tab {
      background: transparent;
      border: 2px solid transparent;
      color: var(--text-secondary);
      padding: 0.7rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-tab:hover {
      color: var(--cyan);
      border-color: var(--cyan);
      background: rgba(0, 224, 255, 0.05);
    }

    .nav-tab.active {
      color: var(--cyan);
      border-color: var(--cyan);
      background: rgba(0, 224, 255, 0.1);
    }

    /* Buttons */
    .btn {
      background: linear-gradient(135deg, var(--gold), #d4b684);
      color: #000;
      border: none;
      padding: 0.7rem 1.5rem;
      border-radius: 50px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px var(--gold-glow);
    }

    .btn-secondary {
      background: transparent;
      border: 2px solid var(--cyan);
      color: var(--cyan);
    }

    .btn-secondary:hover {
      background: var(--cyan);
      color: #000;
    }

    .btn-small {
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
    }

    /* Container */
    .container {
      max-width: 1400px;
      margin: 2rem auto;
      padding: 0 2rem;
    }

    /* Tab Content */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Login Section */
    .login-section {
      min-height: 60vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .login-box {
      background: var(--bg-card);
      border: 2px solid var(--cyan);
      border-radius: 12px;
      padding: 3rem;
      max-width: 500px;
      width: 100%;
      text-align: center;
    }

    .login-box h2 {
      color: var(--cyan);
      margin-bottom: 1rem;
      font-size: 1.8rem;
    }

    .login-box p {
      color: var(--text-secondary);
      margin-bottom: 2rem;
    }

    .login-buttons {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    /* Cards */
    .card {
      background: rgba(10, 10, 10, 0.8);
      border: 1px solid rgba(0, 224, 255, 0.3);
      border-radius: 12px;
      padding: 1.5rem;
      transition: var(--transition);
    }

    .card:hover {
      border-color: var(--gold);
      transform: translateY(-5px);
      box-shadow: 0 10px 30px var(--cyan-glow);
    }

    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }

    .stat-card {
      background: rgba(0, 224, 255, 0.05);
      border: 2px solid var(--cyan);
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      transition: var(--transition);
    }

    .stat-card:hover {
      border-color: var(--gold);
      transform: translateY(-5px);
    }

    .stat-card i {
      font-size: 2rem;
      color: var(--cyan);
      margin-bottom: 0.5rem;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: var(--gold);
      display: block;
      margin: 0.5rem 0;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    /* Project Cards */
    .project-card {
      background: rgba(10, 10, 10, 0.8);
      border: 1px solid rgba(0, 224, 255, 0.3);
      border-radius: 12px;
      padding: 1.5rem;
      transition: var(--transition);
      cursor: pointer;
    }

    .project-card:hover {
      border-color: var(--gold);
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(201, 163, 94, 0.3);
    }

    .project-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 1rem;
    }

    .project-header h3 {
      color: var(--text-primary);
      font-size: 1.3rem;
      flex: 1;
    }

    .status-badge {
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .status-badge.open {
      background: rgba(0, 224, 255, 0.2);
      color: var(--cyan);
    }

    .status-badge.active {
      background: rgba(201, 163, 94, 0.2);
      color: var(--gold);
    }

    .status-badge.completed {
      background: rgba(0, 255, 0, 0.2);
      color: #0f0;
    }

    .project-description {
      color: var(--text-secondary);
      margin-bottom: 1rem;
      line-height: 1.5;
    }

    .project-tags, .project-skills {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .tag, .skill-badge {
      padding: 0.3rem 0.8rem;
      border-radius: 15px;
      font-size: 0.8rem;
      background: rgba(0, 224, 255, 0.1);
      color: var(--cyan);
    }

    .skill-badge.match {
      background: var(--gold);
      color: #000;
      font-weight: bold;
    }

    .project-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 1rem;
      border-top: 1px solid rgba(0, 224, 255, 0.2);
    }

    .project-stats {
      display: flex;
      gap: 1rem;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .project-actions {
      display: flex;
      gap: 0.5rem;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      backdrop-filter: blur(8px);
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-card);
      border: 2px solid var(--cyan);
      border-radius: 12px;
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal.large {
      max-width: 900px;
    }

    .modal h2 {
      color: var(--cyan);
      margin-bottom: 1.5rem;
      font-size: 1.6rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.8rem;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(0, 224, 255, 0.3);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 1rem;
      font-family: inherit;
      transition: var(--transition);
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--cyan);
      box-shadow: 0 0 15px var(--cyan-glow);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 120px;
    }

    .modal-actions {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }

    .modal-actions button {
      flex: 1;
    }

    /* Sub-tabs */
    .subtabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      border-bottom: 2px solid rgba(0, 224, 255, 0.2);
    }

    .subtab {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      padding: 1rem 1.5rem;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 600;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
    }

    .subtab:hover {
      color: var(--cyan);
    }

    .subtab.active {
      color: var(--cyan);
      border-bottom-color: var(--cyan);
    }

    .subtab-content {
      display: none;
    }

    .subtab-content.active {
      display: block;
    }

    /* Filters */
    .filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .filters input,
    .filters select {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(0, 224, 255, 0.3);
      border-radius: 8px;
      color: var(--text-primary);
      padding: 0.7rem 1rem;
      font-size: 0.9rem;
    }

    .filters input {
      flex: 1;
      min-width: 250px;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }

    .loading i {
      font-size: 2rem;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Hidden */
    .hidden {
      display: none !important;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header-content {
        padding: 0;
      }

      .nav-tabs {
        flex-direction: column;
        width: 100%;
      }

      .nav-tab {
        width: 100%;
        justify-content: center;
      }

      .card-grid {
        grid-template-columns: 1fr;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="header-top">
        <div>
          <div class="logo">CHARLESTONHACKS</div>
          <div class="tagline">INNOVATION ENGINE</div>
        </div>
        <div class="user-info">
          <span class="user-badge hidden" id="user-badge"></span>
          <button class="btn btn-secondary btn-small hidden" id="logout-btn">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </div>

      <!-- Navigation -->
      <div class="nav-tabs hidden" id="main-nav">
        <button class="nav-tab active" data-tab="home">
          <i class="fas fa-home"></i> Home
        </button>
        <button class="nav-tab" data-tab="people">
          <i class="fas fa-users"></i> People
        </button>
        <button class="nav-tab" data-tab="projects">
          <i class="fas fa-briefcase"></i> Projects
        </button>
        <button class="nav-tab" data-tab="messages">
          <i class="fas fa-comments"></i> Messages
        </button>
        <button class="nav-tab" data-tab="profile">
          <i class="fas fa-user"></i> Profile
        </button>
      </div>
    </div>
  </div>

  <div class="container">
    
    <!-- Login Tab -->
    <section id="login-tab" class="tab-content active">
      <div class="login-section">
        <div class="login-box">
          <h2><i class="fas fa-lock"></i> Sign In</h2>
          <p>Sign in to access the Innovation Engine and connect with the Charleston tech community.</p>
          
          <div class="login-buttons">
            <button id="github-login" class="btn">
              <i class="fab fa-github"></i> Sign in with GitHub
            </button>
            
            <button id="google-login" class="btn">
              <i class="fab fa-google"></i> Sign in with Google
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Home Tab -->
    <section id="home-tab" class="tab-content">
      <h1>Welcome Back, <span id="user-name">Friend</span>!</h1>
      
      <div class="stats-grid">
        <div class="stat-card">
          <i class="fas fa-users"></i>
          <span class="stat-value" id="connections-count">0</span>
          <span class="stat-label">Connections</span>
        </div>
        <div class="stat-card">
          <i class="fas fa-briefcase"></i>
          <span class="stat-value" id="projects-count">0</span>
          <span class="stat-label">Projects</span>
        </div>
        <div class="stat-card">
          <i class="fas fa-trophy"></i>
          <span class="stat-value" id="bids-accepted-count">0</span>
          <span class="stat-label">Bids Accepted</span>
        </div>
      </div>

      <div style="display: flex; gap: 1rem; margin: 2rem 0;">
        <button class="btn" onclick="switchTab('projects')">
          <i class="fas fa-search"></i> Browse Projects
        </button>
        <button class="btn btn-secondary" onclick="openCreateProjectModal()">
          <i class="fas fa-plus"></i> Create Project
        </button>
        <button class="btn btn-secondary" onclick="switchTab('people')">
          <i class="fas fa-users"></i> Find People
        </button>
      </div>

      <h2 style="color: var(--cyan); margin-top: 3rem; margin-bottom: 1rem;">Recommended Projects</h2>
      <div id="recommended-projects-grid" class="card-grid">
        <div class="loading"><i class="fas fa-spinner"></i><p>Loading recommendations...</p></div>
      </div>
    </section>

    <!-- People Tab -->
    <section id="people-tab" class="tab-content">
      <h1><i class="fas fa-users"></i> People</h1>
      
      <div class="subtabs">
        <button class="subtab active" data-subtab="search">Search</button>
        <button class="subtab" data-subtab="leaderboard">Leaderboard</button>
        <button class="subtab" data-subtab="connections">My Network</button>
      </div>

      <!-- Search Subtab -->
      <div id="search-subtab" class="subtab-content active">
        <div class="filters">
          <input type="text" id="people-search" placeholder="Search by name or skills...">
          <button class="btn btn-small" onclick="searchPeople()">
            <i class="fas fa-search"></i> Search
          </button>
        </div>
        <div id="people-results" class="card-grid"></div>
      </div>

      <!-- Leaderboard Subtab -->
      <div id="leaderboard-subtab" class="subtab-content">
        <div class="subtabs" style="margin-bottom: 1rem;">
          <button class="subtab active" data-leaderboard="skills">Top Skills</button>
          <button class="subtab" data-leaderboard="endorsed">Most Endorsed</button>
          <button class="subtab" data-leaderboard="connectors">Top Connectors</button>
        </div>
        <div id="leaderboard-results" class="card-grid">
          <div class="loading"><i class="fas fa-spinner"></i><p>Loading leaderboard...</p></div>
        </div>
      </div>

      <!-- Connections Subtab -->
      <div id="connections-subtab" class="subtab-content">
        <h2 style="margin-bottom: 1rem;">My Connections</h2>
        <div id="connections-results" class="card-grid">
          <div class="loading"><i class="fas fa-spinner"></i><p>Loading connections...</p></div>
        </div>
      </div>
    </section>

    <!-- Projects Tab -->
    <section id="projects-tab" class="tab-content">
      <h1><i class="fas fa-briefcase"></i> Projects</h1>
      
      <div class="filters">
        <input type="text" id="project-search" placeholder="Search projects...">
        <select id="status-filter">
          <option value="all">All Status</option>
          <option value="open">Open for Bids</option>
          <option value="active">Active</option>
          <option value="completed">Completed</option>
        </select>
        <button class="btn btn-small" onclick="openCreateProjectModal()">
          <i class="fas fa-plus"></i> Create Project
        </button>
      </div>

      <div class="subtabs">
        <button class="subtab active" data-subtab="marketplace">Marketplace</button>
        <button class="subtab" data-subtab="my-projects">My Projects</button>
        <button class="subtab" data-subtab="my-bids">My Bids</button>
      </div>

      <!-- Marketplace Subtab -->
      <div id="marketplace-subtab" class="subtab-content active">
        <div id="marketplace-grid" class="card-grid">
          <div class="loading"><i class="fas fa-spinner"></i><p>Loading projects...</p></div>
        </div>
      </div>

      <!-- My Projects Subtab -->
      <div id="my-projects-subtab" class="subtab-content">
        <div id="my-projects-grid" class="card-grid">
          <div class="loading"><i class="fas fa-spinner"></i><p>Loading your projects...</p></div>
        </div>
      </div>

      <!-- My Bids Subtab -->
      <div id="my-bids-subtab" class="subtab-content">
        <div id="my-bids-grid" class="card-grid">
          <div class="loading"><i class="fas fa-spinner"></i><p>Loading your bids...</p></div>
        </div>
      </div>
    </section>

    <!-- Messages Tab -->
    <section id="messages-tab" class="tab-content">
      <h1><i class="fas fa-comments"></i> Messages</h1>
      <p style="color: var(--text-secondary); margin: 2rem 0;">
        BBS messaging system coming soon... This will include public channels and project-specific team chat.
      </p>
    </section>

    <!-- Profile Tab -->
    <section id="profile-tab" class="tab-content">
      <h1><i class="fas fa-user"></i> Your Profile</h1>
      
      <form id="profile-form" style="max-width: 600px; margin-top: 2rem;">
        <div class="form-group">
          <label>First Name</label>
          <input type="text" id="first-name" required>
        </div>

        <div class="form-group">
          <label>Last Name</label>
          <input type="text" id="last-name" required>
        </div>

        <div class="form-group">
          <label>Email</label>
          <input type="email" id="email" required>
        </div>

        <div class="form-group">
          <label>Skills (comma-separated)</label>
          <input type="text" id="skills-input" placeholder="e.g., React, Python, UI/UX">
        </div>

        <div class="form-group">
          <label>Bio</label>
          <textarea id="bio-input" maxlength="500" placeholder="Tell us about yourself..."></textarea>
        </div>

        <div class="form-group">
          <label>Availability</label>
          <select id="availability-input">
            <option>Available</option>
            <option>Busy</option>
            <option>Not Looking</option>
          </select>
        </div>

        <button type="submit" class="btn">
          <i class="fas fa-save"></i> Save Profile
        </button>
      </form>
    </section>

  </div>

  <!-- Create Project Modal -->
  <div id="create-project-modal" class="modal-overlay">
    <div class="modal">
      <h2>Create New Project</h2>
      <form id="create-project-form">
        <div class="form-group">
          <label>Project Title</label>
          <input type="text" id="project-title" required placeholder="e.g., AI-Powered Code Reviewer">
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea id="project-description" required placeholder="Describe your project idea..."></textarea>
        </div>

        <div class="form-group">
          <label>Tags (comma-separated)</label>
          <input type="text" id="project-tags" placeholder="e.g., AI, Developer Tools, SaaS">
        </div>

        <div class="form-group">
          <label>Required Skills (comma-separated)</label>
          <input type="text" id="project-skills" placeholder="e.g., React, Python, UI/UX">
        </div>

        <div class="form-group">
          <label>Timeline</label>
          <input type="text" id="project-timeline" placeholder="e.g., 3 months, ongoing">
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" id="project-use-cynq" checked>
            Use CYNQ Workflow for this project
          </label>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeCreateProjectModal()">Cancel</button>
          <button type="submit" class="btn">Create Project</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Bid Modal -->
  <div id="bid-modal" class="modal-overlay">
    <div class="modal">
      <h2>Submit Your Bid</h2>
      <form id="bid-form">
        <input type="hidden" id="bid-project-id">
        
        <div class="form-group">
          <label>Why are you interested in this project?</label>
          <textarea id="bid-pitch" required placeholder="Share your motivation and how you can contribute..."></textarea>
        </div>

        <div class="form-group">
          <label>Proposed Role</label>
          <input type="text" id="bid-role" placeholder="e.g., Frontend Developer">
        </div>

        <div class="form-group">
          <label>Portfolio Links (optional)</label>
          <input type="text" id="bid-portfolio" placeholder="GitHub, LinkedIn, portfolio website...">
        </div>

        <div class="form-group">
          <label>Availability</label>
          <select id="bid-availability">
            <option>5-10 hours/week</option>
            <option>10-20 hours/week</option>
            <option>20+ hours/week</option>
            <option>Full-time</option>
          </select>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeBidModal()">Cancel</button>
          <button type="submit" class="btn">Submit Bid</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Project Detail Modal -->
  <div id="project-detail-modal" class="modal-overlay">
    <div class="modal large">
      <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 2rem;">
        <h2 id="detail-project-title">Project Title</h2>
        <button onclick="closeProjectDetail()" style="background: transparent; border: none; color: var(--cyan); font-size: 2rem; cursor: pointer;">&times;</button>
      </div>
      
      <div id="project-detail-content">
        <!-- Will be populated dynamically -->
      </div>
    </div>
  </div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script>
    // SUPABASE CONFIG - Replace with your credentials
    const SUPABASE_URL = 'https://lrsqxxnkzrfxthdqctgx.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxyc3F4eG5renJmeHRoZHFjdGd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzE3Nzc2MDEsImV4cCI6MjA0NzM1MzYwMX0.lPJXMHqJ59YD0gQaUPbhAX62IEY_PY16PljHiSrVFqQ';
    
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    
    let currentUser = null;
    let currentUserProfile = null;

    // ===========================================
    // AUTH MANAGEMENT
    // ===========================================
    
    async function checkAuth() {
      const { data: { session } } = await supabase.auth.getSession();
      
      if (session?.user) {
        currentUser = session.user;
        await loadUserProfile();
        showAuthenticatedUI();
      } else {
        showLoginUI();
      }
    }

    async function loadUserProfile() {
      const { data, error } = await supabase
        .from('community')
        .select('*')
        .eq('user_id', currentUser.id)
        .single();
        
      if (data) {
        currentUserProfile = data;
        populateProfileForm(data);
      }
    }

    function showAuthenticatedUI() {
      document.getElementById('login-tab').classList.remove('active');
      document.getElementById('home-tab').classList.add('active');
      document.getElementById('main-nav').classList.remove('hidden');
      document.getElementById('user-badge').textContent = currentUser.email;
      document.getElementById('user-badge').classList.remove('hidden');
      document.getElementById('logout-btn').classList.remove('hidden');
      
      loadHomeData();
    }

    function showLoginUI() {
      document.getElementById('login-tab').classList.add('active');
      document.getElementById('main-nav').classList.add('hidden');
      document.getElementById('user-badge').classList.add('hidden');
      document.getElementById('logout-btn').classList.add('hidden');
    }

    // Auth handlers
    document.getElementById('github-login')?.addEventListener('click', async () => {
      await supabase.auth.signInWithOAuth({
        provider: 'github',
        options: { redirectTo: window.location.origin }
      });
    });

    document.getElementById('google-login')?.addEventListener('click', async () => {
      await supabase.auth.signInWithOAuth({
        provider: 'google',
        options: { redirectTo: window.location.origin }
      });
    });

    document.getElementById('logout-btn')?.addEventListener('click', async () => {
      await supabase.auth.signOut();
      location.reload();
    });

    // Listen for auth changes
    supabase.auth.onAuthStateChange((event, session) => {
      if (event === 'SIGNED_IN') {
        currentUser = session.user;
        loadUserProfile().then(() => showAuthenticatedUI());
      } else if (event === 'SIGNED_OUT') {
        showLoginUI();
      }
    });

    // ===========================================
    // NAVIGATION
    // ===========================================
    
    function switchTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected tab
      document.getElementById(tabName + '-tab').classList.add('active');
      
      // Update nav buttons
      document.querySelectorAll('.nav-tab').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-tab="${tabName}"]`)?.classList.add('active');
      
      // Load tab data
      if (tabName === 'home') loadHomeData();
      else if (tabName === 'people') loadPeopleData();
      else if (tabName === 'projects') loadProjectsData();
    }

    // Tab click handlers
    document.querySelectorAll('.nav-tab').forEach(btn => {
      btn.addEventListener('click', () => {
        switchTab(btn.dataset.tab);
      });
    });

    // Subtab handlers
    document.querySelectorAll('.subtab').forEach(btn => {
      btn.addEventListener('click', () => {
        const parent = btn.closest('section');
        parent.querySelectorAll('.subtab').forEach(st => st.classList.remove('active'));
        parent.querySelectorAll('.subtab-content').forEach(sc => sc.classList.remove('active'));
        
        btn.classList.add('active');
        const subtabName = btn.dataset.subtab || btn.dataset.leaderboard;
        if (subtabName) {
          parent.querySelector(`#${subtabName}-subtab`)?.classList.add('active');
        }
        
        // Load data for subtab
        if (btn.dataset.leaderboard) {
          loadLeaderboard(btn.dataset.leaderboard);
        }
      });
    });

    // ===========================================
    // HOME TAB
    // ===========================================
    
    async function loadHomeData() {
      if (!currentUser) return;
      
      // Set user name
      document.getElementById('user-name').textContent = 
        currentUserProfile?.name || currentUser.email.split('@')[0];
      
      // Load stats
      const { data: connections } = await supabase
        .from('connections')
        .select('id', { count: 'exact' })
        .or(`from_user_id.eq.${currentUser.id},to_user_id.eq.${currentUser.id}`)
        .eq('status', 'accepted');
      
      const { data: projects } = await supabase
        .from('project_members')
        .select('id', { count: 'exact' })
        .eq('user_id', currentUser.id);
      
      document.getElementById('connections-count').textContent = connections?.length || 0;
      document.getElementById('projects-count').textContent = projects?.length || 0;
      document.getElementById('bids-accepted-count').textContent = 
        currentUserProfile?.bids_accepted || 0;
      
      // Load recommended projects
      loadRecommendedProjects();
    }

    async function loadRecommendedProjects() {
      const userSkills = currentUserProfile?.skills || [];
      
      const { data: projects } = await supabase
        .from('projects')
        .select('*')
        .eq('status', 'open')
        .limit(3);
      
      const grid = document.getElementById('recommended-projects-grid');
      if (!projects || projects.length === 0) {
        grid.innerHTML = '<p style="color: var(--text-secondary);">No recommended projects yet. Check out the Projects tab!</p>';
        return;
      }
      
      grid.innerHTML = projects.map(project => createProjectCard(project, userSkills)).join('');
    }

    // ===========================================
    // PROJECTS TAB
    // ===========================================
    
    async function loadProjectsData() {
      loadMarketplaceProjects();
      loadMyProjects();
      loadMyBids();
    }

    async function loadMarketplaceProjects() {
      const { data: projects } = await supabase
        .from('projects')
        .select('*')
        .eq('status', 'open')
        .order('created_at', { ascending: false });
      
      const grid = document.getElementById('marketplace-grid');
      const userSkills = currentUserProfile?.skills || [];
      
      if (!projects || projects.length === 0) {
        grid.innerHTML = '<p style="color: var(--text-secondary);">No open projects yet. Be the first to create one!</p>';
        return;
      }
      
      grid.innerHTML = projects.map(p => createProjectCard(p, userSkills)).join('');
    }

    async function loadMyProjects() {
      const { data: projects } = await supabase
        .from('projects')
        .select('*')
        .eq('creator_id', currentUser.id)
        .order('created_at', { ascending: false });
      
      const grid = document.getElementById('my-projects-grid');
      
      if (!projects || projects.length === 0) {
        grid.innerHTML = '<p style="color: var(--text-secondary);">You haven\'t created any projects yet.</p>';
        return;
      }
      
      grid.innerHTML = projects.map(p => createProjectCard(p, [])).join('');
    }

    async function loadMyBids() {
      const { data: bids } = await supabase
        .from('project_bids')
        .select(`
          *,
          projects (*)
        `)
        .eq('user_id', currentUser.id)
        .order('created_at', { ascending: false });
      
      const grid = document.getElementById('my-bids-grid');
      
      if (!bids || bids.length === 0) {
        grid.innerHTML = '<p style="color: var(--text-secondary);">You haven\'t submitted any bids yet.</p>';
        return;
      }
      
      grid.innerHTML = bids.map(bid => createBidCard(bid)).join('');
    }

    function createProjectCard(project, userSkills = []) {
      const matchedSkills = project.required_skills?.filter(skill => 
        userSkills.some(us => us.toLowerCase() === skill.toLowerCase())
      ) || [];
      
      return `
        <div class="project-card" onclick="viewProjectDetail('${project.id}')">
          <div class="project-header">
            <h3>${escapeHtml(project.title)}</h3>
            <span class="status-badge ${project.status}">${project.status}</span>
          </div>
          
          <p class="project-description">${escapeHtml(project.description)}</p>
          
          ${project.tags?.length ? `
            <div class="project-tags">
              ${project.tags.map(tag => `<span class="tag">${escapeHtml(tag)}</span>`).join('')}
            </div>
          ` : ''}
          
          ${project.required_skills?.length ? `
            <div class="project-skills">
              ${project.required_skills.map(skill => `
                <span class="skill-badge ${matchedSkills.includes(skill) ? 'match' : ''}">
                  ${escapeHtml(skill)}
                </span>
              `).join('')}
            </div>
          ` : ''}
          
          <div class="project-footer">
            <div class="project-stats">
              <span><i class="fas fa-users"></i> ${project.bid_count || 0} bids</span>
              <span><i class="fas fa-arrow-up"></i> ${project.upvote_count || 0}</span>
            </div>
            <div class="project-actions">
              <button class="btn btn-small btn-secondary" onclick="event.stopPropagation(); viewProjectDetail('${project.id}')">View</button>
              ${project.creator_id !== currentUser.id && project.status === 'open' ? `
                <button class="btn btn-small" onclick="event.stopPropagation(); openBidModal('${project.id}')">Bid</button>
              ` : ''}
            </div>
          </div>
        </div>
      `;
    }

    function createBidCard(bid) {
      const statusColors = {
        pending: 'status-badge open',
        accepted: 'status-badge active',
        rejected: 'status-badge'
      };
      
      return `
        <div class="card">
          <div class="project-header">
            <h3>${escapeHtml(bid.projects.title)}</h3>
            <span class="${statusColors[bid.status]}">${bid.status}</span>
          </div>
          <p style="color: var(--text-secondary); margin: 1rem 0;">${escapeHtml(bid.pitch_message)}</p>
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary); font-size: 0.9rem;">
              Proposed role: ${escapeHtml(bid.proposed_role || 'Not specified')}
            </span>
            <button class="btn btn-small btn-secondary" onclick="viewProjectDetail('${bid.project_id}')">
              View Project
            </button>
          </div>
        </div>
      `;
    }

    // ===========================================
    // PROJECT DETAIL
    // ===========================================
    
    async function viewProjectDetail(projectId) {
      const { data: project } = await supabase
        .from('projects')
        .select(`
          *,
          community!projects_creator_id_fkey (name, email, image_url),
          project_members (
            id,
            role,
            community (name, email, image_url)
          ),
          project_bids (
            id,
            pitch_message,
            proposed_role,
            status,
            created_at,
            community!project_bids_user_id_fkey (name, email, image_url, user_id)
          )
        `)
        .eq('id', projectId)
        .single();
      
      if (!project) return;
      
      const isCreator = project.creator_id === currentUser.id;
      const isMember = project.project_members?.some(m => m.community.user_id === currentUser.id);
      
      document.getElementById('detail-project-title').textContent = project.title;
      document.getElementById('project-detail-content').innerHTML = `
        <div style="margin-bottom: 2rem;">
          <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
            <img src="${project.community.image_url || 'https://via.placeholder.com/50'}" 
                 style="width: 50px; height: 50px; border-radius: 50%;">
            <div>
              <div style="color: var(--text-primary);">${escapeHtml(project.community.name || project.community.email)}</div>
              <div style="color: var(--text-secondary); font-size: 0.9rem;">Project Creator</div>
            </div>
          </div>
          
          <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 1rem;">
            ${escapeHtml(project.description)}
          </p>
          
          ${project.timeline ? `
            <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">
              <strong>Timeline:</strong> ${escapeHtml(project.timeline)}
            </p>
          ` : ''}
          
          ${project.required_skills?.length ? `
            <div style="margin: 1rem 0;">
              <strong style="color: var(--cyan);">Required Skills:</strong>
              <div class="project-skills" style="margin-top: 0.5rem;">
                ${project.required_skills.map(skill => `<span class="skill-badge">${escapeHtml(skill)}</span>`).join('')}
              </div>
            </div>
          ` : ''}
        </div>
        
        <div style="margin: 2rem 0;">
          <h3 style="color: var(--cyan); margin-bottom: 1rem;">
            Team Members (${project.project_members?.length || 0})
          </h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
            ${project.project_members?.map(member => `
              <div class="card" style="padding: 1rem; text-align: center;">
                <img src="${member.community.image_url || 'https://via.placeholder.com/60'}" 
                     style="width: 60px; height: 60px; border-radius: 50%; margin-bottom: 0.5rem;">
                <div style="color: var(--text-primary); font-weight: 600;">
                  ${escapeHtml(member.community.name || member.community.email)}
                </div>
                <div style="color: var(--text-secondary); font-size: 0.85rem;">
                  ${escapeHtml(member.role)}
                </div>
              </div>
            `).join('') || '<p style="color: var(--text-secondary);">No team members yet.</p>'}
          </div>
        </div>
        
        ${isCreator && project.project_bids?.length ? `
          <div style="margin: 2rem 0;">
            <h3 style="color: var(--cyan); margin-bottom: 1rem;">
              Bids Received (${project.project_bids.length})
            </h3>
            ${project.project_bids.map(bid => `
              <div class="card" style="margin-bottom: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                  <div style="display: flex; align-items: center; gap: 1rem;">
                    <img src="${bid.community.image_url || 'https://via.placeholder.com/50'}" 
                         style="width: 50px; height: 50px; border-radius: 50%;">
                    <div>
                      <div style="color: var(--text-primary); font-weight: 600;">
                        ${escapeHtml(bid.community.name || bid.community.email)}
                      </div>
                      <div style="color: var(--text-secondary); font-size: 0.85rem;">
                        ${escapeHtml(bid.proposed_role || 'No role specified')}
                      </div>
                    </div>
                  </div>
                  <span class="status-badge ${bid.status === 'accepted' ? 'active' : 'open'}">
                    ${bid.status}
                  </span>
                </div>
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                  ${escapeHtml(bid.pitch_message)}
                </p>
                ${bid.status === 'pending' ? `
                  <div style="display: flex; gap: 0.5rem;">
                    <button class="btn btn-small" onclick="acceptBid('${bid.id}', '${project.id}')">
                      Accept
                    </button>
                    <button class="btn btn-small btn-secondary" onclick="rejectBid('${bid.id}', '${project.id}')">
                      Decline
                    </button>
                  </div>
                ` : ''}
              </div>
            `).join('')}
          </div>
        ` : ''}
        
        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
          ${isMember && project.use_cynq_workflow ? `
            <button class="btn" onclick="openCYNQ('${project.id}')">
              <i class="fas fa-brain"></i> Open Workflow
            </button>
          ` : ''}
          
          ${!isCreator && !isMember && project.status === 'open' ? `
            <button class="btn" onclick="closeProjectDetail(); openBidModal('${project.id}')">
              <i class="fas fa-hand-paper"></i> Submit Bid
            </button>
          ` : ''}
          
          <button class="btn btn-secondary" onclick="closeProjectDetail()">Close</button>
        </div>
      `;
      
      document.getElementById('project-detail-modal').classList.add('active');
    }

    function closeProjectDetail() {
      document.getElementById('project-detail-modal').classList.remove('active');
    }

    function openCYNQ(projectId) {
      window.open(`/cynq.html?project=${projectId}`, '_blank');
    }

    // ===========================================
    // CREATE PROJECT
    // ===========================================
    
    function openCreateProjectModal() {
      document.getElementById('create-project-modal').classList.add('active');
    }

    function closeCreateProjectModal() {
      document.getElementById('create-project-modal').classList.remove('active');
      document.getElementById('create-project-form').reset();
    }

    document.getElementById('create-project-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const projectData = {
        creator_id: currentUser.id,
        title: document.getElementById('project-title').value,
        description: document.getElementById('project-description').value,
        tags: document.getElementById('project-tags').value.split(',').map(t => t.trim()).filter(Boolean),
        required_skills: document.getElementById('project-skills').value.split(',').map(s => s.trim()).filter(Boolean),
        timeline: document.getElementById('project-timeline').value,
        use_cynq_workflow: document.getElementById('project-use-cynq').checked,
        status: 'open'
      };
      
      const { data, error } = await supabase
        .from('projects')
        .insert([projectData])
        .select()
        .single();
      
      if (error) {
        alert('Error creating project: ' + error.message);
        return;
      }
      
      closeCreateProjectModal();
      alert('Project created successfully!');
      
      if (projectData.use_cynq_workflow) {
        openCYNQ(data.id);
      }
      
      loadProjectsData();
    });

    // ===========================================
    // BIDDING
    // ===========================================
    
    function openBidModal(projectId) {
      document.getElementById('bid-project-id').value = projectId;
      document.getElementById('bid-modal').classList.add('active');
    }

    function closeBidModal() {
      document.getElementById('bid-modal').classList.remove('active');
      document.getElementById('bid-form').reset();
    }

    document.getElementById('bid-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const bidData = {
        project_id: document.getElementById('bid-project-id').value,
        user_id: currentUser.id,
        pitch_message: document.getElementById('bid-pitch').value,
        proposed_role: document.getElementById('bid-role').value,
        portfolio_links: document.getElementById('bid-portfolio').value ? 
          [document.getElementById('bid-portfolio').value] : [],
        availability: document.getElementById('bid-availability').value,
        status: 'pending'
      };
      
      const { error } = await supabase
        .from('project_bids')
        .insert([bidData]);
      
      if (error) {
        alert('Error submitting bid: ' + error.message);
        return;
      }
      
      closeBidModal();
      alert('Bid submitted successfully! The project creator will review it.');
      loadMyBids();
    });

    async function acceptBid(bidId, projectId) {
      const { error } = await supabase
        .from('project_bids')
        .update({ status: 'accepted' })
        .eq('id', bidId);
      
      if (error) {
        alert('Error accepting bid: ' + error.message);
        return;
      }
      
      alert('Bid accepted! Team member added.');
      viewProjectDetail(projectId);
    }

    async function rejectBid(bidId, projectId) {
      const { error } = await supabase
        .from('project_bids')
        .update({ status: 'rejected' })
        .eq('id', bidId);
      
      if (error) {
        alert('Error rejecting bid: ' + error.message);
        return;
      }
      
      alert('Bid declined.');
      viewProjectDetail(projectId);
    }

    // ===========================================
    // PEOPLE TAB
    // ===========================================
    
    async function loadPeopleData() {
      searchPeople();
      loadLeaderboard('skills');
      loadConnections();
    }

    async function searchPeople() {
      const searchTerm = document.getElementById('people-search')?.value.toLowerCase() || '';
      
      let query = supabase
        .from('community')
        .select('*')
        .neq('user_id', currentUser.id);
      
      if (searchTerm) {
        query = query.or(`name.ilike.%${searchTerm}%,email.ilike.%${searchTerm}%`);
      }
      
      const { data: people } = await query.limit(20);
      
      const grid = document.getElementById('people-results');
      
      if (!people || people.length === 0) {
        grid.innerHTML = '<p style="color: var(--text-secondary);">No people found.</p>';
        return;
      }
      
      grid.innerHTML = people.map(person => createPersonCard(person)).join('');
    }

    function createPersonCard(person) {
      return `
        <div class="card">
          <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
            <img src="${person.image_url || 'https://via.placeholder.com/60'}" 
                 style="width: 60px; height: 60px; border-radius: 50%;">
            <div>
              <div style="color: var(--text-primary); font-weight: 600; font-size: 1.1rem;">
                ${escapeHtml(person.name || person.email)}
              </div>
              <div style="color: var(--text-secondary); font-size: 0.85rem;">
                ${person.availability || 'Available'}
              </div>
            </div>
          </div>
          
          ${person.bio ? `
            <p style="color: var(--text-secondary); margin-bottom: 1rem; line-height: 1.4;">
              ${escapeHtml(person.bio)}
            </p>
          ` : ''}
          
          ${person.skills?.length ? `
            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem;">
              ${person.skills.slice(0, 5).map(skill => `
                <span class="skill-badge">${escapeHtml(skill)}</span>
              `).join('')}
              ${person.skills.length > 5 ? `<span class="tag">+${person.skills.length - 5} more</span>` : ''}
            </div>
          ` : ''}
          
          <button class="btn btn-small" onclick="sendConnectionRequest('${person.user_id}')">
            <i class="fas fa-user-plus"></i> Connect
          </button>
        </div>
      `;
    }

    async function loadLeaderboard(type) {
      // Simplified leaderboard - you can enhance this
      const { data: people } = await supabase
        .from('community')
        .select('*')
        .order('connection_count', { ascending: false })
        .limit(10);
      
      const grid = document.getElementById('leaderboard-results');
      
      if (!people || people.length === 0) {
        grid.innerHTML = '<p style="color: var(--text-secondary);">No data yet.</p>';
        return;
      }
      
      grid.innerHTML = people.map((person, index) => `
        <div class="card">
          <div style="display: flex; align-items: center; gap: 1rem;">
            <div style="font-size: 2rem; color: var(--gold); font-weight: bold; width: 40px;">
              #${index + 1}
            </div>
            <img src="${person.image_url || 'https://via.placeholder.com/50'}" 
                 style="width: 50px; height: 50px; border-radius: 50%;">
            <div style="flex: 1;">
              <div style="color: var(--text-primary); font-weight: 600;">
                ${escapeHtml(person.name || person.email)}
              </div>
              <div style="color: var(--text-secondary); font-size: 0.85rem;">
                ${person.connection_count || 0} connections
              </div>
            </div>
          </div>
        </div>
      `).join('');
    }

    async function loadConnections() {
      const { data: connections } = await supabase
        .from('connections')
        .select(`
          *,
          from_community:community!connections_from_user_id_fkey(*),
          to_community:community!connections_to_user_id_fkey(*)
        `)
        .or(`from_user_id.eq.${currentUser.id},to_user_id.eq.${currentUser.id}`)
        .eq('status', 'accepted');
      
      const grid = document.getElementById('connections-results');
      
      if (!connections || connections.length === 0) {
        grid.innerHTML = '<p style="color: var(--text-secondary);">No connections yet. Start connecting with people!</p>';
        return;
      }
      
      grid.innerHTML = connections.map(conn => {
        const person = conn.from_user_id === currentUser.id ? conn.to_community : conn.from_community;
        return createPersonCard(person);
      }).join('');
    }

    async function sendConnectionRequest(toUserId) {
      const { error } = await supabase
        .from('connections')
        .insert([{
          from_user_id: currentUser.id,
          to_user_id: toUserId,
          status: 'pending',
          type: 'generic'
        }]);
      
      if (error) {
        if (error.code === '23505') {
          alert('Connection request already sent or you are already connected.');
        } else {
          alert('Error sending connection request: ' + error.message);
        }
        return;
      }
      
      alert('Connection request sent!');
    }

    // ===========================================
    // PROFILE TAB
    // ===========================================
    
    function populateProfileForm(profile) {
      document.getElementById('first-name').value = profile.name?.split(' ')[0] || '';
      document.getElementById('last-name').value = profile.name?.split(' ').slice(1).join(' ') || '';
      document.getElementById('email').value = profile.email || currentUser.email;
      document.getElementById('skills-input').value = profile.skills?.join(', ') || '';
      document.getElementById('bio-input').value = profile.bio || '';
      document.getElementById('availability-input').value = profile.availability || 'Available';
    }

    document.getElementById('profile-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const profileData = {
        name: `${document.getElementById('first-name').value} ${document.getElementById('last-name').value}`.trim(),
        email: document.getElementById('email').value,
        skills: document.getElementById('skills-input').value.split(',').map(s => s.trim()).filter(Boolean),
        bio: document.getElementById('bio-input').value,
        availability: document.getElementById('availability-input').value,
        user_id: currentUser.id
      };
      
      const { error } = await supabase
        .from('community')
        .upsert([profileData], { onConflict: 'user_id' });
      
      if (error) {
        alert('Error saving profile: ' + error.message);
        return;
      }
      
      alert('Profile saved successfully!');
      await loadUserProfile();
    });

    // ===========================================
    // UTILITIES
    // ===========================================
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ===========================================
    // INITIALIZE
    // ===========================================
    
    checkAuth();
  </script>
</body>
</html>
