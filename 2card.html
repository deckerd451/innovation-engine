// CharlestonHacks â€“ AUTH DEBUG (SAFE + NO SPAM)
// Toggles only by clicking ðŸž button.

async function waitForSupabase() {
  while (!window.supabase) {
    await new Promise(res => setTimeout(res, 40));
  }
  return window.supabase;
}

function createDebugPanel() {
  let panel = document.getElementById("auth-debug-overlay");
  if (!panel) {
    panel = document.createElement("div");
    panel.id = "auth-debug-overlay";
    panel.style.cssText = `
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 360px;
      max-width: 90vw;
      max-height: 40vh;
      overflow-y: auto;
      background: rgba(0,0,0,0.88);
      color: #0ff;
      font-size: 12px;
      font-family: monospace;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #0ff;
      z-index: 999999;
      white-space: pre-wrap;
      display: none;
    `;
    document.body.appendChild(panel);
  }
  return panel;
}

function makeLogger(panel) {
  return function log(message) {
    const entry = `[${new Date().toLocaleTimeString()}]\n${message}\n\n`;
    panel.textContent = entry + panel.textContent;
  };
}

async function initAuthDebug() {
  const supabase = await waitForSupabase();
  const panel = createDebugPanel();
  const log = makeLogger(panel);

  supabase.auth.onAuthStateChange((event, session) => {
    log(`EVENT: ${event}\nUSER: ${session?.user?.email || "none"}`);
  });

  async function refresh() {
    const { data } = await supabase.auth.getSession();
    log(`SESSION: ${data?.session ? "ACTIVE" : "NONE"}`);
  }

  setInterval(refresh, 2500);
  refresh();
}

initAuthDebug();
