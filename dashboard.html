<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Cache refresh: 2026-01-18 FORCE DEPLOYMENT -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CharlestonHacks Innovation Engine</title>
  <link rel="icon" href="favicon.ico"/>

  <!-- Core CSS -->
  <link rel="stylesheet" href="assets/css/base.css" />
  <link rel="stylesheet" href="assets/css/engine.css" />
  <link rel="stylesheet" href="assets/css/overlays.css" />
  <link rel="stylesheet" href="assets/css/connections.css" />
  <link rel="stylesheet" href="assets/css/cynq.css" />
  <link rel="stylesheet" href="assets/css/messaging.css" />
  <link rel="stylesheet" href="dashboard.css" />

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    /* NUCLEAR OPTION: Force black backgrounds everywhere */
    html,
    body,
    #main-content,
    #synapse-main-view,
    #synapse-svg,
    .unified-main {
      background: #000 !important;
      background-color: #000 !important;
    }

    /* Ensure full coverage with no gaps */
    html, body {
      margin: 0 !important;
      padding: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      overflow: hidden !important;
    }

    /* Override any pseudo-elements */
    body::before,
    body::after,
    html::before,
    html::after {
      display: none !important;
    }

    body { overflow: hidden; }

    /* Hover effects for action buttons */
    .action-btn:hover {
      transform: translateY(-5px) scale(1.1);
      filter: brightness(1.3);
    }

    .action-btn:active {
      transform: translateY(-2px) scale(1.05);
    }

    /* START button hover */
    #btn-start-center:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 40px rgba(0,255,136,0.6);
      filter: brightness(1.3);
    }

    #btn-start-center:active {
      transform: scale(1.05);
    }

    #btn-explore-cancel:hover {
      background: rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.5);
      color: rgba(255,255,255,0.9);
    }

    /* Mentor Navigation Styling */
    .mentor-nav-btn:hover {
      background: rgba(0,224,255,0.12) !important;
      border-color: rgba(0,224,255,0.3) !important;
      color: rgba(255,255,255,0.95) !important;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,224,255,0.2);
    }

    .mentor-nav-btn.active-mentor {
      animation: softGlow 2s ease-in-out infinite;
    }

    @keyframes softGlow {
      0%, 100% {
        box-shadow: 0 0 8px rgba(0,224,255,0.2), inset 0 0 8px rgba(0,224,255,0.05);
      }
      50% {
        box-shadow: 0 0 16px rgba(0,224,255,0.3), inset 0 0 12px rgba(0,224,255,0.08);
      }
    }

    .mentor-panel-close:hover {
      background: rgba(255,255,255,0.15) !important;
      border-color: rgba(255,255,255,0.3) !important;
      color: rgba(255,255,255,1) !important;
    }

    .mentor-panel {
      animation: mentorPanelSlide 0.3s ease-out;
    }

    @keyframes mentorPanelSlide {
      from {
        opacity: 0;
        transform: translate(-50%, -45%);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%);
      }
    }

    /* Responsive mentor nav */
    @media (max-width: 768px) {
      #mentor-nav {
        bottom: 98px !important;
        width: 95vw !important;
        padding: 0.4rem !important;
        gap: 0.3rem !important;
      }

      .mentor-nav-btn {
        font-size: 0.75rem !important;
        padding: 0 0.3rem !important;
      }

      .mentor-nav-btn i {
        font-size: 0.9rem !important;
      }

      .mentor-nav-btn span {
        display: none;
      }

      #mentor-nav.compact {
        height: 40px !important;
      }

      /* Responsive mentor panels for mobile */
      .mentor-panel {
        width: 95vw !important;
        max-height: 90vh !important;
        padding: 1rem !important;
        border-radius: 12px !important;
      }

      .mentor-panel h2 {
        font-size: 1.2rem !important;
      }

      .mentor-panel p {
        font-size: 0.9rem !important;
      }

      .mentor-panel-close {
        width: 32px !important;
        height: 32px !important;
        top: 0.5rem !important;
        right: 0.5rem !important;
      }
    }

    .stat-card-mini:hover {
      transform: translateY(-3px);
      background: rgba(0,224,255,0.15) !important;
      border-color: rgba(0,224,255,0.5) !important;
      box-shadow: 0 4px 12px rgba(0,224,255,0.3);
    }

    /* Engagement system animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-30px); }
      60% { transform: translateY(-15px); }
    }

    @media (max-width: 768px) {
      .bottom-stats-bar { gap: 0.25rem; padding: 0.5rem; }
      .stat-card-mini { padding: 0.5rem !important; }
      .stat-card-mini .label { font-size: 0.65rem !important; }
      .stat-card-mini .value { font-size: 1.25rem !important; }
    }

    .bottom-stats-bar::-webkit-scrollbar { height: 6px; }
    .bottom-stats-bar::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); }
    .bottom-stats-bar::-webkit-scrollbar-thumb { background: rgba(0,224,255,0.3); border-radius: 3px; }
    .bottom-stats-bar::-webkit-scrollbar-thumb:hover { background: rgba(0,224,255,0.5); }

    .bottom-stats-bar > div { flex: 0 0 auto; min-width: 150px; }
  </style>
</head>

<body>
  <!-- Neural Background -->
  <canvas id="neural-bg"
    style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
    background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);"></canvas>

  <!-- Login -->
  <div id="login-section" class="active-tab-pane"
    style="position: fixed; inset: 0; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center;
    z-index: 9999; overflow: hidden; background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);">
    <div class="login-container">
      <img src="ieheader.webp"
           alt="CharlestonHacks Innovation Engine"
           style="max-width: 100%; height: auto; margin-bottom: 1rem;"
           onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
      <h1 style="display:none; color:#00e0ff; font-size:2rem; margin-bottom:1rem;">CharlestonHacks Innovation Engine</h1>

      <h2 style="color:#00e0ff; font-size:1.5rem; font-weight:bold; margin-bottom:0.75rem;">
        Making Invisible Networks Visible
      </h2>

      <p style="color:#ddd; font-size:1.1rem; line-height:1.6; margin-bottom:2rem; max-width:520px;">
        Discover people, skills, and collaboration opportunities in your innovation ecosystem.
        Connect with the right people, join projects, and build something amazing together.
      </p>

      <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:1.5rem; margin-bottom:2rem; max-width:620px;">
        <div style="text-align:center;">
          <i class="fas fa-network-wired" style="font-size:2rem; color:#00e0ff; margin-bottom:0.5rem;"></i>
          <div style="color:#ddd; font-size:0.9rem;">Visualize Your Network</div>
        </div>
        <div style="text-align:center;">
          <i class="fas fa-search" style="font-size:2rem; color:#00e0ff; margin-bottom:0.5rem;"></i>
          <div style="color:#ddd; font-size:0.9rem;">Find Skills & People</div>
        </div>
        <div style="text-align:center;">
          <i class="fas fa-users" style="font-size:2rem; color:#00e0ff; margin-bottom:0.5rem;"></i>
          <div style="color:#ddd; font-size:0.9rem;">Build Together</div>
        </div>
      </div>

      <div class="oauth-buttons">
        <button id="github-login" class="oauth-btn">
          <span class="oauth-icon-circle">
            <i class="fab fa-github"></i>
          </span>
          Continue with GitHub
        </button>
        <button id="google-login" class="oauth-btn">
          <span class="oauth-icon-circle">
            <i class="fab fa-google"></i>
          </span>
          Continue with Google
        </button>
      </div>

      <div id="login-hint" style="margin-top: 1rem; color: #aaa; font-size: 0.9rem;"></div>
    </div>
  </div>

  <!-- Main -->
  <div class="unified-main" id="main-content" style="position: fixed; inset: 0; overflow: hidden; background: #000000;">
    <!-- Header Elements (No Background Bar) -->
    <div style="position:absolute; top:20px; left:20px; z-index:1000;">
      <a href="https://charlestonhacks.com/" style="display:flex; align-items:center; text-decoration:none;">
        <img src="charlestonhackslogo.svg" alt="CharlestonHacks"
             style="height:55px; width:auto; cursor:pointer;"
             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
        <span style="display:none; color:#00e0ff; font-size:1.5rem; font-weight:bold;">CharlestonHacks</span>
      </a>
    </div>

    <div style="position:absolute; top:20px; right:20px; z-index:1000; display:flex; align-items:center; gap:1rem;">
      <!-- Level Badge -->
      <div style="padding:0.75rem 1.5rem; background:rgba(0,224,255,0.15); border:1px solid rgba(0,224,255,0.3);
        border-radius:8px; display:flex; flex-direction:column; align-items:center;">
        <div style="color:#00e0ff; font-size:0.8rem; font-weight:600;">Level 6</div>
        <div style="color:#aaa; font-size:0.7rem;">Leader</div>
        <div style="color:#888; font-size:0.65rem; margin-top:0.25rem;" id="user-xp">2173 / 5000 XP</div>
      </div>

      <!-- Streak Badge -->
      <div style="padding:0.75rem 1.5rem; background:rgba(255,59,48,0.15); border:1px solid rgba(255,59,48,0.3);
        border-radius:8px; display:flex; align-items:center; gap:0.5rem;">
        <i class="fas fa-fire" style="color:#ff3b30; font-size:1.2rem;"></i>
        <div style="display:flex; flex-direction:column;">
          <div style="color:#ff3b30; font-size:1rem; font-weight:700;">25 Day Streak</div>
          <div style="color:#ff8a80; font-size:0.65rem;">Keep it going!</div>
        </div>
      </div>

      <!-- Notification Bell -->
      <div id="notifications-bell" style="cursor:pointer; padding:0.75rem; background:rgba(0,224,255,0.1);
        border:1px solid rgba(0,224,255,0.3); border-radius:50%; width:48px; height:48px;
        display:flex; align-items:center; justify-content:center; position:relative;"
        title="View messages">
        <i class="fas fa-bell" style="color:#00e0ff; font-size:1.2rem;"></i>
        <span class="notification-badge hidden" id="notif-count"
          style="position:absolute; top:-5px; right:-5px; background:#ff3b30; color:white;
          font-size:0.7rem; font-weight:bold; padding:2px 6px; border-radius:10px; min-width:18px; text-align:center;">0</span>
      </div>

      <!-- User Profile -->
      <div id="user-menu" style="cursor:pointer; padding:0.5rem 1rem; background:rgba(0,224,255,0.1);
        border:1px solid rgba(0,224,255,0.3); border-radius:25px; display:flex; align-items:center; gap:0.75rem;"
        title="View your profile">
        <div style="width:36px; height:36px; border-radius:50%; background:linear-gradient(135deg,#00e0ff,#0080ff);
          display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:0.9rem;" id="user-avatar-header">
          <span id="user-initials-header">?</span>
        </div>
        <span id="user-name-header" style="color:#fff; font-weight:600;">Loading...</span>
        <i class="fas fa-user-circle" style="color:#00e0ff; font-size:1.1rem;"></i>
      </div>
    </div>

    <div id="synapse-main-view" style="position:absolute; inset:0; z-index:1; background: #000000;">
      <svg id="synapse-svg" style="width:100%; height:100%; background: #000000;"></svg>
    </div>

    <!-- Centered Round START Button -->
    <div id="start-button-container" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
      z-index:1000; display:flex; flex-direction:column; align-items:center; gap:1.5rem;">
      <button id="btn-start-center"
        style="background:linear-gradient(135deg, rgba(0,255,136,0.3), rgba(0,224,255,0.25));
        border:3px solid rgba(0,255,136,0.6); border-radius:50%; color:#00ff88; font-weight:700; font-size:1.5rem;
        cursor:pointer; transition:all 0.3s; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:0.5rem;
        box-shadow:0 8px 30px rgba(0,255,136,0.4); padding:0; width:200px; height:200px;"
        title="Start your journey">
        <i class="fas fa-play-circle" style="font-size:3rem;"></i>
        <span style="font-size:1.5rem;">START</span>
      </button>

      <!-- "I just want to explore" cancel button -->
      <button id="btn-explore-cancel"
        style="background:transparent; border:1px solid rgba(255,255,255,0.3); border-radius:8px;
        color:rgba(255,255,255,0.6); font-size:0.9rem; padding:0.75rem 1.5rem; cursor:pointer;
        transition:all 0.2s;"
        title="Skip the start sequence">
        I just want to explore
      </button>
    </div>

    <!-- Bottom Action Buttons (Floating) -->
    <div id="bottom-action-buttons"
      style="position:absolute; bottom:20px; left:50%; transform:translateX(-50%);
      display:flex; align-items:center; justify-content:center; gap:0.75rem; z-index:1000;">

      <!-- Projects -->
      <button class="action-btn" id="btn-projects"
        style="background:rgba(0,255,136,0.15); border:2px solid rgba(0,255,136,0.4); border-radius:50%;
        width:64px; height:64px; display:flex; align-items:center; justify-content:center; cursor:pointer;
        transition:all 0.3s; box-shadow:0 4px 12px rgba(0,255,136,0.2);"
        title="Toggle Projects">
        <i class="fas fa-lightbulb" style="font-size:1.5rem; color:#00ff88;"></i>
      </button>

      <!-- Themes -->
      <button class="action-btn" id="btn-themes"
        style="background:rgba(255,170,0,0.15); border:2px solid rgba(255,170,0,0.4); border-radius:50%;
        width:64px; height:64px; display:flex; align-items:center; justify-content:center; cursor:pointer;
        transition:all 0.3s; box-shadow:0 4px 12px rgba(255,170,0,0.2);"
        title="Toggle Themes">
        <i class="fas fa-bullseye" style="font-size:1.5rem; color:#ffa500;"></i>
      </button>

      <!-- Organizations -->
      <button class="action-btn" id="btn-orgs"
        style="background:rgba(168,85,247,0.15); border:2px solid rgba(168,85,247,0.4); border-radius:50%;
        width:64px; height:64px; display:flex; align-items:center; justify-content:center; cursor:pointer;
        transition:all 0.3s; box-shadow:0 4px 12px rgba(168,85,247,0.2);"
        title="Toggle Organizations">
        <i class="fas fa-building" style="font-size:1.5rem; color:#a855f7;"></i>
      </button>

      <!-- People -->
      <button class="action-btn" id="btn-people"
        style="background:rgba(255,107,107,0.15); border:2px solid rgba(255,107,107,0.4); border-radius:50%;
        width:64px; height:64px; display:flex; align-items:center; justify-content:center; cursor:pointer;
        transition:all 0.3s; box-shadow:0 4px 12px rgba(255,107,107,0.2);"
        title="Toggle People">
        <i class="fas fa-users" style="font-size:1.5rem; color:#ff6b6b;"></i>
      </button>

      <!-- Admin (Hidden by default) -->
      <button class="action-btn" id="btn-admin"
        style="background:rgba(255,170,0,0.2); border:2px solid rgba(255,170,0,0.5); border-radius:50%;
        width:64px; height:64px; display:none; align-items:center; justify-content:center; cursor:pointer;
        transition:all 0.3s; box-shadow:0 4px 12px rgba(255,170,0,0.3);"
        title="Admin Panel">
        <i class="fas fa-crown" style="font-size:1.5rem; color:#ffa500;"></i>
      </button>
    </div>

    <!-- Search Field (Bottom Center) -->
    <div id="centered-search-container"
      style="position:absolute; bottom:100px; left:50%; transform:translateX(-50%);
      width:min(600px, 80vw); z-index:1000; display:flex; align-items:center; justify-content:center;">
      <div style="position: relative; width:100%; background:rgba(10,14,39,0.6); padding:0.75rem 1rem; border-radius:12px;
        border:2px solid rgba(0,224,255,0.3); backdrop-filter:blur(10px); box-shadow:0 4px 20px rgba(0,224,255,0.3);">
        <i class="fas fa-search"
           style="position:absolute; left:1.5rem; top:50%; transform:translateY(-50%); color:#00e0ff; pointer-events:none; z-index:1;"></i>
        <input type="text" id="global-search" placeholder="Search people, skills, projects, organizations..."
          style="width:100%; padding:0.75rem 5rem 0.75rem 3rem; background:rgba(0,0,0,0.4);
          border:1px solid rgba(0,224,255,0.3); border-radius:8px; color:#fff; font-size:0.95rem; outline:none;">
        <button id="search-button"
          style="position:absolute; right:1.25rem; top:50%; transform:translateY(-50%);
          background:linear-gradient(135deg,#00e0ff,#0080ff); border:none; padding:0.6rem 1rem; border-radius:8px;
          color:white; cursor:pointer; font-weight:600; font-size:0.9rem; transition:all 0.2s; z-index:1;">
          <i class="fas fa-search"></i>
        </button>
      </div>
    </div>
  </div>

  <!--Hidden elements for compatibility -->
  <div id="main-header" class="hidden"></div>
  <button id="logout-btn" style="display:none;"></button>
  <button id="btn-start-header" style="display:none;"></button>
  <button id="btn-start-fullwidth" style="display:none;"></button>
  <button id="btn-messages" style="display:none;"></button>
  <button id="btn-projects-modal" style="display:none;"></button>
  <button id="btn-endorsements" style="display:none;"></button>
  <button id="fab-bbs-trigger" style="display:none;"></button>

  <!-- Profile Modal -->
  <div class="modal" id="profile-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeProfileModal()"><i class="fas fa-times"></i></button>
      <div id="modal-profile-content"></div>
    </div>
  </div>

  <!-- Messages Modal -->
  <div class="modal" id="messages-modal">
    <div class="modal-content" style="max-width: 1000px; max-height: 80vh;">
      <button class="modal-close" onclick="closeMessagesModal()"><i class="fas fa-times"></i></button>

      <!-- Container for messaging.js to render into -->
      <div id="messages-container"></div>
    </div>
  </div>

  <!-- Projects Modal -->
  <div class="modal" id="projects-modal">
    <div class="modal-content" style="max-width: 800px;">
      <button class="modal-close" onclick="closeProjectsModal()"><i class="fas fa-times"></i></button>
      <h2 style="color:#00e0ff; margin-bottom:1.5rem;"><i class="fas fa-lightbulb"></i> Projects</h2>

      <div style="margin-bottom:1.5rem;">
        <button onclick="showCreateProjectForm()" class="btn btn-primary"><i class="fas fa-plus"></i> New Project</button>
      </div>

      <div id="project-form" style="display:none; background: rgba(0,224,255,0.05); border:1px solid rgba(0,224,255,0.2);
          border-radius:12px; padding:1.5rem; margin-bottom:1.5rem;">
        <h3 style="color:#00e0ff; margin-bottom:1rem;">Create New Project</h3>
        <form onsubmit="createProject(event)">
          <div style="margin-bottom:1rem;">
            <label style="display:block; color:#aaa; margin-bottom:0.5rem;">Project Name *</label>
            <input type="text" id="project-name" required
                   style="width:100%; padding:0.75rem; background: rgba(0,224,255,0.05);
                   border:1px solid rgba(0,224,255,0.2); border-radius:8px; color:white; font-family:inherit;">
          </div>

          <div style="margin-bottom:1rem;">
            <label style="display:block; color:#aaa; margin-bottom:0.5rem;">Description *</label>
            <textarea id="project-description" rows="3" required
              style="width:100%; padding:0.75rem; background: rgba(0,224,255,0.05);
              border:1px solid rgba(0,224,255,0.2); border-radius:8px; color:white; font-family:inherit; resize:vertical;"></textarea>
          </div>

          <div style="margin-bottom:1rem;">
            <label style="display:block; color:#aaa; margin-bottom:0.5rem;">Required Skills (comma-separated)</label>
            <input type="text" id="project-skills" placeholder="e.g., JavaScript, React, Design"
                   style="width:100%; padding:0.75rem; background: rgba(0,224,255,0.05);
                   border:1px solid rgba(0,224,255,0.2); border-radius:8px; color:white; font-family:inherit;">
          </div>

          <div style="margin-bottom:1rem;">
            <label style="display:block; color:#aaa; margin-bottom:0.5rem;">
              <i class="fas fa-bullseye" style="color:#00e0ff;"></i> Associate with Theme Circle (optional)
            </label>
            <select id="project-theme"
                    style="width:100%; padding:0.75rem; background: rgba(0,224,255,0.05);
                    border:1px solid rgba(0,224,255,0.2); border-radius:8px; color:white; font-family:inherit;">
              <option value="">No theme (standalone project)</option>
            </select>
            <small style="color:#888; display:block; margin-top:0.3rem;">
              Link this project to an active theme to help others find it
            </small>
          </div>

          <div style="display:flex; gap:0.5rem;">
            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Create Project</button>
            <button type="button" onclick="hideCreateProjectForm()" class="btn" style="background:rgba(255,255,255,0.1);">Cancel</button>
          </div>
        </form>
      </div>

      <div id="projects-list" style="max-height: 400px; overflow-y:auto;"></div>
    </div>
  </div>

  <!-- Endorsements Modal -->
  <div class="modal" id="endorsements-modal">
    <div class="modal-content" style="max-width: 700px;">
      <button class="modal-close" onclick="closeEndorsementsModal()"><i class="fas fa-times"></i></button>
      <h2 style="color:#00e0ff; margin-bottom:1.5rem;"><i class="fas fa-star"></i> Endorsements</h2>

      <div style="margin-bottom:2rem;">
        <div style="display:flex; gap:0.5rem; margin-bottom:1rem;">
          <button onclick="showEndorsementsTab('received')" id="endorsements-tab-received"
                  style="flex:1; padding:0.75rem; background:linear-gradient(135deg,#00e0ff,#0080ff);
                  border:none; border-radius:8px; color:white; cursor:pointer; font-weight:bold;">Received</button>
          <button onclick="showEndorsementsTab('given')" id="endorsements-tab-given"
                  style="flex:1; padding:0.75rem; background:rgba(255,255,255,0.1); border:1px solid rgba(0,224,255,0.2);
                  border-radius:8px; color:white; cursor:pointer;">Given</button>
        </div>

        <div id="endorsements-received" style="max-height:400px; overflow-y:auto;"></div>
        <div id="endorsements-given" style="display:none; max-height:400px; overflow-y:auto;"></div>
      </div>
    </div>
  </div>

  <!-- Network Stats Modal -->
  <div class="modal" id="network-stats-modal">
    <div class="modal-content" style="max-width: 800px;">
      <button class="modal-close" onclick="closeNetworkStatsModal()">
        <i class="fas fa-times"></i>
      </button>
      <h2 style="color: #00e0ff; margin-bottom: 1.5rem;">
        <i class="fas fa-users"></i> Your Network Stats
      </h2>

      <div id="network-stats-content" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
        <div style="text-align: center; color: #aaa; padding: 3rem;">
          <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: #00e0ff;"></i>
          <p style="margin-top: 1rem;">Loading network stats...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Connect Modal -->
  <div class="modal" id="quick-connect-modal">
    <div class="modal-content" style="max-width: 800px;">
      <button class="modal-close" onclick="closeQuickConnectModal()"><i class="fas fa-times"></i></button>
      <h2 style="color:#00e0ff; margin-bottom:1.5rem;"><i class="fas fa-user-plus"></i> Quick Connect</h2>
      <p style="color:#aaa; margin-bottom:1.5rem;">Connect with people who share your interests and skills</p>
      <div id="quick-connect-list" style="max-height: 500px; overflow-y:auto;"></div>
    </div>
  </div>

  <!-- Notification Center Modal -->
  <div class="modal" id="notification-center-modal">
    <div class="modal-content" style="max-width: 700px;">
      <button class="modal-close" onclick="closeNotificationCenter()"><i class="fas fa-times"></i></button>
      <h2 style="color:#00e0ff; margin-bottom:1.5rem;"><i class="fas fa-bell"></i> Notifications</h2>

      <div style="margin-bottom:1.5rem;">
        <div style="display:flex; gap:0.5rem; margin-bottom:1rem;">
          <button onclick="showNotificationsTab('all')" id="notifications-tab-all"
                  style="flex:1; padding:0.75rem; background:linear-gradient(135deg,#00e0ff,#0080ff);
                  border:none; border-radius:8px; color:white; cursor:pointer; font-weight:bold;">All</button>
          <button onclick="showNotificationsTab('unread')" id="notifications-tab-unread"
                  style="flex:1; padding:0.75rem; background:rgba(255,255,255,0.1); border:1px solid rgba(0,224,255,0.2);
                  border-radius:8px; color:white; cursor:pointer;">Unread</button>
        </div>

        <div id="notifications-all" style="max-height:400px; overflow-y:auto;"></div>
        <div id="notifications-unread" style="display:none; max-height:400px; overflow-y:auto;"></div>
      </div>

      <div style="text-align:center; padding-top:1rem; border-top:1px solid rgba(255,255,255,0.1);">
        <button onclick="clearAllNotifications()" style="padding:0.5rem 1.5rem; background:rgba(255,255,255,0.1);
          border:1px solid rgba(0,224,255,0.2); border-radius:8px; color:#00e0ff; cursor:pointer;">
          <i class="fas fa-check-double"></i> Mark All as Read
        </button>
      </div>
    </div>
  </div>

  <!-- BBS Modal -->
  <div id="bbs-modal"></div>

  <!-- Mentor Panels - Daily Briefing Contextual Overlays -->

  <!-- Panel 1: Your Focus Today -->
  <div id="mentor-panel-focus" class="mentor-panel" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
    width:min(650px, 92vw); max-height:85vh; background:linear-gradient(135deg, rgba(10,14,39,0.98), rgba(16,20,39,0.98));
    border:2px solid rgba(0,224,255,0.35); border-radius:16px; padding:2rem; z-index:10001; overflow-y:auto;
    box-shadow:0 20px 60px rgba(0,0,0,0.6), 0 0 40px rgba(0,224,255,0.15); backdrop-filter:blur(20px);">

    <button class="mentor-panel-close" onclick="closeMentorPanel('focus')"
      style="position:absolute; top:1rem; right:1rem; width:36px; height:36px; background:rgba(255,255,255,0.1);
      border:1px solid rgba(255,255,255,0.2); border-radius:50%; color:rgba(255,255,255,0.7); cursor:pointer;
      display:flex; align-items:center; justify-content:center; transition:all 0.2s;">
      <i class="fas fa-times"></i>
    </button>

    <h2 style="color:#00e0ff; margin-bottom:0.5rem; font-size:1.5rem; font-weight:600;">
      <i class="fas fa-compass" style="margin-right:0.5rem;"></i>
      Your focus today
    </h2>
    <p style="color:rgba(255,255,255,0.5); margin-bottom:2rem; font-size:0.9rem;">
      Where your interests and activity currently overlap
    </p>

    <div id="mentor-focus-content"></div>
  </div>

  <!-- Panel 2: Projects Gaining Momentum -->
  <div id="mentor-panel-projects" class="mentor-panel" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
    width:min(650px, 92vw); max-height:85vh; background:linear-gradient(135deg, rgba(10,14,39,0.98), rgba(16,20,39,0.98));
    border:2px solid rgba(0,224,255,0.35); border-radius:16px; padding:2rem; z-index:10001; overflow-y:auto;
    box-shadow:0 20px 60px rgba(0,0,0,0.6), 0 0 40px rgba(0,224,255,0.15); backdrop-filter:blur(20px);">

    <button class="mentor-panel-close" onclick="closeMentorPanel('projects')"
      style="position:absolute; top:1rem; right:1rem; width:36px; height:36px; background:rgba(255,255,255,0.1);
      border:1px solid rgba(255,255,255,0.2); border-radius:50%; color:rgba(255,255,255,0.7); cursor:pointer;
      display:flex; align-items:center; justify-content:center; transition:all 0.2s;">
      <i class="fas fa-times"></i>
    </button>

    <h2 style="color:#00e0ff; margin-bottom:0.5rem; font-size:1.5rem; font-weight:600;">
      <i class="fas fa-rocket" style="margin-right:0.5rem;"></i>
      Projects gaining momentum
    </h2>
    <p style="color:rgba(255,255,255,0.5); margin-bottom:2rem; font-size:0.9rem;">
      Places where people are already building
    </p>

    <div id="mentor-projects-content"></div>
  </div>

  <!-- Panel 3: People Worth Knowing -->
  <div id="mentor-panel-people" class="mentor-panel" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
    width:min(650px, 92vw); max-height:85vh; background:linear-gradient(135deg, rgba(10,14,39,0.98), rgba(16,20,39,0.98));
    border:2px solid rgba(0,224,255,0.35); border-radius:16px; padding:2rem; z-index:10001; overflow-y:auto;
    box-shadow:0 20px 60px rgba(0,0,0,0.6), 0 0 40px rgba(0,224,255,0.15); backdrop-filter:blur(20px);">

    <button class="mentor-panel-close" onclick="closeMentorPanel('people')"
      style="position:absolute; top:1rem; right:1rem; width:36px; height:36px; background:rgba(255,255,255,0.1);
      border:1px solid rgba(255,255,255,0.2); border-radius:50%; color:rgba(255,255,255,0.7); cursor:pointer;
      display:flex; align-items:center; justify-content:center; transition:all 0.2s;">
      <i class="fas fa-times"></i>
    </button>

    <h2 style="color:#00e0ff; margin-bottom:0.5rem; font-size:1.5rem; font-weight:600;">
      <i class="fas fa-users" style="margin-right:0.5rem;"></i>
      People worth knowing
    </h2>
    <p style="color:rgba(255,255,255,0.5); margin-bottom:2rem; font-size:0.9rem;">
      Connected through your projects and themes
    </p>

    <div id="mentor-people-content"></div>
  </div>

  <!-- Mentor Panel Backdrop -->
  <div id="mentor-panel-backdrop" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.75);
    backdrop-filter:blur(4px); z-index:10000;" onclick="closeAllMentorPanels()"></div>

  <!-- START Modal (floating over synapse view with no background) -->
  <div id="start-modal" class="mentor-panel" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
    width:auto; max-width:90vw; max-height:90vh; background:transparent;
    border:none; padding:2rem; z-index:10002; overflow-y:auto;
    box-shadow:none; backdrop-filter:none; pointer-events:auto;">

    <button class="mentor-panel-close" onclick="closeStartModal()"
      style="position:absolute; top:-1rem; right:-1rem; background:rgba(0,0,0,0.8); border:2px solid rgba(0,255,136,0.5);
      border-radius:50%; width:40px; height:40px; display:flex; align-items:center; justify-content:center; cursor:pointer; color:#00ff88;
      font-size:1.25rem; transition:all 0.2s; box-shadow:0 0 15px rgba(0,255,136,0.3);">
      <i class="fas fa-times"></i>
    </button>

    <div style="text-align:center; margin-bottom:2rem; background:rgba(0,0,0,0.85); padding:2rem; border-radius:15px;
      border:2px solid rgba(0,255,136,0.3); box-shadow:0 0 30px rgba(0,255,136,0.2);">
      <div style="font-size:3rem; color:#00ff88; margin-bottom:0.5rem;">
        <i class="fas fa-play-circle"></i>
      </div>
      <h2 style="color:#00ff88; font-size:2rem; margin:0 0 0.5rem 0; font-weight:700;">Your focus today</h2>
      <p style="color:rgba(255,255,255,0.6); font-size:1rem; margin:0;">Based on your activity and interests, here's the best place to start today</p>
    </div>

    <!-- Enhanced START Flow - Dynamic Recommendations Container -->
    <div id="start-options-container" style="display:flex; flex-direction:column; gap:1.5rem; margin-bottom:2rem;">
      <!-- Populated dynamically by start-flow-integration.js -->
    </div>

    <!-- Escape Hatch -->
    <div style="text-align:center; margin-bottom:1.5rem;">
      <button id="explore-freely-btn" onclick="clearSessionFocus(); closeStartModal();" style="
        background: rgba(0,224,255,0.15);
        border: 2px solid rgba(0,224,255,0.5);
        border-radius: 10px;
        color: #00e0ff;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        padding: 1rem 2rem;
        transition: all 0.3s;
        box-shadow: 0 0 20px rgba(0,224,255,0.2);
      ">
        <i class="fas fa-compass" style="margin-right:0.5rem;"></i>I just want to explore freely
      </button>
    </div>

    <!-- Dynamic content area (shown when user clicks a button) -->
    <div id="start-dynamic-content" style="display:none;"></div>

    <!-- Button sections (hidden when content is shown) - LEGACY FALLBACK -->
    <div id="start-button-section" style="display:none;">

    <!-- Mentor Panel Buttons -->
    <div style="margin-bottom:2.5rem;">
      <h3 style="color:rgba(0,224,255,0.9); font-size:0.95rem; margin-bottom:1rem; text-transform:uppercase; letter-spacing:1px; font-weight:600;">
        <i class="fas fa-compass" style="margin-right:0.5rem;"></i>Explore Your Network
      </h3>
      <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:1rem;">
        <button id="start-btn-focus" class="start-nav-btn"
          style="background:linear-gradient(135deg, rgba(0,224,255,0.15), rgba(0,128,255,0.1)); border:2px solid rgba(0,224,255,0.4);
          border-radius:12px; padding:1.5rem; cursor:pointer; transition:all 0.2s; text-align:left;">
          <div style="font-size:2rem; color:#00e0ff; margin-bottom:0.75rem;">
            <i class="fas fa-compass"></i>
          </div>
          <div style="color:#fff; font-size:1.1rem; font-weight:600; margin-bottom:0.5rem;">Start with this focus</div>
          <div style="color:rgba(255,255,255,0.6); font-size:0.85rem;">Where your interests and activity overlap</div>
        </button>

        <button id="start-btn-projects" class="start-nav-btn"
          style="background:linear-gradient(135deg, rgba(255,107,107,0.15), rgba(255,128,128,0.1)); border:2px solid rgba(255,107,107,0.4);
          border-radius:12px; padding:1.5rem; cursor:pointer; transition:all 0.2s; text-align:left;">
          <div style="font-size:2rem; color:#ff6b6b; margin-bottom:0.75rem;">
            <i class="fas fa-rocket"></i>
          </div>
          <div style="color:#fff; font-size:1.1rem; font-weight:600; margin-bottom:0.5rem;">See active projects</div>
          <div style="color:rgba(255,255,255,0.6); font-size:0.85rem;">Projects gaining momentum</div>
        </button>

        <button id="start-btn-people" class="start-nav-btn"
          style="background:linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,235,100,0.1)); border:2px solid rgba(255,215,0,0.4);
          border-radius:12px; padding:1.5rem; cursor:pointer; transition:all 0.2s; text-align:left;">
          <div style="font-size:2rem; color:#ffd700; margin-bottom:0.75rem;">
            <i class="fas fa-users"></i>
          </div>
          <div style="color:#fff; font-size:1.1rem; font-weight:600; margin-bottom:0.5rem;">Meet people nearby</div>
          <div style="color:rgba(255,255,255,0.6); font-size:0.85rem;">People worth knowing</div>
        </button>
      </div>
    </div>

    <!-- Bottom Bar Action Buttons -->
    <div style="margin-bottom:1.5rem;">
      <h3 style="color:rgba(0,224,255,0.9); font-size:0.95rem; margin-bottom:1rem; text-transform:uppercase; letter-spacing:1px; font-weight:600;">
        <i class="fas fa-bolt" style="margin-right:0.5rem;"></i>Quick Actions
      </h3>
      <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:0.75rem;">
        <button id="start-action-connect" class="start-action-btn"
          style="background:rgba(0,224,255,0.1); border:1px solid rgba(0,224,255,0.3); border-radius:8px;
          padding:1rem; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:0.75rem;">
          <div style="font-size:1.5rem; color:#00e0ff;"><i class="fas fa-user-plus"></i></div>
          <div style="text-align:left;">
            <div style="color:#fff; font-size:0.9rem; font-weight:600;">Connect</div>
            <div style="color:rgba(255,255,255,0.5); font-size:0.75rem;">Find people to connect with</div>
          </div>
        </button>

        <button id="start-action-messages" class="start-action-btn"
          style="background:rgba(0,224,255,0.1); border:1px solid rgba(0,224,255,0.3); border-radius:8px;
          padding:1rem; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:0.75rem;">
          <div style="font-size:1.5rem; color:#00e0ff;"><i class="fas fa-envelope"></i></div>
          <div style="text-align:left;">
            <div style="color:#fff; font-size:0.9rem; font-weight:600;">Messages</div>
            <div style="color:rgba(255,255,255,0.5); font-size:0.75rem;">Check your conversations</div>
          </div>
        </button>

        <button id="start-action-projects" class="start-action-btn"
          style="background:rgba(0,224,255,0.1); border:1px solid rgba(0,224,255,0.3); border-radius:8px;
          padding:1rem; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:0.75rem;">
          <div style="font-size:1.5rem; color:#00e0ff;"><i class="fas fa-lightbulb"></i></div>
          <div style="text-align:left;">
            <div style="color:#fff; font-size:0.9rem; font-weight:600;">Projects</div>
            <div style="color:rgba(255,255,255,0.5); font-size:0.75rem;">Browse and join projects</div>
          </div>
        </button>

        <button id="start-action-endorsements" class="start-action-btn"
          style="background:rgba(0,224,255,0.1); border:1px solid rgba(0,224,255,0.3); border-radius:8px;
          padding:1rem; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:0.75rem;">
          <div style="font-size:1.5rem; color:#00e0ff;"><i class="fas fa-star"></i></div>
          <div style="text-align:left;">
            <div style="color:#fff; font-size:0.9rem; font-weight:600;">Endorse</div>
            <div style="color:rgba(255,255,255,0.5); font-size:0.75rem;">Give and receive endorsements</div>
          </div>
        </button>

        <button id="start-action-chat" class="start-action-btn"
          style="background:rgba(0,224,255,0.1); border:1px solid rgba(0,224,255,0.3); border-radius:8px;
          padding:1rem; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:0.75rem;">
          <div style="font-size:1.5rem; color:#00e0ff;"><i class="fas fa-comments"></i></div>
          <div style="text-align:left;">
            <div style="color:#fff; font-size:0.9rem; font-weight:600;">Chat</div>
            <div style="color:rgba(255,255,255,0.5); font-size:0.75rem;">Community discussions</div>
          </div>
        </button>
      </div>
    </div>

    <!-- Close button sections wrapper -->
    </div>

    <!-- Done button - LEGACY FALLBACK (hidden by default, shown if enhanced flow fails) -->
    <div id="start-done-button" style="display:none; text-align:center; padding-top:1.5rem; border-top:1px solid rgba(255,255,255,0.1);">
      <button onclick="closeStartModal()" style="padding:1rem 2.5rem; background:linear-gradient(135deg, #00ff88, #00e0ff);
        border:none; border-radius:10px; color:#000; font-weight:700; cursor:pointer; font-size:1rem; transition:all 0.2s;
        box-shadow:0 4px 15px rgba(0,255,136,0.3);">
        <i class="fas fa-check" style="margin-right:0.5rem;"></i>Done - Explore Network
      </button>
    </div>
  </div>

  <!-- START Modal Backdrop (no blur, transparent to allow synapse interaction) -->
  <div id="start-modal-backdrop" style="display:none; position:fixed; inset:0; background:transparent;
    backdrop-filter:none; z-index:10001; pointer-events:none;"></div>

   <!-- External libs (ONLY ONCE) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>

  <!-- Required base modules -->
  <!-- Cache-busting using git commit hash - changes on every deploy -->
  <script type="module" src="assets/js/supabaseClient.js?v=e829b2ff916933b2da"></script>

  <!-- Non-module scripts with commit-based cache-busting -->
  <script src="assets/js/ecosystem-connector.js?v=e829b2ff916933b2da"></script>
  <script src="assets/js/cynq.js?v=e829b2ff916933b2da"></script>
  <script src="assets/js/neuralBackground.js?v=e829b2ff916933b2da"></script>

  <!-- Feature modules with commit-based cache-busting -->
  <script type="module" src="assets/js/onboarding.js?v=e829b2ff916933b2da"></script>
  <script type="module" src="assets/js/node-panel.js?v=e829b2ff916933b2da"></script>
  <script type="module" src="assets/js/network-filters.js?v=e829b2ff916933b2da"></script>
  <script type="module" src="assets/js/graph-legend.js?v=e829b2ff916933b2da"></script>
  <script type="module" src="assets/js/admin-analytics.js?v=e829b2ff916933b2da"></script>
  <script type="module" src="assets/js/theme-admin.js?v=e829b2ff916933b2da"></script>
  <script type="module" src="assets/js/theme-discovery.js?v=e829b2ff916933b2da"></script>
  <script type="module" src="assets/js/daily-engagement.js?v=e829b2ff916933b2da"></script>
  <script type="module" src="assets/js/connectionRequests.js?v=e829b2ff916933b2da"></script>

  <!-- Messaging with commit-based cache-busting -->
  <script src="assets/js/messaging.js?v=e829b2ff916933b2da"></script>

  <!-- Auth + profile with commit-based cache-busting for auth fix -->
  <script type="module" src="auth.js?v=e829b2ff916933b2da"></script>
  <script type="module" src="profile.js?v=e829b2ff916933b2da"></script>

  <!-- Synapse initialization helper with commit-based cache-busting -->
  <script src="assets/js/synapse-init-helper.js?v=e829b2ff916933b2da"></script>

  <!-- Synapse boot with commit-based cache-busting -->
  <script type="module" src="assets/js/synapse.js?v=e829b2ff916933b2da"></script>

  <!-- Main app boot with commit-based cache-busting -->
  <script type="module" src="main.js?v=e829b2ff916933b2da"></script>

  <!-- Dashboard controller with commit-based cache-busting -->
  <script type="module" src="assets/js/dashboardPane.js?v=e829b2ff916933b2da"></script>

  <!-- Non-module controllers with commit-based cache-busting -->
  <script src="assets/js/dashboard-actions.js?v=e829b2ff916933b2da"></script>
  <script src="assets/js/start-flow.js?v=e829b2ff916933b2da"></script>
  <script src="assets/js/start-flow-enhanced.js?v=e829b2ff916933b2da"></script>
  <script src="assets/js/start-flow-phase2.js?v=e829b2ff916933b2da"></script>
  <script src="assets/js/start-flow-sequential.js?v=e829b2ff916933b2da"></script>
  <script src="assets/js/start-flow-integration.js?v=e829b2ff916933b2da"></script>

  <!-- Mentor Guide System with commit-based cache-busting -->
  <script src="assets/js/mentor-guide.js?v=e829b2ff916933b2da"></script>

  <!-- Logout Button Handler -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const logoutBtn = document.getElementById('logout-btn');
      if (!logoutBtn) return;

      logoutBtn.addEventListener('click', async () => {
        if (!window.handleLogout) {
          console.error('âŒ Logout function not available');
          return;
        }

        console.log('ðŸšª Logging out...');
        await window.handleLogout();

        console.log('ðŸ§¹ Clearing cached state...');
        localStorage.removeItem('start_flow_state');
        localStorage.removeItem('chs_splash_seen_v2');

        setTimeout(() => {
          window.location.href = '/index.html';
        }, 500);
      });
    });
  </script>

  <!-- Session Restoration Handler - Fixes tab switching issues -->
  <script>
    (function() {
      let lastActiveTime = Date.now();
      let restoreInFlight = false;

      document.addEventListener('visibilitychange', async () => {
        if (document.hidden) return;

        const timeSinceActive = Date.now() - lastActiveTime;
        console.log(`ðŸ‘ï¸ Tab visible again (was away for ${Math.floor(timeSinceActive / 1000)}s)`);

        // Do not collide with auth boot
        if (!window.__authReady) {
          lastActiveTime = Date.now();
          return;
        }

        // Single-flight: never overlap getSession calls
        if (restoreInFlight) {
          lastActiveTime = Date.now();
          return;
        }

        if (timeSinceActive > 30000 && window.supabase) {
          restoreInFlight = true;
          console.log('ðŸ”„ Checking session after being away...');

          try {
            const { data: { session }, error } = await window.supabase.auth.getSession();

            if (error) {
              console.error('âŒ Session check error:', error);
              return;
            }

            if (session?.user) {
              console.log('âœ… Session valid for:', session.user.email);

              const loginSection = document.getElementById('login-section');
              const mainContent = document.getElementById('main-content');

              if (loginSection && !loginSection.classList.contains('hidden')) {
                console.log('ðŸ”§ Fixing UI - showing app instead of login');
                loginSection.classList.add('hidden');
                loginSection.classList.remove('active-tab-pane');

                if (mainContent) mainContent.classList.remove('hidden');

                const mainHeader = document.getElementById('main-header');
                if (mainHeader) mainHeader.classList.remove('hidden');

                document.body.style.overflow = 'auto';

                if (!window.currentUserProfile) {
                  console.log('ðŸ“‹ Reloading user profile...');
                  try {
                    const { data: profile } = await window.supabase
                      .from('community')
                      .select('*')
                      .eq('user_id', session.user.id)
                      .limit(1);

                    if (profile && profile.length > 0) {
                      window.currentUserProfile = profile[0];
                      window.dispatchEvent(
                        new CustomEvent('profile-loaded', {
                          detail: { user: session.user, profile: profile[0] }
                        })
                      );
                      console.log('âœ… Profile reloaded:', profile[0].name);
                    }
                  } catch (e) {
                    console.error('âŒ Error reloading profile:', e);
                  }
                }
              }
            } else {
              console.log('âš ï¸ No active session found');

              const loginSection = document.getElementById('login-section');
              if (loginSection && loginSection.classList.contains('hidden')) {
                console.log('ðŸ”’ Showing login screen');
                loginSection.classList.remove('hidden');
                loginSection.classList.add('active-tab-pane');

                const mainContent = document.getElementById('main-content');
                if (mainContent) mainContent.classList.add('hidden');

                const mainHeader = document.getElementById('main-header');
                if (mainHeader) mainHeader.classList.add('hidden');

                document.body.style.overflow = 'hidden';
              }
            }
          } catch (e) {
            console.error('âŒ Error checking session:', e);
          } finally {
            restoreInFlight = false;
          }
        }

        lastActiveTime = Date.now();
      });

      setInterval(() => {
        if (!document.hidden) lastActiveTime = Date.now();
      }, 5000);

      console.log('âœ… Session restoration handler initialized');
    })();
  </script>

  <!-- START Button Logic -->
  <script>
    (function() {
      const startContainer = document.getElementById('start-button-container');
      const startBtn = document.getElementById('btn-start-center');
      const exploreBtn = document.getElementById('btn-explore-cancel');

      // Check if START should be shown (first login or new session)
      function shouldShowStart() {
        const lastStartUsed = localStorage.getItem('chs_start_last_used');
        const currentSession = sessionStorage.getItem('chs_session_started');

        // Show START if:
        // 1. Never used before, OR
        // 2. New session (app reopened)
        if (!lastStartUsed || !currentSession) {
          return true;
        }
        return false;
      }

      // Hide START button and show user node
      function hideStartButton() {
        if (startContainer) {
          startContainer.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
          startContainer.style.opacity = '0';
          startContainer.style.transform = 'translate(-50%, -50%) scale(0.5)';

          setTimeout(() => {
            startContainer.style.display = 'none';
          }, 500);
        }

        // Mark session as started
        sessionStorage.setItem('chs_session_started', 'true');
        localStorage.setItem('chs_start_last_used', Date.now());
      }

      // START button click handler
      if (startBtn) {
        startBtn.addEventListener('click', () => {
          console.log('ðŸš€ START button clicked');

          // Hide START button
          hideStartButton();

          // Open START modal/sequence
          if (typeof window.openStartModal === 'function') {
            setTimeout(() => {
              window.openStartModal();
            }, 500);
          } else {
            console.warn('START modal function not available');
          }
        });
      }

      // "I just want to explore" button click handler
      if (exploreBtn) {
        exploreBtn.addEventListener('click', () => {
          console.log('ðŸ” User wants to explore freely');

          // Hide START button
          hideStartButton();

          // Don't open any modals, just let user see their node
          console.log('âœ… Showing user node only');
        });
      }

      // Check if START should be shown on page load
      window.addEventListener('profile-loaded', () => {
        if (!shouldShowStart() && startContainer) {
          startContainer.style.display = 'none';
        }
      });

      // Show START if needed
      if (shouldShowStart() && startContainer) {
        startContainer.style.display = 'flex';
      } else if (startContainer) {
        startContainer.style.display = 'none';
      }

      console.log('âœ… START button logic initialized');
    })();
  </script>

  <!-- Profile Editor Extension -->
  </body>
</html>
