<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CharlestonHacks Innovation Engine</title>
  <link rel="icon" href="favicon.ico"/>

  <!-- Core CSS -->
  <link rel="stylesheet" href="assets/css/base.css" />
  <link rel="stylesheet" href="assets/css/engine.css" />
  <link rel="stylesheet" href="assets/css/overlays.css" />
  <link rel="stylesheet" href="assets/css/connections.css" />
  <link rel="stylesheet" href="assets/css/cynq.css" />
  <link rel="stylesheet" href="dashboard.css" />

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    body { overflow: hidden; }

    .stat-card-mini:hover {
      transform: translateY(-3px);
      background: rgba(0,224,255,0.15) !important;
      border-color: rgba(0,224,255,0.5) !important;
      box-shadow: 0 4px 12px rgba(0,224,255,0.3);
    }

    @media (max-width: 768px) {
      .bottom-stats-bar { gap: 0.25rem; padding: 0.5rem; }
      .stat-card-mini { padding: 0.5rem !important; }
      .stat-card-mini .label { font-size: 0.65rem !important; }
      .stat-card-mini .value { font-size: 1.25rem !important; }
    }

    .bottom-stats-bar::-webkit-scrollbar { height: 6px; }
    .bottom-stats-bar::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); }
    .bottom-stats-bar::-webkit-scrollbar-thumb { background: rgba(0,224,255,0.3); border-radius: 3px; }
    .bottom-stats-bar::-webkit-scrollbar-thumb:hover { background: rgba(0,224,255,0.5); }

    .bottom-stats-bar > div { flex: 0 0 auto; min-width: 150px; }
  </style>
</head>

<body>
  <!-- Neural Background -->
  <canvas id="neural-bg"
    style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
    background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);"></canvas>

  <!-- Login -->
  <div id="login-section"
    style="position: fixed; inset: 0; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center;
    z-index: 9999; overflow: hidden; background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);">
    <div class="login-container">
      <img src="ieheader.webp"
           alt="CharlestonHacks Innovation Engine"
           style="max-width: 100%; height: auto; margin-bottom: 1rem;"
           onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
      <h1 style="display:none; color:#00e0ff; font-size:2rem; margin-bottom:1rem;">CharlestonHacks Innovation Engine</h1>

      <h2 style="color:#00e0ff; font-size:1.5rem; font-weight:bold; margin-bottom:0.75rem;">
        Making Invisible Networks Visible
      </h2>

      <p style="color:#ddd; font-size:1.1rem; line-height:1.6; margin-bottom:2rem; max-width:520px;">
        Discover people, skills, and collaboration opportunities in your innovation ecosystem.
        Connect with the right people, join projects, and build something amazing together.
      </p>

      <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:1.5rem; margin-bottom:2rem; max-width:620px;">
        <div style="text-align:center;">
          <i class="fas fa-network-wired" style="font-size:2rem; color:#00e0ff; margin-bottom:0.5rem;"></i>
          <div style="color:#ddd; font-size:0.9rem;">Visualize Your Network</div>
        </div>
        <div style="text-align:center;">
          <i class="fas fa-search" style="font-size:2rem; color:#00e0ff; margin-bottom:0.5rem;"></i>
          <div style="color:#ddd; font-size:0.9rem;">Find Skills & People</div>
        </div>
        <div style="text-align:center;">
          <i class="fas fa-users" style="font-size:2rem; color:#00e0ff; margin-bottom:0.5rem;"></i>
          <div style="color:#ddd; font-size:0.9rem;">Build Together</div>
        </div>
      </div>

      <div class="oauth-buttons">
        <button id="github-login" class="oauth-btn">
          <span class="oauth-icon-circle">
            <i class="fab fa-github"></i>
          </span>
          Continue with GitHub
        </button>
        <button id="google-login" class="oauth-btn">
          <span class="oauth-icon-circle">
            <i class="fab fa-google"></i>
          </span>
          Continue with Google
        </button>
      </div>

      <div id="login-hint" style="margin-top: 1rem; color: #aaa; font-size: 0.9rem;"></div>
    </div>
  </div>

  <!-- Header -->
  <header class="unified-header hidden" id="main-header"
    style="position: fixed; top:0; left:0; right:0; z-index:1000; background:rgba(10,14,39,0.95);
    backdrop-filter: blur(10px); border-bottom:2px solid rgba(0,224,255,0.3);">
    <div class="header-content">
      <div class="header-logo">
        <a href="https://charlestonhacks.com/" style="display:flex; align-items:center; text-decoration:none;">
          <img src="charlestonhackslogo.svg" alt="CharlestonHacks"
               style="height:40px; width:auto; cursor:pointer;"
               onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
          <span style="display:none; color:#00e0ff; font-size:1.5rem; font-weight:bold;">CharlestonHacks</span>
        </a>
      </div>

      <div class="header-search" style="position: relative;">
        <i class="fas fa-search"
           style="position:absolute; left:1rem; top:50%; transform:translateY(-50%); color:#00e0ff; pointer-events:none;"></i>
        <input type="text" id="global-search" placeholder="Search people, skills, projects..." style="padding-left:2.5rem; padding-right:4rem;">
        <button id="search-button"
          style="position:absolute; right:0.25rem; top:50%; transform:translateY(-50%);
          background:linear-gradient(135deg,#00e0ff,#0080ff); border:none; padding:0.4rem 0.75rem; border-radius:6px;
          color:white; cursor:pointer; font-weight:600; font-size:0.85rem;">
          <i class="fas fa-search"></i>
        </button>
      </div>

      <div class="header-actions">
        <div class="header-notification" id="notifications-bell" style="cursor:pointer;" title="View pending requests">
          <i class="fas fa-bell"></i>
          <span class="notification-badge hidden" id="notif-count">0</span>
        </div>

        <div class="user-menu" id="user-menu" style="cursor:pointer;" title="View your profile">
          <div class="user-avatar" id="user-avatar-header">
            <span id="user-initials-header">?</span>
          </div>
          <span id="user-name-header">Loading...</span>
          <i class="fas fa-user-circle"></i>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <div class="unified-main hidden" id="main-content" style="position: fixed; inset: 0; overflow: hidden;">
    <div id="synapse-main-view" style="position:absolute; inset:0; z-index:1;">
      <svg id="synapse-svg" style="width:100%; height:100%;"></svg>
    </div>

    <!-- Bottom Bar -->
    <div class="bottom-stats-bar"
      style="position:absolute; bottom:0; left:0; right:0; background:rgba(10,14,39,0.95);
      border-top:2px solid rgba(0,224,255,0.3); padding:0.75rem 1rem; display:flex; gap:0.75rem;
      overflow-x:auto; overflow-y:hidden; backdrop-filter:blur(10px); z-index:100; -webkit-overflow-scrolling: touch;">

      <div class="stat-card-mini" id="btn-messages"
        style="cursor:pointer; background:rgba(0,224,255,0.05); border:1px solid rgba(0,224,255,0.2); border-radius:8px; padding:0.75rem; text-align:center; transition:all 0.2s;">
        <div class="icon" style="font-size:1.5rem; color:#00e0ff; margin-bottom:0.25rem;"><i class="fas fa-envelope"></i></div>
        <div class="value" id="unread-messages" style="font-size:1.5rem; font-weight:bold; color:white;">0</div>
        <div class="label" style="font-size:0.75rem; color:#aaa; text-transform:uppercase;">Messages</div>
      </div>

      <div class="stat-card-mini" id="btn-projects"
        style="cursor:pointer; background:rgba(0,224,255,0.05); border:1px solid rgba(0,224,255,0.2); border-radius:8px; padding:0.75rem; text-align:center; transition:all 0.2s;">
        <div class="icon" style="font-size:1.5rem; color:#00e0ff; margin-bottom:0.25rem;"><i class="fas fa-lightbulb"></i></div>
        <div class="value" id="active-projects" style="font-size:1.5rem; font-weight:bold; color:white;">0</div>
        <div class="label" style="font-size:0.75rem; color:#aaa; text-transform:uppercase;">Projects</div>
      </div>

      <div class="stat-card-mini" id="btn-endorsements"
        style="cursor:pointer; background:rgba(0,224,255,0.05); border:1px solid rgba(0,224,255,0.2); border-radius:8px; padding:0.75rem; text-align:center; transition:all 0.2s;">
        <div class="icon" style="font-size:1.5rem; color:#00e0ff; margin-bottom:0.25rem;"><i class="fas fa-star"></i></div>
        <div class="value" id="total-endorsements" style="font-size:1.5rem; font-weight:bold; color:white;">0</div>
        <div class="label" style="font-size:0.75rem; color:#aaa; text-transform:uppercase;">Endorsements</div>
      </div>

      <div class="stat-card-mini" id="btn-network" onclick="openNetworkStatsModal()"
        style="cursor:pointer; background:rgba(0,224,255,0.1); border:1px solid rgba(0,224,255,0.3); border-radius:8px; padding:0.75rem; text-align:center; transition:all 0.2s;">
        <div class="icon" style="font-size:1.5rem; color:#00e0ff; margin-bottom:0.25rem;"><i class="fas fa-users"></i></div>
        <div class="value" id="network-size" style="font-size:1.5rem; font-weight:bold; color:white;">0</div>
        <div class="label" style="font-size:0.75rem; color:#aaa; text-transform:uppercase;">Network</div>
      </div>

      <div class="stat-card-mini" id="btn-bbs"
        style="cursor:pointer; background:rgba(0,224,255,0.05); border:1px solid rgba(0,224,255,0.2); border-radius:8px; padding:0.75rem; text-align:center; transition:all 0.2s;">
        <div class="icon" style="font-size:1.5rem; color:#00e0ff; margin-bottom:0.25rem;"><i class="fas fa-terminal"></i></div>
        <div class="label" style="font-size:0.85rem; color:#00e0ff; text-transform:uppercase; margin-top:0.5rem;">BBS</div>
      </div>

      <div class="stat-card-mini" id="btn-profile"
        style="cursor:pointer; background:rgba(0,224,255,0.05); border:1px solid rgba(0,224,255,0.2); border-radius:8px; padding:0.75rem; text-align:center; transition:all 0.2s;">
        <div class="icon" style="font-size:1.5rem; color:#00e0ff; margin-bottom:0.25rem;"><i class="fas fa-user-edit"></i></div>
        <div class="label" style="font-size:0.85rem; color:#00e0ff; text-transform:uppercase; margin-top:0.5rem;">Edit Profile</div>
      </div>

      <div class="stat-card-mini" id="btn-quickconnect"
        style="cursor:pointer; background:rgba(0,224,255,0.05); border:1px solid rgba(0,224,255,0.2); border-radius:8px; padding:0.75rem; text-align:center; transition:all 0.2s;">
        <div class="icon" style="font-size:1.5rem; color:#00e0ff; margin-bottom:0.25rem;"><i class="fas fa-user-plus"></i></div>
        <div class="label" style="font-size:0.85rem; color:#00e0ff; text-transform:uppercase; margin-top:0.5rem;">Quick Connect</div>
      </div>

      <div class="stat-card-mini" id="btn-filters"
        style="cursor:pointer; background:rgba(0,224,255,0.05); border:1px solid rgba(0,224,255,0.2); border-radius:8px; padding:0.75rem; text-align:center; transition:all 0.2s;">
        <div class="icon" style="font-size:1.5rem; color:#00e0ff; margin-bottom:0.25rem;"><i class="fas fa-filter"></i></div>
        <div class="label" style="font-size:0.85rem; color:#00e0ff; text-transform:uppercase; margin-top:0.5rem;">Filters</div>
      </div>

      <div class="stat-card-mini" id="btn-legend"
        style="cursor:pointer; background:rgba(0,224,255,0.05); border:1px solid rgba(0,224,255,0.2); border-radius:8px; padding:0.75rem; text-align:center; transition:all 0.2s;">
        <div class="icon" style="font-size:1.5rem; color:#00e0ff; margin-bottom:0.25rem;"><i class="fas fa-info-circle"></i></div>
        <div class="label" style="font-size:0.85rem; color:#00e0ff; text-transform:uppercase; margin-top:0.5rem;">Legend</div>
      </div>
    </div>
  </div>

  <!-- Compatibility trigger for legacy BBS -->
  <button id="fab-bbs-trigger" style="display:none;"></button>

  <!-- Profile Modal -->
  <div class="modal" id="profile-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeProfileModal()"><i class="fas fa-times"></i></button>
      <div id="modal-profile-content"></div>
    </div>
  </div>

  <!-- Messages Modal -->
  <div class="modal" id="messages-modal">
    <div class="modal-content" style="max-width: 900px;">
      <button class="modal-close" onclick="closeMessagesModal()"><i class="fas fa-times"></i></button>
      <h2 style="color: #00e0ff; margin-bottom: 1.5rem;"><i class="fas fa-envelope"></i> Messages</h2>

      <div style="display:grid; grid-template-columns: 1fr 2fr; gap:1rem; height: 500px;">
        <div style="background: rgba(0,224,255,0.05); border:1px solid rgba(0,224,255,0.2); border-radius: 12px; padding: 1rem; overflow-y:auto;">
          <h3 style="color:#00e0ff; font-size:0.9rem; margin-bottom:1rem; text-transform: uppercase;">Conversations</h3>
          <div id="modal-conversations-list"></div>
        </div>

        <div style="background: rgba(0,224,255,0.05); border:1px solid rgba(0,224,255,0.2); border-radius: 12px; padding:1rem; display:flex; flex-direction:column;">
          <h3 id="modal-conversation-title" style="color:#00e0ff; font-size:0.9rem; margin-bottom:1rem; text-transform: uppercase;">Select a conversation</h3>
          <div id="modal-conversation-messages" style="flex:1; overflow-y:auto; margin-bottom:1rem; padding:0.5rem;"></div>

          <div id="modal-message-input" style="display:none;">
            <form onsubmit="sendModalMessage(event)" style="display:flex; gap:0.5rem;">
              <input type="text" id="modal-message-text" placeholder="Type a message..."
                     style="flex:1; padding:0.75rem; background: rgba(0,224,255,0.05); border:1px solid rgba(0,224,255,0.2);
                     border-radius:8px; color:white; font-family:inherit;" required>
              <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i></button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Projects Modal -->
  <div class="modal" id="projects-modal">
    <div class="modal-content" style="max-width: 800px;">
      <button class="modal-close" onclick="closeProjectsModal()"><i class="fas fa-times"></i></button>
      <h2 style="color:#00e0ff; margin-bottom:1.5rem;"><i class="fas fa-lightbulb"></i> Projects</h2>

      <div style="margin-bottom:1.5rem;">
        <button onclick="showCreateProjectForm()" class="btn btn-primary"><i class="fas fa-plus"></i> New Project</button>
      </div>

      <div id="project-form" style="display:none; background: rgba(0,224,255,0.05); border:1px solid rgba(0,224,255,0.2);
          border-radius:12px; padding:1.5rem; margin-bottom:1.5rem;">
        <h3 style="color:#00e0ff; margin-bottom:1rem;">Create New Project</h3>
        <form onsubmit="createProject(event)">
          <div style="margin-bottom:1rem;">
            <label style="display:block; color:#aaa; margin-bottom:0.5rem;">Project Name *</label>
            <input type="text" id="project-name" required
                   style="width:100%; padding:0.75rem; background: rgba(0,224,255,0.05);
                   border:1px solid rgba(0,224,255,0.2); border-radius:8px; color:white; font-family:inherit;">
          </div>

          <div style="margin-bottom:1rem;">
            <label style="display:block; color:#aaa; margin-bottom:0.5rem;">Description *</label>
            <textarea id="project-description" rows="3" required
              style="width:100%; padding:0.75rem; background: rgba(0,224,255,0.05);
              border:1px solid rgba(0,224,255,0.2); border-radius:8px; color:white; font-family:inherit; resize:vertical;"></textarea>
          </div>

          <div style="margin-bottom:1rem;">
            <label style="display:block; color:#aaa; margin-bottom:0.5rem;">Required Skills (comma-separated)</label>
            <input type="text" id="project-skills" placeholder="e.g., JavaScript, React, Design"
                   style="width:100%; padding:0.75rem; background: rgba(0,224,255,0.05);
                   border:1px solid rgba(0,224,255,0.2); border-radius:8px; color:white; font-family:inherit;">
          </div>

          <div style="display:flex; gap:0.5rem;">
            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Create Project</button>
            <button type="button" onclick="hideCreateProjectForm()" class="btn" style="background:rgba(255,255,255,0.1);">Cancel</button>
          </div>
        </form>
      </div>

      <div id="projects-list" style="max-height: 400px; overflow-y:auto;"></div>
    </div>
  </div>

  <!-- Endorsements Modal -->
  <div class="modal" id="endorsements-modal">
    <div class="modal-content" style="max-width: 700px;">
      <button class="modal-close" onclick="closeEndorsementsModal()"><i class="fas fa-times"></i></button>
      <h2 style="color:#00e0ff; margin-bottom:1.5rem;"><i class="fas fa-star"></i> Endorsements</h2>

      <div style="margin-bottom:2rem;">
        <div style="display:flex; gap:0.5rem; margin-bottom:1rem;">
          <button onclick="showEndorsementsTab('received')" id="endorsements-tab-received"
                  style="flex:1; padding:0.75rem; background:linear-gradient(135deg,#00e0ff,#0080ff);
                  border:none; border-radius:8px; color:white; cursor:pointer; font-weight:bold;">Received</button>
          <button onclick="showEndorsementsTab('given')" id="endorsements-tab-given"
                  style="flex:1; padding:0.75rem; background:rgba(255,255,255,0.1); border:1px solid rgba(0,224,255,0.2);
                  border-radius:8px; color:white; cursor:pointer;">Given</button>
        </div>

        <div id="endorsements-received" style="max-height:400px; overflow-y:auto;"></div>
        <div id="endorsements-given" style="display:none; max-height:400px; overflow-y:auto;"></div>
      </div>
    </div>
  </div>

  <!-- Network Stats Modal -->
  <div class="modal" id="network-stats-modal">
    <div class="modal-content" style="max-width: 800px;">
      <button class="modal-close" onclick="closeNetworkStatsModal()">
        <i class="fas fa-times"></i>
      </button>
      <h2 style="color: #00e0ff; margin-bottom: 1.5rem;">
        <i class="fas fa-users"></i> Your Network Stats
      </h2>

      <div id="network-stats-content" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
        <div style="text-align: center; color: #aaa; padding: 3rem;">
          <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: #00e0ff;"></i>
          <p style="margin-top: 1rem;">Loading network stats...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Connect Modal -->
  <div class="modal" id="quick-connect-modal">
    <div class="modal-content" style="max-width: 800px;">
      <button class="modal-close" onclick="closeQuickConnectModal()"><i class="fas fa-times"></i></button>
      <h2 style="color:#00e0ff; margin-bottom:1.5rem;"><i class="fas fa-user-plus"></i> Quick Connect</h2>
      <p style="color:#aaa; margin-bottom:1.5rem;">Connect with people who share your interests and skills</p>
      <div id="quick-connect-list" style="max-height: 500px; overflow-y:auto;"></div>
    </div>
  </div>

  <!-- BBS Modal -->
  <div id="bbs-modal"></div>

  <!-- External libs (ONLY ONCE) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>

  <!-- Required base modules -->
  <script type="module" src="assets/js/supabaseClient.js"></script>
  <script src="assets/js/ecosystem-connector.js"></script>
  <script src="assets/js/cynq.js"></script>
  <script src="assets/js/neuralBackground.js"></script>

  <!-- Feature modules -->
  <script type="module" src="assets/js/onboarding.js"></script>
  <script type="module" src="assets/js/node-panel.js"></script>
  <script type="module" src="assets/js/network-filters.js"></script>
  <script type="module" src="assets/js/graph-legend.js"></script>
  <script type="module" src="assets/js/admin-analytics.js"></script>

  <!-- Auth + profile are in ROOT -->
  <script type="module" src="auth.js"></script>
  <script type="module" src="profile.js"></script>

  <!-- Main app boot -->
  <script type="module" src="main.js"></script>


  <!-- Dashboard controller -->
  <script type="module" src="assets/js/dashboardPane.js"></script>

  <!-- Profile Editor Extension -->
  <script>
    // Close profile modal
    window.closeProfileModal = function() {
      document.getElementById('profile-modal').classList.remove('active');
    };

    // Open profile editor
    window.openProfileEditor = async function() {
      try {
        const { data: { user } } = await window.supabase.auth.getUser();
        if (!user) {
          alert('Please log in first');
          return;
        }

        const { data: profile, error } = await window.supabase
          .from('community')
          .select('*')
          .eq('user_id', user.id)
          .single();

        if (error) {
          console.error('Error loading profile:', error);
          alert('Error loading profile: ' + error.message);
          return;
        }

        const modalContent = document.getElementById('modal-profile-content');
        const interests = Array.isArray(profile.interests) ? profile.interests.join(', ') : '';

        modalContent.innerHTML = `
          <h2 style="color: #00e0ff; margin-bottom: 1.5rem;">
            <i class="fas fa-user-edit"></i> Edit Your Profile
          </h2>

          <form id="edit-profile-form" style="max-width: 600px;">
            <div style="margin-bottom: 1.5rem; text-align: center;">
              <div id="edit-profile-image-preview" style="margin-bottom: 1rem;">
                ${profile.image_url ? `
                  <img src="${profile.image_url}" alt="Profile" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid #00e0ff;">
                ` : `
                  <div style="width: 100px; height: 100px; border-radius: 50%; background: rgba(0,224,255,0.1); border: 3px dashed rgba(0,224,255,0.3); display: inline-flex; align-items: center; justify-content: center;">
                    <i class="fas fa-user" style="font-size: 2.5rem; color: rgba(0,224,255,0.3);"></i>
                  </div>
                `}
              </div>
              <div style="margin-bottom: 1rem;">
                <input type="url" id="edit-image-url" value="${profile.image_url || ''}" placeholder="Profile image URL"
                  style="width: 100%; padding: 0.75rem; background: rgba(0,224,255,0.05); border: 1px solid rgba(0,224,255,0.2); border-radius: 8px; color: white; font-family: inherit;">
              </div>
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; color: #aaa; margin-bottom: 0.5rem; font-weight: bold;">Name *</label>
              <input type="text" id="edit-name" value="${profile.name || ''}" required placeholder="Your full name"
                style="width: 100%; padding: 0.75rem; background: rgba(0,224,255,0.05); border: 1px solid rgba(0,224,255,0.2); border-radius: 8px; color: white; font-family: inherit;">
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; color: #aaa; margin-bottom: 0.5rem; font-weight: bold;">Bio</label>
              <textarea id="edit-bio" rows="3" placeholder="Tell us about yourself..."
                style="width: 100%; padding: 0.75rem; background: rgba(0,224,255,0.05); border: 1px solid rgba(0,224,255,0.2); border-radius: 8px; color: white; font-family: inherit; resize: vertical;"
              >${profile.bio || ''}</textarea>
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; color: #aaa; margin-bottom: 0.5rem; font-weight: bold;">Skills (comma-separated)</label>
              <input type="text" id="edit-skills" value="${profile.skills || ''}" placeholder="e.g., JavaScript, React, Python, Design"
                style="width: 100%; padding: 0.75rem; background: rgba(0,224,255,0.05); border: 1px solid rgba(0,224,255,0.2); border-radius: 8px; color: white; font-family: inherit;">
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; color: #aaa; margin-bottom: 0.5rem; font-weight: bold;">Interests (comma-separated)</label>
              <input type="text" id="edit-interests" value="${interests}" placeholder="e.g., AI, Web3, Sustainability"
                style="width: 100%; padding: 0.75rem; background: rgba(0,224,255,0.05); border: 1px solid rgba(0,224,255,0.2); border-radius: 8px; color: white; font-family: inherit;">
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; color: #aaa; margin-bottom: 0.5rem; font-weight: bold;">Availability</label>
              <select id="edit-availability" style="width: 100%; padding: 0.75rem; background: rgba(0,224,255,0.05); border: 1px solid rgba(0,224,255,0.2); border-radius: 8px; color: white; font-family: inherit;">
                <option value="Available now" ${profile.availability === 'Available now' ? 'selected' : ''}>Available now</option>
                <option value="Available for mentoring" ${profile.availability === 'Available for mentoring' ? 'selected' : ''}>Available for mentoring</option>
                <option value="Looking for opportunities" ${profile.availability === 'Looking for opportunities' ? 'selected' : ''}>Looking for opportunities</option>
                <option value="Busy" ${profile.availability === 'Busy' ? 'selected' : ''}>Busy</option>
                <option value="Not available" ${profile.availability === 'Not available' ? 'selected' : ''}>Not available</option>
              </select>
            </div>

            <div style="display: flex; gap: 1rem;">
              <button type="submit" style="flex: 1; background: linear-gradient(135deg, #00e0ff, #0080ff); border: none; padding: 1rem; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 1rem;">
                <i class="fas fa-save"></i> Save Changes
              </button>
              <button type="button" onclick="closeProfileModal()" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 1rem 1.5rem; border-radius: 8px; color: white; cursor: pointer; font-size: 1rem;">
                Cancel
              </button>
            </div>
          </form>
        `;

        document.getElementById('edit-profile-form').addEventListener('submit', async (e) => {
          e.preventDefault();

          const updatedProfile = {
            name: document.getElementById('edit-name').value.trim(),
            bio: document.getElementById('edit-bio').value.trim(),
            skills: document.getElementById('edit-skills').value.trim(),
            interests: document.getElementById('edit-interests').value.trim().split(',').map(i => i.trim()).filter(Boolean),
            availability: document.getElementById('edit-availability').value,
            image_url: document.getElementById('edit-image-url').value.trim() || null
          };

          const { error: updateError } = await window.supabase
            .from('community')
            .update(updatedProfile)
            .eq('id', profile.id);

          if (updateError) {
            console.error('Error updating profile:', updateError);
            alert('Error updating profile: ' + updateError.message);
            return;
          }

          const toast = document.createElement('div');
          toast.style.cssText = `
            position: fixed; top: 100px; right: 20px;
            background: linear-gradient(135deg, #00ff88, #00cc70);
            color: white; padding: 1rem 1.5rem; border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 10000; font-weight: bold;
          `;
          toast.innerHTML = '<i class="fas fa-check-circle"></i> Profile updated successfully!';
          document.body.appendChild(toast);
          setTimeout(() => toast.remove(), 3000);

          closeProfileModal();
          window.location.reload();
        });

        document.getElementById('profile-modal').classList.add('active');
      } catch (err) {
        console.error('Error in openProfileEditor:', err);
        alert('Error opening profile editor');
      }
    };
  </script>

</body>
</html>
