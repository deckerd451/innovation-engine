<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CharlestonHacks Innovation Engine</title>
  <link rel="icon" href="favicon.ico"/>
  <link rel="stylesheet" href="assets/css/base.css" />
  <link rel="stylesheet" href="assets/css/engine.css" />
  <link rel="stylesheet" href="assets/css/overlays.css" />
  <link rel="stylesheet" href="assets/css/connections.css" />
  <link rel="stylesheet" href="assets/css/cynq.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="dashboard.css" />
</head>
<body>
  <!-- Neural Network Background -->
  <canvas id="neural-bg" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);"></canvas>

  <!-- Login Section -->
  <div id="login-section" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; z-index: 9999; overflow: hidden; background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);">
    <div class="login-container">
      <img src="ieheader.webp" 
           alt="CharlestonHacks Innovation Engine" 
           style="max-width: 100%; height: auto; margin-bottom: 1rem;"
           onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
      <h1 style="display: none; color: #00e0ff; font-size: 2rem; margin-bottom: 1rem;">CharlestonHacks Innovation Engine</h1>
      <p>Making Invisible Networks Visible</p>
      
      <div class="oauth-buttons">
        <button id="github-login" class="oauth-btn">
          <i class="fab fa-github"></i>
          Continue with GitHub
        </button>
        
        <button id="google-login" class="oauth-btn">
          <i class="fab fa-google"></i>
          Continue with Google
        </button>
      </div>
    </div>
  </div>

  <!-- OLD PROFILE SECTION REMOVED - NOW USING INLINE PROFILE EDITOR -->

  <!-- Fixed Header -->
  <header class="unified-header hidden" id="main-header">
    <div class="header-content">
      <div class="header-logo">
        <a href="https://charlestonhacks.com/" style="display: flex; align-items: center; text-decoration: none;">
          <img src="charlestonhackslogo.svg" 
               alt="CharlestonHacks" 
               style="height: 40px; width: auto; cursor: pointer;"
               onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
          <span style="display: none; color: #00e0ff; font-size: 1.5rem; font-weight: bold;">CharlestonHacks</span>
        </a>
      </div>
      
      <div class="header-search">
        <i class="fas fa-search"></i>
        <input type="text" id="global-search" placeholder="Search people, skills, projects...">
      </div>
      
      <div class="header-actions">
        <div class="header-notification" id="notifications-bell" onclick="scrollToSection('network')" style="cursor: pointer;" title="View pending requests">
          <i class="fas fa-bell"></i>
          <span class="notification-badge hidden" id="notif-count">0</span>
        </div>
        
        <div class="user-menu" id="user-menu" onclick="handleLogout()" style="cursor: pointer;" title="Click to sign out">
          <div class="user-avatar" id="user-avatar-header">
            <span id="user-initials-header">?</span>
          </div>
          <span id="user-name-header">Loading...</span>
          <i class="fas fa-sign-out-alt"></i>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Container -->
  <div class="unified-main hidden" id="main-content">
    
    <!-- Hero Section -->
    <section class="hero-section">
      <h1>Innovation Engine</h1>
      <p class="hero-tagline">Making Invisible Networks Visible</p>
    </section>

    <!-- Quick Stats -->
    <div class="quick-stats">
      <div class="stat-card">
        <div class="icon"><i class="fas fa-envelope"></i></div>
        <div class="value" id="unread-messages">Loading...</div>
        <div class="label">Unread Messages</div>
        <div class="trend"><i class="fas fa-arrow-up"></i> <span id="messages-trend">New today</span></div>
      </div>

      <div class="stat-card">
        <div class="icon"><i class="fas fa-lightbulb"></i></div>
        <div class="value" id="active-projects">Loading...</div>
        <div class="label">Active Projects</div>
        <div class="trend"><i class="fas fa-tasks"></i> <span id="projects-trend">In progress</span></div>
      </div>

      <div class="stat-card">
        <div class="icon"><i class="fas fa-star"></i></div>
        <div class="value" id="total-endorsements">Loading...</div>
        <div class="label">Your Endorsements</div>
        <div class="trend"><i class="fas fa-arrow-up"></i> <span id="endorsements-trend">This week</span></div>
      </div>

      <div class="stat-card">
        <div class="icon"><i class="fas fa-users"></i></div>
        <div class="value" id="network-size">Loading...</div>
        <div class="label">Network Size</div>
        <div class="trend"><i class="fas fa-arrow-up"></i> <span id="network-trend">This month</span></div>
      </div>
    </div>

    <!-- Messages Section -->
    <section class="dashboard-section" id="messages">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-envelope"></i>
          Messages
        </h2>
        <div class="section-actions">
          <button class="btn btn-primary" onclick="openNewMessageModal()">
            <i class="fas fa-paper-plane"></i> New Message
          </button>
        </div>
      </div>

      <div class="two-col-grid">
        <div class="content-card">
          <h3>Conversations</h3>
          <div id="conversations-list" style="max-height: 400px; overflow-y: auto;">
            <div class="loading">Loading conversations...</div>
          </div>
        </div>

        <div class="content-card">
          <h3 id="conversation-title">Select a conversation</h3>
          <div id="conversation-messages" style="max-height: 300px; overflow-y: auto; margin-bottom: 1rem;">
            <div style="text-align: center; color: #aaa; padding: 2rem;">
              <i class="fas fa-comments" style="font-size: 3rem; opacity: 0.3;"></i>
              <p>Select a conversation to view messages</p>
            </div>
          </div>
          <div id="message-input-area" style="display: none;">
            <form onsubmit="sendMessage(event)" style="display: flex; gap: 0.5rem;">
              <input type="text" id="message-input" placeholder="Type a message..." style="flex: 1; padding: 0.75rem; background: rgba(0,224,255,0.05); border: 1px solid rgba(0,224,255,0.2); border-radius: 8px; color: white; font-family: inherit;" required>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-paper-plane"></i> Send
              </button>
            </form>
          </div>
        </div>
      </div>
    </section>

    <!-- Discovery Section -->
    <!-- Discover & Team Builder -->
    <section class="dashboard-section" id="discover">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-search"></i>
          Discover & Build Teams
        </h2>
      </div>

      <!-- Search Widget -->
      <div class="search-widget">
        <div class="search-input-group">
          <div class="search-input-wrapper">
            <i class="fas fa-search"></i>
            <input type="text" class="search-input" id="people-search" placeholder="Search by skills or name...">
          </div>
          <button class="btn btn-primary" id="search-btn">
            <i class="fas fa-search"></i> Search
          </button>
        </div>

        <div class="quick-filters" id="quick-filters">
          <span class="filter-tag" data-skill="React">React</span>
          <span class="filter-tag" data-skill="Python">Python</span>
          <span class="filter-tag" data-skill="JavaScript">JavaScript</span>
          <span class="filter-tag" data-skill="Designer">Designer</span>
          <span class="filter-tag" data-skill="Node.js">Node.js</span>
          <span class="filter-tag" data-filter="available">Available</span>
          <span class="filter-tag" data-filter="new">New Members</span>
        </div>
      </div>

      <!-- Tabs for Search / Suggestions / Team Builder -->
      <div style="margin: 2rem 0 1rem 0; border-bottom: 2px solid rgba(0,224,255,0.2);">
        <div style="display: flex; gap: 2rem;">
          <button class="discover-tab active" data-tab="search" style="background: none; border: none; color: #00e0ff; padding: 0.75rem 0; cursor: pointer; border-bottom: 2px solid #00e0ff; margin-bottom: -2px; font-weight: bold;">
            <i class="fas fa-search"></i> Search Results
          </button>
          <button class="discover-tab" data-tab="suggestions" style="background: none; border: none; color: #aaa; padding: 0.75rem 0; cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px;">
            <i class="fas fa-magic"></i> Suggested For You
          </button>
          <button class="discover-tab" data-tab="team-builder" style="background: none; border: none; color: #aaa; padding: 0.75rem 0; cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px;">
            <i class="fas fa-users-cog"></i> Build Team
          </button>
        </div>
      </div>

      <!-- Search Results Tab -->
      <div class="discover-tab-content active" id="search-tab">
        <div class="three-col-grid" id="search-results">
          <div style="grid-column: 1/-1; text-align: center; color: #aaa; padding: 2rem;">
            <i class="fas fa-search" style="font-size: 3rem; opacity: 0.3;"></i>
            <p>Search for people by name or skills</p>
          </div>
        </div>
      </div>

      <!-- Suggestions Tab -->
      <div class="discover-tab-content" id="suggestions-tab" style="display: none;">
        <p style="color: #aaa; margin-bottom: 1.5rem;">Based on your skills and network</p>
        <div class="three-col-grid" id="suggestions-grid">
          <div class="loading">Loading...</div>
        </div>
      </div>

      <!-- Team Builder Tab -->
      <div class="discover-tab-content" id="team-builder-tab" style="display: none;">
        <div class="team-builder-widget">
          <div class="skills-input-group">
            <label>Skills Needed:</label>
            <div class="skills-tags-input" id="team-skills-tags">
              <input type="text" id="team-skill-input" placeholder="Add skill and press Enter..." 
                     style="border: none; background: transparent; color: #fff; outline: none; flex: 1; min-width: 150px;">
            </div>
          </div>

          <div class="team-size-slider">
            <label>Team Size:</label>
            <div class="slider-container">
              <div class="slider" id="team-size-slider">
                <div class="slider-track" id="slider-track" style="width: 50%;"></div>
              </div>
              <div class="slider-value" id="team-size-value">4</div>
            </div>
          </div>

          <button class="btn btn-primary" id="generate-team-btn" style="width: 100%;">
            <i class="fas fa-magic"></i> Generate Team
          </button>

          <div class="team-results hidden" id="team-results">
            <h3 style="color: #00e0ff; margin-bottom: 1rem;">Optimal Team</h3>
            <div class="team-match-score">
              <i class="fas fa-check-circle"></i> <span id="match-score">98%</span> skill match
            </div>
            <div class="three-col-grid" id="team-members-grid">
              <!-- Will be populated by JS -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- All Connections List -->
    <section class="dashboard-section" id="connections">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-users"></i>
          My Connections
        </h2>
      </div>

      <div id="connections-content">
        <div class="loading">Loading...</div>
      </div>
    </section>

    <!-- Innovation Hub -->
    <section class="dashboard-section" id="innovation-hub">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-lightbulb"></i>
          Innovation Hub
        </h2>
        <div class="section-actions">
          <button class="btn btn-primary" onclick="openNewProjectModal()">
            <i class="fas fa-plus"></i> New Project
          </button>
        </div>
      </div>

      <div id="cynq-app">
        <!-- Project Grid -->
        <div id="innovation-projects" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
          <!-- Projects will be loaded here -->
        </div>
        
        <!-- Empty State -->
        <div id="innovation-empty" style="text-align: center; padding: 3rem; color: #aaa; display: none;">
          <i class="fas fa-lightbulb" style="font-size: 4rem; color: rgba(0,224,255,0.3); margin-bottom: 1rem;"></i>
          <h3 style="color: #00e0ff; margin-bottom: 0.5rem;">No Projects Yet</h3>
          <p>Create your first innovation project to get started!</p>
          <button class="btn btn-primary" onclick="openNewProjectModal()" style="margin-top: 1rem;">
            <i class="fas fa-plus"></i> Create Project
          </button>
        </div>
      </div>
      
      
      <!-- New Message Modal -->
      <div class="modal" id="new-message-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
        <div class="modal-content" style="background: #0a1929; border: 1px solid rgba(0,224,255,0.3); border-radius: 12px; padding: 2rem; max-width: 500px; width: 90%;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 style="color: #00e0ff; margin: 0;"><i class="fas fa-paper-plane"></i> New Message</h3>
            <button onclick="closeNewMessageModal()" style="background: none; border: none; color: #aaa; font-size: 1.5rem; cursor: pointer;">&times;</button>
          </div>
          
          <form id="new-message-form" onsubmit="createNewMessage(event)">
            <div style="margin-bottom: 1rem;">
              <label style="display: block; color: #aaa; margin-bottom: 0.5rem;">To (select connection)</label>
              <select id="message-recipient" required style="width: 100%; padding: 0.75rem; background: rgba(0,224,255,0.05); border: 1px solid rgba(0,224,255,0.2); border-radius: 8px; color: white; font-family: inherit;">
                <option value="">-- Select a connection --</option>
              </select>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; color: #aaa; margin-bottom: 0.5rem;">Message</label>
              <textarea id="new-message-text" rows="4" required placeholder="Type your message here..." style="width: 100%; padding: 0.75rem; background: rgba(0,224,255,0.05); border: 1px solid rgba(0,224,255,0.2); border-radius: 8px; color: white; font-family: inherit; resize: vertical;"></textarea>
            </div>
            
            <div style="display: flex; gap: 1rem;">
              <button type="submit" class="btn btn-primary" style="flex: 1; background: linear-gradient(135deg, #00e0ff, #0080ff); border: none; padding: 0.75rem; border-radius: 8px; color: white; font-weight: bold; cursor: pointer;">
                <i class="fas fa-paper-plane"></i> Send Message
              </button>
              <button type="button" onclick="closeNewMessageModal()" class="btn" style="flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 0.75rem; border-radius: 8px; color: white; cursor: pointer;">
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
      
      <!-- New Project Modal -->
      <div class="modal" id="new-project-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
        <div class="modal-content" style="background: #0a1929; border: 1px solid rgba(0,224,255,0.3); border-radius: 12px; padding: 2rem; max-width: 500px; width: 90%;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 style="color: #00e0ff; margin: 0;"><i class="fas fa-plus"></i> New Project</h3>
            <button onclick="closeNewProjectModal()" style="background: none; border: none; color: #aaa; font-size: 1.5rem; cursor: pointer;">&times;</button>
          </div>
          
          <form id="new-project-form" onsubmit="createProject(event)">
            <div style="margin-bottom: 1rem;">
              <label style="display: block; color: #aaa; margin-bottom: 0.5rem;">Project Name</label>
              <input type="text" id="project-name" required style="width: 100%; padding: 0.75rem; background: rgba(0,224,255,0.05); border: 1px solid rgba(0,224,255,0.2); border-radius: 8px; color: white; font-family: inherit;">
            </div>
            
            <div style="margin-bottom: 1rem;">
              <label style="display: block; color: #aaa; margin-bottom: 0.5rem;">Description</label>
              <textarea id="project-description" rows="3" required style="width: 100%; padding: 0.75rem; background: rgba(0,224,255,0.05); border: 1px solid rgba(0,224,255,0.2); border-radius: 8px; color: white; font-family: inherit; resize: vertical;"></textarea>
            </div>
            
            <div style="margin-bottom: 1rem;">
              <label style="display: block; color: #aaa; margin-bottom: 0.5rem;">Status</label>
              <select id="project-status" style="width: 100%; padding: 0.75rem; background: rgba(0,224,255,0.05); border: 1px solid rgba(0,224,255,0.2); border-radius: 8px; color: white; font-family: inherit;">
                <option value="open">Open</option>
                <option value="active">Active</option>
                <option value="completed">Completed</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; color: #aaa; margin-bottom: 0.5rem;">Tags (comma-separated)</label>
              <input type="text" id="project-tags" placeholder="web, ai, startup" style="width: 100%; padding: 0.75rem; background: rgba(0,224,255,0.05); border: 1px solid rgba(0,224,255,0.2); border-radius: 8px; color: white; font-family: inherit;">
            </div>
            
            <div style="display: flex; gap: 1rem;">
              <button type="submit" class="btn btn-primary" style="flex: 1; background: linear-gradient(135deg, #00e0ff, #0080ff); border: none; padding: 0.75rem; border-radius: 8px; color: white; font-weight: bold; cursor: pointer;">
                <i class="fas fa-save"></i> Create Project
              </button>
              <button type="button" onclick="closeNewProjectModal()" class="btn" style="flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 0.75rem; border-radius: 8px; color: white; cursor: pointer;">
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- Profile Editor -->
    <section class="dashboard-section" id="profile">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-user-edit"></i>
          Your Profile
        </h2>
      </div>

      <div class="profile-editor">
        <div class="profile-editor-header" id="profile-toggle">
          <h3>Edit Your Profile</h3>
          <i class="fas fa-chevron-down"></i>
        </div>
        <div class="profile-editor-content" id="profile-editor-content">
          <div id="profile-section">
            <!-- Profile form will be loaded here from existing code -->
            <p style="color: #aaa;">Loading profile editor...</p>
          </div>
        </div>
      </div>
    </section>

  <!-- OLD PROFILE SECTION CLOSING DIV REMOVED -->

  <!-- Floating Action Buttons -->
  <div class="floating-actions">
    <button class="fab" id="fab-synapse" title="Open Full Network View">
      <i class="fas fa-project-diagram"></i>
      <span class="fab-label">Full Network</span>
    </button>
    <button class="fab" id="fab-bbs" title="Open BBS">
      <i class="fas fa-terminal"></i>
      <span class="fab-label">BBS</span>
    </button>
    <button class="fab" id="fab-quick-connect" title="Quick Connect">
      <i class="fas fa-user-plus"></i>
      <span class="fab-label">Quick Connect</span>
    </button>
  </div>

  <!-- Profile Modal -->
  <div class="modal" id="profile-modal">
    <div class="modal-content">
      <button class="modal-close" id="close-profile-modal">
        <i class="fas fa-times"></i>
      </button>
      <div id="modal-profile-content">
        <!-- Will be populated when viewing a profile -->
      </div>
    </div>
  </div>

  <!-- Fullscreen Synapse Container -->
  <div id="synapse-container" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); z-index: 9999; align-items: center; justify-content: center;">
    <svg id="synapse-svg" style="width: 100%; height: 100%;"></svg>
  </div>

  <!-- BBS Modal -->
  <div id="bbs-modal">
    <!-- BBS content will be loaded here -->
  </div>

  </div>

  <!-- User badge and logout -->
  <div id="user-badge" class="hidden"></div>
  <button id="logout-btn" class="hidden">Sign Out</button>

  <!-- External modules -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
  <!-- Load Supabase client first -->
  <script type="module" src="assets/js/supabaseClient.js"></script>
  <script src="assets/js/ecosystem-connector.js"></script>
  <script src="assets/js/cynq.js"></script>
  <!-- Neural background -->
  <script src="assets/js/neuralBackground.js"></script>
  <!-- Load modular dashboard files in order -->
  <script type="module" src="auth.js"></script>
  <script type="module" src="profile.js"></script>
  <script type="module" src="dashboard.js"></script>
  <script type="module" src="main.js"></script>
  <!-- BBS System -->
  <script type="module">
    import { initBBS } from './assets/js/bbs.js';
    
    document.addEventListener('DOMContentLoaded', () => {
      const bbsBtn = document.getElementById('fab-bbs');
      if (bbsBtn) {
        bbsBtn.addEventListener('click', () => {
          initBBS();
        });
      }
    });
  </script>
  
  <!-- Synapse System -->
  <script type="module">
    import { initSynapseView } from './assets/js/synapse.js';
    
    document.addEventListener('DOMContentLoaded', () => {
      const synapseBtn = document.getElementById('fab-synapse');
      const synapseContainer = document.getElementById('synapse-container');
      
      if (synapseBtn) {
        synapseBtn.addEventListener('click', async () => {
          // Show container
          synapseContainer.style.display = 'flex';
          
          // Create close button dynamically
          let closeBtn = document.getElementById('close-synapse');
          if (!closeBtn) {
            closeBtn = document.createElement('button');
            closeBtn.id = 'close-synapse';
            closeBtn.innerHTML = '<i class="fas fa-times"></i> Close';
            closeBtn.style.cssText = 'position: absolute; top: 20px; right: 20px; background: rgba(0,224,255,0.2); border: 2px solid #00e0ff; color: #00e0ff; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 1rem; z-index: 10000; font-family: inherit;';
            
            closeBtn.addEventListener('click', () => {
              synapseContainer.style.display = 'none';
            });
            
            synapseContainer.appendChild(closeBtn);
          }
          
          // Initialize visualization
          await initSynapseView();
        });
      }
    });
  </script>
</body>
</html>
