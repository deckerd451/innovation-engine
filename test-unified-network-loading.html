<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unified Network Loading Test</title>
  <style>
    body {
      background: #0a0e27;
      color: #fff;
      font-family: monospace;
      padding: 20px;
    }
    .test-section {
      background: rgba(0, 224, 255, 0.1);
      border: 1px solid rgba(0, 224, 255, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
    }
    .success { color: #44ff44; }
    .error { color: #ff4444; }
    .warning { color: #ffaa00; }
    button {
      background: rgba(0, 224, 255, 0.2);
      border: 1px solid rgba(0, 224, 255, 0.5);
      color: #00e0ff;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: rgba(0, 224, 255, 0.3);
    }
  </style>
</head>
<body>
  <h1>üîç Unified Network Loading Diagnostic</h1>
  
  <div class="test-section">
    <h2>Feature Flag Status</h2>
    <div id="feature-flag-status"></div>
    <button onclick="enableFeature()">Enable Unified Network</button>
    <button onclick="disableFeature()">Disable Unified Network</button>
  </div>
  
  <div class="test-section">
    <h2>Module Loading Status</h2>
    <div id="module-status"></div>
    <button onclick="checkModules()">Check Modules</button>
  </div>
  
  <div class="test-section">
    <h2>Console Output</h2>
    <div id="console-output" style="max-height: 300px; overflow-y: auto;"></div>
  </div>

  <script>
    // Capture console output
    const consoleOutput = document.getElementById('console-output');
    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;
    
    function addToConsole(type, ...args) {
      const div = document.createElement('div');
      div.className = type;
      div.textContent = `[${type.toUpperCase()}] ${args.join(' ')}`;
      consoleOutput.appendChild(div);
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    }
    
    console.log = (...args) => {
      originalLog(...args);
      addToConsole('log', ...args);
    };
    
    console.error = (...args) => {
      originalError(...args);
      addToConsole('error', ...args);
    };
    
    console.warn = (...args) => {
      originalWarn(...args);
      addToConsole('warning', ...args);
    };
    
    // Check feature flag
    function checkFeatureFlag() {
      const enabled = localStorage.getItem('enable-unified-network') === 'true';
      const debug = localStorage.getItem('unified-network-debug') === 'true';
      
      document.getElementById('feature-flag-status').innerHTML = `
        <p>Unified Network: <span class="${enabled ? 'success' : 'error'}">${enabled ? 'ENABLED' : 'DISABLED'}</span></p>
        <p>Debug Mode: <span class="${debug ? 'success' : 'error'}">${debug ? 'ENABLED' : 'DISABLED'}</span></p>
      `;
      
      return enabled;
    }
    
    function enableFeature() {
      localStorage.setItem('enable-unified-network', 'true');
      localStorage.setItem('unified-network-debug', 'true');
      console.log('‚úÖ Unified Network enabled');
      checkFeatureFlag();
    }
    
    function disableFeature() {
      localStorage.removeItem('enable-unified-network');
      localStorage.removeItem('unified-network-debug');
      console.log('‚ùå Unified Network disabled');
      checkFeatureFlag();
    }
    
    function checkModules() {
      const status = document.getElementById('module-status');
      let html = '<h3>Module Check Results:</h3>';
      
      // Check if modules are loaded
      const checks = [
        { name: 'logger', obj: window.logger },
        { name: 'unifiedNetworkIntegration', obj: window.unifiedNetworkIntegration },
        { name: 'unifiedNetworkApi', obj: window.unifiedNetworkApi },
        { name: 'synapseBridge', obj: window.synapseBridge },
        { name: 'unifiedNetworkAdmin', obj: window.unifiedNetworkAdmin },
        { name: 'unifiedNetworkErrorIntegration', obj: window.unifiedNetworkErrorIntegration }
      ];
      
      checks.forEach(check => {
        const exists = typeof check.obj !== 'undefined';
        html += `<p>${check.name}: <span class="${exists ? 'success' : 'error'}">${exists ? '‚úÖ LOADED' : '‚ùå NOT LOADED'}</span></p>`;
        
        if (exists && check.obj) {
          // Show available methods
          const methods = Object.keys(check.obj).filter(key => typeof check.obj[key] === 'function');
          if (methods.length > 0) {
            html += `<p style="margin-left: 20px; font-size: 0.9em; color: #aaa;">Methods: ${methods.join(', ')}</p>`;
          }
        }
      });
      
      status.innerHTML = html;
    }
    
    // Initial checks
    checkFeatureFlag();
    checkModules();
    
    console.log('üîç Diagnostic page loaded');
    console.log('üìç Current URL:', window.location.href);
  </script>
  
  <!-- Load logger first -->
  <script type="module" src="assets/js/logger.js?v=2"></script>
  
  <!-- Load unified network integration -->
  <script type="module">
    console.log('üîÑ Loading unified-network-integration.js...');
    
    try {
      const module = await import('./assets/js/unified-network-integration.js?v=2');
      console.log('‚úÖ unified-network-integration.js loaded successfully');
      console.log('üì¶ Module exports:', Object.keys(module));
      
      // Check if window object was set
      setTimeout(() => {
        if (window.unifiedNetworkIntegration) {
          console.log('‚úÖ window.unifiedNetworkIntegration is available');
          console.log('üì¶ Available methods:', Object.keys(window.unifiedNetworkIntegration));
        } else {
          console.error('‚ùå window.unifiedNetworkIntegration is NOT available');
        }
        checkModules();
      }, 500);
      
    } catch (error) {
      console.error('‚ùå Failed to load unified-network-integration.js:', error);
      console.error('Error details:', error.message);
      console.error('Stack:', error.stack);
    }
  </script>
  
  <!-- Load synapse bridge -->
  <script type="module">
    console.log('üîÑ Loading unified-network-synapse-bridge.js...');
    
    try {
      const module = await import('./assets/js/unified-network-synapse-bridge.js?v=2');
      console.log('‚úÖ unified-network-synapse-bridge.js loaded successfully');
      
      setTimeout(() => {
        if (window.synapseBridge) {
          console.log('‚úÖ window.synapseBridge is available');
        } else {
          console.error('‚ùå window.synapseBridge is NOT available');
        }
        checkModules();
      }, 500);
      
    } catch (error) {
      console.error('‚ùå Failed to load unified-network-synapse-bridge.js:', error);
    }
  </script>
  
  <!-- Load admin panel -->
  <script src="assets/js/unified-network-admin.js?v=2"></script>
</body>
</html>
